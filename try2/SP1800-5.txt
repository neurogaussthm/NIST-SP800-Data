NIST SPECIAL PUBLICATION 1800-5 IT Asset Management Includes Executive Summary (A); Approach, Architecture, and Security Characteristics (B); and How-To Guides (C) Michael Stone Chinedum Irrechukwu Harry Perper Devin Wynne Leah Kauffman, Editor-in-Chief This publication is available free of charge from: http://doi.org/10.6028/NIST.SP.1800-5 The first draft of this publication is available free of charge from: https://www.nccoe.nist.gov/sites/default/files/library/sp1800/fs-itam-nist-sp1800-5-draft.pdfNIST SPECIAL PUBLICATION 1800-5 IT Asset Management Includes Executive Summary (A); Approach, Architecture, and Security Characteristics (B); and How-To Guides (C) Michael Stone National Cybersecurity Center of Excellence Information Technology Laboratory Chinedum Irrechukwu Harry Perper Devin Wynne The MITRE Corporation McLean, VA Leah Kauffman, Editor-in-Chief National Cybersecurity Center of Excellence Information Technology Laboratory September 2018 U.S. Department of Commerce Wilbur Ross, Secretary National Institute of Standards and Technology Walter G. Copan, Undersecretary of Commerce for Standards and Technology and DirectorNIST SPECIAL PUBLICATION 1800-5A IT Asset Management Volume A: Executive Summary Michael Stone Leah Kauffman, Editor-in-Chief National Cybersecurity Center of Excellence Information Technology Laboratory Chinedum Irrechukwu Harry Perper Devin Wynne The MITRE Corporation McLean, VA September 2018 This publication is available free of charge from: http://doi.org/10.6028/NIST.SP.1800-5 The first draft of this publication is available free of charge from: https://www.nccoe.nist.gov/sites/default/files/library/sp1800/fs-itam-nist-sp1800-5-draft.pdfExecutive Summary ▪ The National Cybersecurity Center of Excellence (NCCoE), part of the National Institute of Standards and Technology (NIST), developed an example solution that financial services companies can use for a more secure and efficient way of monitoring and managing their many information technology (IT) hardware and software assets. ▪ The security characteristics in our IT asset management platform are derived from the best practices of standards organizations, including the Payment Card Industry Data Security Standard (PCI DSS). ▪ The NCCoE’s approach uses open source and commercially available products that can be included alongside current products in your existing infrastructure. It provides a centralized, comprehensive view of networked hardware and software across an enterprise, reducing vulnerabilities and response time to security alerts, and increasing resilience. ▪ The example solution is packaged as a “How To” guide that demonstrates implementation of standards-based cybersecurity technologies in the real world. The guide helps organizations gain efficiencies in asset management, while saving them research and proof of concept costs. CHALLENGE Large financial services organizations employ tens or hundreds of thousands of individuals. At this scale, the technology base required to ensure smooth business operations (including computers, mobile devices, operating systems, applications, data, and network resources) is massive. To effectively manage, use, and secure each of those assets, you need to know their locations and functions. While physical assets can be labeled with bar codes and tracked in a database, this approach does not answer questions such as “What operating systems are our laptops running?” and “Which devices are vulnerable to the latest threat?” Computer security professionals in the financial services sector told us they are challenged by the vast diversity of hardware and software they attempt to track, and by a lack of centralized control: A large financial services organization can include subsidiaries, branches, third-party partners, contractors, as well as temporary workers and guests. This complexity makes it difficult to assess vulnerabilities or to respond quickly to threats, and to accurately assess risk in the first place (by pinpointing the most business essential assets). SOLUTION The NIST Cybersecurity IT Asset Management Practice Guide is a proof-of-concept solution demonstrating commercially available technologies that can be implemented to track the location and configuration of networked devices and software across an enterprise. Our example solution spans traditional physical asset tracking, IT asset information, physical security, and vulnerability and compliance information. Users can now query one system and gain insight into their entire IT asset portfolio. NIST SP 1800-5A: IT Asset Management 1 This publication is available free of charge from: http://doi.org/10.6028/NIST.SP.1800-5This guide: ▪ maps security characteristics to guidance and best practices from NIST and other standards organizations, including the PCI DSS ▪ provides: • a detailed example solution with capabilities that address security controls • instructions for implementers and security engineers, including examples of all the necessary components for installation, configuration, and integration ▪ is modular and uses products that are readily available and interoperable with your existing IT infrastructure and investments While the NCCoE used a suite of commercial products to address this challenge, this guide does not endorse these particular products, nor does it guarantee compliance with any regulatory initiatives. Your organization’s information security experts should identify the products that will best integrate with your existing tools and IT system infrastructure. Your organization can adopt this solution or one that adheres to these guidelines in whole, or you can use this guide as a starting point for tailoring and implementing parts of a solution. BENEFITS Our example solution has the following benefits: ▪ enables faster responses to security alerts by revealing the location, configuration, and owner of a device ▪ increases cybersecurity resilience: you can focus attention on the most valuable assets ▪ provides detailed system information to auditors ▪ determines how many software licenses are actually used in relation to how many have been paid for ▪ reduces help desk response times: staff will know what is installed and the latest pertinent errors and alerts ▪ reduces the attack surface of each device by ensuring that software is correctly patched SHARE YOUR FEEDBACK You can view or download the guide at https://www.nccoe.nist.gov/projects/use-cases/financial- services-sector/it-asset-management. If you adopt this solution for your own organization, please share your experience and advice with us. We recognize that technical solutions alone will not fully enable the benefits of our solution, so we encourage organizations to share lessons learned and best practices for transforming the processes associated with implementing this guide. To learn more by arranging a demonstration of this example implementation, contact the NCCoE at financial_nccoe@nist.gov. NIST SP 1800-5A: IT Asset Management 2 This publication is available free of charge from: http://doi.org/10.6028/NIST.SP.1800-5TECHNOLOGY PARTNERS/COLLABORATORS Organizations participating in this project submitted their capabilities in response to an open call in the Federal Register for all sources of relevant security capabilities from academia and industry (vendors and integrators). The following respondents with relevant capabilities or product components (identified as “Technology Partners/Collaborators” herein) signed a Cooperative Research and Development Agreement (CRADA) to collaborate with NIST in a consortium to build this example solution. Certain commercial entities, equipment, products, or materials may be identified by name or company logo or other insignia in order to acknowledge their participation in this collaboration or to describe an experimental procedure or concept adequately. Such identification is not intended to imply special status or relationship with NIST or recommendation or endorsement by NIST or NCCoE, neither is it intended to imply that the entities, equipment, products, or materials are necessarily the best available for the purpose. The National Cybersecurity Center of Excellence (NCCoE), a part of the LEARN MORE National Institute of Standards and Technology (NIST), is a collaborative Visit https://www.nccoe.nist.gov hub where industry organizations, government agencies, and academic nccoe@nist.gov institutions work together to address businesses’ most pressing 301-975-0200 cybersecurity challenges. Through this collaboration, the NCCoE develops modular, easily adaptable example cybersecurity solutions demonstrating how to apply standards and best practices using commercially available technology. NIST SP 1800-5A: IT Asset Management 3 This publication is available free of charge from: http://doi.org/10.6028/NIST.SP.1800-5NIST SPECIAL PUBLICATION 1800-5B IT Asset Management Volume B: Approach, Architecture, and Security Characteristics Michael Stone Leah Kauffman, Editor-in-Chief National Cybersecurity Center of Excellence Information Technology Laboratory Chinedum Irrechukwu Harry Perper Devin Wynne The MITRE Corporation McLean, VA September 2018 This publication is available free of charge from: http://doi.org/10.6028/NIST.SP.1800-5 The first draft of this publication is available free of charge from: https://www.nccoe.nist.gov/sites/default/files/library/sp1800/fs-itam-nist-sp1800-5-draft.pdfDISCLAIMER Certain commercial entities, equipment, products, or materials may be identified in this document in T sih order to describe an experimental procedure or concept adequately. Such identification is not intended p u to imply recommendation or endorsement by NIST or NCCoE, nor is it intended to imply that the b acil entities, equipment, products, or materials are necessarily the best available for the purpose. t oi n si a v a ali b el rf e e o c f National Institute of Standards and Technology Special Publication 1800-5B, Natl. Inst. Stand. Technol. h a r Spec. Publ. 1800-5B, 47 pages, (September 2018), CODEN: NSPUE2 g e rf mo : h t pt /: / d o o.i r g / 1 FEEDBACK 0 6. 0 2 8 As a private-public partnership, we are always seeking feedback on our Practice Guides. We are / N SI particularly interested in seeing how businesses apply NCCoE reference designs in the real world. If you T PS. have implemented the reference design, or have questions about applying it in your environment, 1. 8 please email us at financial_nccoe@nist.gov. 0 0 -5 . All comments are subject to release under the Freedom of Information Act (FOIA). National Cybersecurity Center of Excellence National Institute of Standards and Technology 100 Bureau Drive Mailstop 2002 Gaithersburg, MD 20899 Email: nccoe@nist.gov NIST SP 1800-5B: IT Asset Management iNATIONAL CYBERSECURITY CENTER OF EXCELLENCE The National Cybersecurity Center of Excellence (NCCoE), a part of the National Institute of Standards T sih and Technology (NIST), is a collaborative hub where industry organizations, government agencies, and p u academic institutions work together to address businesses' most pressing cybersecurity issues. This b acil public-private partnership enables the creation of practical cybersecurity solutions for specific t noi industries, as well as for broad, cross-sector technology challenges. Through consortia under si a Cooperative Research and Development Agreements (CRADAs), including technology partners—from v a ali Fortune 50 market leaders to smaller companies specializing in IT security—the NCCoE applies standards b el and best practices to develop modular, easily adaptable example cybersecurity solutions using rf e commercially available technology. The NCCoE documents these example solutions in the NIST Special e o c f Publication 1800 series, which maps capabilities to the NIST Cyber Security Framework and details the h a steps needed for another entity to recreate the example solution. The NCCoE was established in 2012 by r g e rf NIST in partnership with the State of Maryland and Montgomery County, Md. o m : h To learn more about the NCCoE, visit https://www.nccoe.nist.gov. To learn more about NIST, visit t t p https://www.nist.gov. /: / d o o.i NIST CYBERSECURITY PRACTICE GUIDES r g / 1 0 NIST Cybersecurity Practice Guides (Special Publication Series 1800) target specific cybersecurity 6. 0 2 challenges in the public and private sectors. They are practical, user-friendly guides that facilitate the 8 / N adoption of standards-based approaches to cybersecurity. They show members of the information SI T S. security community how to implement example solutions that help them align more easily with relevant P 1. standards and best practices, and provide users with the materials lists, configuration files, and other 8 0 0 information they need to implement a similar approach. -5 . The documents in this series describe example implementations of cybersecurity practices that businesses and other organizations may voluntarily adopt. These documents do not describe regulations or mandatory practices, nor do they carry statutory authority. ABSTRACT While a physical asset management system can tell you the location of a computer, it cannot answer questions like, “What operating systems are our laptops running?” and “Which devices are vulnerable to the latest threat?” An effective IT asset management (ITAM) solution can tie together physical and virtual assets and provide management with a complete picture of what, where, and how assets are being used. ITAM enhances visibility for security analysts, which leads to better asset utilization and security. KEYWORDS asset management; financial sector; information technology asset management; ITAM; personnel security; physical security; operational security NIST SP 1800-5B: IT Asset Management iiACKNOWLEDGMENTS We are grateful to the following individuals for their generous contributions of expertise and time. T h si p bu Name Organization cil a t oi n FS-ISAC Financial Services Information Sharing and Analysis Center si a v a ali Gorrell Cheek Western Union b el rf e e Joe Buselmeier American Express o c f h a gr Sean Franklin American Express e rf o m : h Ron Ritchey Bank of America t t p /: / d Sounil Yu Bank of America o o.i r g 1/ Joel Van Dyk Depository Trust & Clearing Corporation 0 6. 0 2 /8 Dan Schutzer Financial Services Roundtable N SI T S. P George Mattingly Navy Federal Credit Union 1. 8 0 0 -5 . Jimmie Owens Navy Federal Credit Union Mike Curry State Street Timothy Shea RSA Mark McGovern MobileSystem7 Atul Shah Microsoft Leah Kauffman NIST Benham (Ben) Shariati University of Maryland Baltimore County Valerie Herrington Herrington Technologies Susan Symington MITRE Corporation Sallie Edwards MITRE Corporation NIST SP 1800-5B: IT Asset Management iiiName Organization T h Sarah Weeks MITRE Corporation si p u b cil Lina Scorza MITRE Corporation a t oi n a si Karen Scarfone Scarfone Cybersecurity v a bali el rf The Technology Partners/Collaborators who participated in this build submitted their capabilities in e o e response to a notice in the Federal Register. Respondents with relevant capabilities or product c f components were invited to sign a Cooperative Research and Development Agreement (CRADA) with h a gr NIST, allowing them to participate in a consortium to build this example solution. We worked with: e rf o m : h Technology Partner/Collaborator Build Involvement t t p /: / d AlphaPoint Technology AssetCentral o o.i r g / 1 Belarc BelManage, BelManage Analytics 0 6. 0 2 8 N/ Computer Associates ITAM SI T S. P 1. Microsoft WSUS, Server 2012R2 Certificate Authority 8 0 0 -5 . Peniel Solutions Technology/Industry Expertise PI Achievers Penetration Testing Services PuppetLabs Puppet RedJack Fathom Splunk Splunk Enterprise Tyco iStar Edge Vanguard Integrity Professionals Security Manager NIST SP 1800-5B: IT Asset Management ivContents T 1 Summary ............................................................................................ 1 h si p u 1.1 Challenge ....................................................................................................................... 1 b cil a t 1.2 Solution .......................................................................................................................... 2 oi n si 1.3 Risks ............................................................................................................................... 2 a v a ali 1.4 Benefits .......................................................................................................................... 3 b el rf 2 How to Use This Guide ........................................................................ 4 e e o c f 2.1 Typographic Conventions .............................................................................................. 6 h a r eg 3 Introduction ........................................................................................ 6 rf o m : h 4 Approach ............................................................................................ 7 t t p /: 4.1 Audience ........................................................................................................................ 7 / d o o.i 4.2 Scope ............................................................................................................................. 7 r g / 01 4.3 Assumptions .................................................................................................................. 8 6. 0 82 4.3.1 Security ......................................................................................................................... 8 / N SI 4.3.2 Modularity .................................................................................................................... 8 T S. 1.P 4.3.3 Technical Implementation ............................................................................................ 8 8 0 0 4.3.4 Tracking and Location ................................................................................................... 8 -5 . 4.3.5 Operating Systems ........................................................................................................ 8 4.4 Constraints .................................................................................................................... 9 4.4.1 Limited Scalability Testing ............................................................................................. 9 4.4.2 Limited Assets ............................................................................................................... 9 4.4.3 Mobile Devices .............................................................................................................. 9 4.4.4 Network Devices ........................................................................................................... 9 4.4.5 Limited Replication of Enterprise Network................................................................. 10 4.5 Risk Assessment and Mitigation .................................................................................. 10 4.5.1 Assessing Risk Posture ................................................................................................ 11 4.5.2 Security Characteristics and Controls Mapping .......................................................... 12 4.6 Technologies ................................................................................................................ 23 NIST SP 1800-5B: IT Asset Management v5 Architecture ...................................................................................... 27 5.1 Reference Architecture Description ............................................................................ 27 T h p si 5.2 Reference Architecture Relationship .......................................................................... 32 u b cil 5.3 Building an Instance of the Reference Architecture ................................................... 33 a t noi 5.3.1 ITAM Build ................................................................................................................... 33 si va 5.3.2 Access Authorization Information Flow and Control Points ....................................... 37 a ali b 5.3.3 Tier 1 Systems ............................................................................................................. 39 el erf 5.3.4 Tier 2 Systems ............................................................................................................. 39 e o c f 5.3.5 Tier 3 Systems ............................................................................................................. 42 h a r eg Appendix A List of Acronyms ................................................................. 45 rf o m : h Appendix B References ......................................................................... 46 t t p /: / d o o.i List of Figures r g / 1 0 6. Figure 5-1 Reference Architecture ...................................................................................................... 28 0 2 8 N/ Figure 5-2 ITAM Reference Functionality ............................................................................................ 29 SI T PS. Figure 5-3 Typical Asset Lifecycle  ................................................................................................ 30 1. 8 00 Figure 5-4 ITAM Build ......................................................................................................................... 34 -5 . Figure 5-5 DMZ Network .................................................................................................................... 35 Figure 5-6 Network Security Network ................................................................................................ 35 Figure 5-7 IT Systems Network ........................................................................................................... 36 Figure 5-8 Physical Security Network ................................................................................................. 36 Figure 5-9 Physical Asset Management .............................................................................................. 37 Figure 5-10 ITAM Data Flow ............................................................................................................... 38 List of Tables Table 4-1 Security Characteristics and Controls Mapping ................................................................... 13 Table 4-2 Products and Technologies ................................................................................................. 23 NIST SP 1800-5B: IT Asset Management vi1 Summary T Companies in the financial services sector can use this NIST Cybersecurity Practice Guide to more h p si securely and efficiently monitor and manage their organization's many information technology (IT) u cilb assets. IT asset management (ITAM) is foundational to an effective cybersecurity strategy and is a t prominently featured in the SANS Critical Security Controls  and NIST Framework for Improving oi n si Critical Infrastructure Cybersecurity . a v a ali During the project development, we focused on a modular architecture that would allow organizations b el to adopt some or all of the example capabilities in this practice guide. Depending on factors like size, rf e sophistication, risk tolerance, and threat landscape, organizations should make their own e o c f determinations about the breadth of IT asset management capabilities they need to implement. h a r eg This example solution is packaged as a “How-To” guide that demonstrates how to implement standards- orf based cybersecurity technologies in the real world with a risk-based approach. We used open-source m : h and commercial off-the-shelf (COTS) products that are currently available today. The guide helps t t p organizations gain efficiencies in IT asset management, while saving them research and proof of concept /: / od costs. o.i r /g This guide aids those responsible for tracking assets, configuration management, and cybersecurity in a 1 0 6. financial services sector enterprise. Typically, this group will comprise those who possess procurement, 0 2 8 implementation, and policy authority. / N SI T S. 1.1 Challenge P 1. 8 00 The security engineers we consulted in the financial services sector told us they are challenged by -5 . identifying assets across the enterprise and keeping track of their status and configurations, including hardware and software. This comprises two large technical issues: 1. tracking a diverse set of hardware and software. Examples of hardware include servers, workstations, and network devices. Examples of software include operating systems, applications, and files. 2. lack of total control by the host organization. Financial services sector organizations can include subsidiaries, branches, third-party partners, contractors, temporary workers, and guests. It is impossible to regulate and mandate a single hardware and software baseline against such a diverse group. NIST SP 1800-5B: IT Asset Management 11.2 Solution An effective ITAM solution needs several characteristics, including: T h p si ▪ complement existing asset management, security, and network systems u b cil ▪ provide application programming interfaces to communicate with other security devices and a t oi systems such as firewalls and intrusion detection and identity and access management systems n si a ▪ know and control which assets, both virtual and physical, are connected to the enterprise v a ali network b el rf ▪ automatically detect and alert when unauthorized devices attempt to access the network, also e e known as asset discovery o c f h ▪ enable administrators to define and control the hardware and software that can be connected a r eg to the corporate environment rf o m ▪ enforce software restriction policies relating to what software is allowed to run in the corporate : h environment t t p //: ▪ record and track attributes of assets d o o.i ▪ audit and monitor changes in an asset's state and connection r g / 1 0 ▪ integrate with log analysis tools to collect and store audited information 6. 0 2 8 The ITAM solution developed and built at the NCCoE, and described in this document, meets all of these / N SI characteristics. T S. P 1. 8 1.3 Risks 0 0 -5 . In addition to being effective, the ITAM solution must also be secure and not introduce new vulnerabilities into an organization. To reduce this risk, the NCCoE used security controls and best practices from NIST , the Defense Information Systems Agency (DISA)  and International Organization for Standardization (ISO) , and the Federal Financial Institutions Examination Council (FFIEC). How these individual controls are met by individual components of this solution can be seen in Table 4-2. Some of the security controls we implemented include: ▪ access control policy ▪ continuous monitoring and tracking of assets connected to a network ▪ event auditing ▪ anomalous activity detection and reporting ▪ vulnerability scanning NIST SP 1800-5B: IT Asset Management 2By implementing an ITAM solution based on controls and best practices, implementers can tailor their deployment to their organization's security risk assessment, risk tolerance, and budget. T h si 1.4 Benefits p u b cil The build described here employs passive and active data collectors/sensors across an enterprise to a t oi gather asset information and send it to a centralized location. The data collectors/sensors specialize in n si gathering information from different devices, no matter their operating system. Machines used by direct a v a employees receive software agents that report on configuration, while temporary employees and ali elb contractors receive “dissolvable” agents and more passive sensing. Dissolvable agents are automatically erf downloaded to the client, run, and are removed. All of this information is gathered at a central location e o for analysis and reporting. You can choose to view all the activity in an enterprise, or configure the c f ah system to choose which machines are monitored, how much data is collected, and how long the data is r g e retained. rf o m : h The example solution described in this guide has the following benefits: t t p /: ▪ enables faster responses to security alerts by revealing the location, configuration, and owner of / d o a device o.i r /g ▪ increases cybersecurity resilience: help security analysts focus on the most valuable or critical 1 0 6. assets 0 2 /8 ▪ improves and reduces reporting time for management and auditing N SI S.T ▪ provides software license utilization statistics (to identify cost reduction opportunities) P 1. 8 ▪ reduces help desk response times: staff already know what is installed and the latest pertinent 0 0 -5 errors and alerts . ▪ reduces the attack surface of machines by ensuring that software is correctly patched/updated Other potential benefits include, but are not limited to rapid, transparent deployment and removal using consistent, efficient, and automated processes; improved situational awareness; and an improved security posture gained from tracking and auditing access requests and other ITAM activity across all networks. This NIST Cybersecurity Practice Guide: ▪ maps security characteristics to guidance and best practices from NIST and other standards organizations as well as the Federal Financial Institutions Examination Council IT Examination Handbook and Cyber Assessment Tool (CAT) guidance ▪ provides • a detailed example solution with capabilities that address security controls NIST SP 1800-5B: IT Asset Management 3• instructions for implementers and security engineers, including examples of all the necessary components and installation, configuration, and integration T ▪ is modular and uses products that are readily available and interoperable with your existing IT h si p infrastructure and investments u b cil Your organization can be confident that these results can be replicated: We performed functional a t oi testing and submitted the entire build to verification testing. An independent second team verified the n a si build documentation based on the information in this practice guide. v a ali While we have used a suite of open source and commercial products to address this challenge, this b el rf guide does not endorse these particular products, nor does it guarantee regulatory compliance. Your e o e organization's information security experts should identify the standards-based products that will best c f integrate with your existing tools and IT system infrastructure. Your company can adopt this solution or h a gr one that adheres to these guidelines in whole, or you can use this guide as a starting point for tailoring e rf and implementing parts of a solution. o m : h t pt 2 How to Use This Guide /: / d o o.i This National Institute of Standards and Technology (NIST) Cybersecurity Practice Guide demonstrates a r g / standards-based reference design and provides users with the information they need to replicate all or 1 0 6. parts of the build created in the NCCoE ITAM Lab. This reference design is modular and can be deployed 0 2 8 in whole or in part. / N SI S.T This guide contains three volumes: P 1. 08 ▪ NIST SP 1800-5A: Executive Summary 0 -5 . ▪ NIST SP 1800-5B: Approach, Architecture, and Security Characteristics – what we built and why (you are here) ▪ NIST SP 1800-5C: How-To Guides – instructions for building the example solution Depending on your role in your organization, you might use this guide in different ways: Financial services sector leaders, including chief security and technology officers, will be interested in the Executive Summary, NIST SP 1800-5A, which describes the following topics: ▪ challenges that financial services sector organizations face in implementing and using ITAM systems ▪ example solution built at the NCCoE ▪ benefits of adopting a secure, centralized ITAM system, and the risks of a lack of visibility into networked IT assets NIST SP 1800-5B: IT Asset Management 4Technology or security program managers who are concerned with how to identify, understand, assess, and mitigate risk will be interested in this part of the guide, NIST SP 1800-5B, which describes what we did and why. The following sections will be of particular interest: T h si up ▪ Section 4.5, Risk Assessment and Mitigation, where we identify the steps we took to protect and b cil monitor the ITAM system a t oi n ▪ Section 4.5.1, Assessing Risk Posture, where we identify the security measures used in this si a implementation v a ali ▪ Section 4.5.2, Security Characteristics and Controls Mapping, where we map the security b rf el characteristics of this example solution to cybersecurity standards and best practices e e o ▪ Section 4.6, Technologies, where we identify the products and technologies we used and map hc f them to the relevant security controls a r g rf e You might share the Executive Summary, NIST SP 1800-5A, with your leadership team members to help o m them understand the importance of adopting standards-based IT Asset Management (ITAM) which is : th foundational to an effective cybersecurity strategy and is prominently featured in the SANS Critical t p /: Security Controls  and NIST Framework for Improving Critical Infrastructure Cybersecurity . / d o o.i IT professionals who want to implement an approach like this will find the whole practice guide useful. r g 1/ You can use the How-To portion of the guide, NIST SP 1800-5C, to replicate all or parts of the build 0 06. created in our lab. The How-To portion of the guide provides specific product installation, configuration, 2 8 / and integration instructions for implementing the example solution. We do not recreate the product N TSI manufacturers’ documentation, which is generally widely available. Rather, we show how we S. P incorporated the products together in our environment to create an example solution. 1. 8 0 0 -5 This guide assumes that IT professionals have experience implementing security products in financial . services sector organizations. While we have used a suite of commercial products to address this challenge, this guide does not endorse these particular products. Your organization can adopt this solution or one that adheres to these guidelines in whole, or you can use this guide as a starting point for tailoring and implementing parts of IT Asset Management (ITAM) which is foundational to an effective cybersecurity strategy and is prominently featured in the SANS Critical Security Controls  and NIST Framework for Improving Critical Infrastructure Cybersecurity . Your organization’s security experts should identify the products that will best integrate with your existing tools and IT system infrastructure. We hope that you will seek products that are congruent with applicable standards and best practices. Section 4.6, Technologies, lists the products we used and maps them to the cybersecurity controls provided by this reference solution. A NIST Cybersecurity Practice Guide does not describe “the” solution, but a possible solution. Comments, suggestions, and success stories will improve subsequent versions of this guide. Please contribute your thoughts to financial_nccoe@nist.gov, and join the discussion at http://nccoe.nist.gov/forums/financial-services. NIST SP 1800-5B: IT Asset Management 52.1 Typographic Conventions The following table presents typographic conventions used in this volume. T h si p u Typeface/Symbol Meaning Example b cil a Italics file names and path names; For detailed definitions of terms, see t oi n references to documents that the NCCoE Glossary. si a are not hyperlinks; new v a ali terms; and placeholders b el Bold names of menus, options, Choose File > Edit. rf e command buttons, and fields e c fo Monospace command-line input, mkdir h a on-screen computer output, r g e sample code examples, and rf o status codes m : h Monospace Bold command-line user input service sshd start t t p contrasted with computer /: / d output o o.i blue text link to other parts of the All publications from NIST’s NCCoE r g 1/ document, a web URL, or an are available at 0 6. email address https://www.nccoe.nist.gov. 0 2 8 / N SI 3 Introduction T S. P 1. 8 In order for financial services sector institutions to make informed, business-driven decisions regarding 0 0 -5 their assets, they must first know what assets they possess, and their status. This information provides . the visibility into license utilization, software support costs, unauthorized devices, vulnerabilities, and compliance. IT assets include items such as servers, desktops, laptops, and network appliances. Technology and policy constraints make it difficult to collect and analyze IT asset data in a large enterprise composed of multiple organizations (subsidiaries and partners) spread out over diverse geographic locations. While many financial services sector companies label physical assets with bar codes and track them in a database, this approach does not answer questions such as, “What operating systems are our laptops running?” and “Which devices are vulnerable to the latest threat?” The goal of this project is to create an integrated system that can quickly provide answers to questions like these by connecting existing systems for physical assets, physical security, IT systems, and network security into a comprehensive ITAM system. Another key consideration is the need for companies to demonstrate compliance with industry and regulatory standards. NIST SP 1800-5B: IT Asset Management 6In our lab at the NCCoE, we constructed an ITAM solution that spans traditional physical asset tracking, IT asset information, physical security, and vulnerability and compliance information. Users can now query one ITAM system and gain insight into all four of these types of information regarding their entire T h si IT asset portfolio. p u b cil Financial sector companies can employ this ITAM system to dynamically apply business and security a t oi rules to better utilize information assets and protect enterprise systems and data. In short, the ITAM n a si system described in this practice guide gives companies the ability to monitor and report on an IT asset v a throughout its entire life cycle, thereby reducing the total cost of ownership by reducing the number of ali b el man-hours needed to perform tasks such as incident response and system patching. rf e e o 4 Approach c f h a r g e rf 4.1 Audience o m : h This guide is intended for individuals responsible for implementing IT security solutions in financial t t /:p services organizations. Current decentralized systems often require connecting to multiple systems / d o (assuming you have access), performing multiple queries, and then assembling a report. This centralized o.i r ITAM system provides data and metadata analysis, data aggregation, and reporting and alerting, all from g / 01 an automated platform. The technical components will appeal to system administrators, IT managers, IT 6. 0 security managers, and others directly involved in the secure and safe operation of business operations 2 8 N/ and IT networks. SI T S. 1.P 4.2 Scope 8 0 0 -5 The scope of this guide encompasses the implementation of numerous products to centralize IT asset . management. The scope concentrates on centralizing the following capabilities: 1. receiving a new physical IT asset 2. transferring a physical IT asset 3. migrating a virtual machine 4. detecting, preventing, and responding to incidents 5. continuously monitoring for unapproved hardware and software 6. continuously monitoring for vulnerabilities and applying corporate-approved patches/updates The objective is to perform all of the above actions using a centralized system with interfaces designed for each task. NIST SP 1800-5B: IT Asset Management 74.3 Assumptions This project is guided by the assumptions described in the following subsections. T h si up 4.3.1 Security b cil ta This ITAM system provides numerous security benefits including increased visibility and faster oi n si remediation. We assert that the benefits of using this ITAM system outweigh any additional risks that a v may be introduced. A key assumption is that all potential adopters of the build or any of its components a ali already have system and network security in place. Therefore, we focused on what potential new b el rf vulnerabilities were being introduced to systems if the solution (or any part of the solution) was e o e implemented. One of the goals of this solution is to not introduce additional vulnerabilities, however c f there are always risks when adding systems, or adding new features into an existing system. h a r g e rf 4.3.2 Modularity o m : h Financial services sector companies already have ITAM solution(s) in place. Our philosophy is that a t t p /: combination of certain components or a single component can improve ITAM functions for an / d o organization, and that they need not remove or replace existing infrastructure. This guide provides a o.i gr complete top-to-bottom solution and is also intended to provide various options based on need. / 1 0 6. 0 4.3.3 Technical Implementation 2 8 / N SI This practice guide is written from a “how-to” perspective, and its foremost purpose is to provide details T PS. on how to install, configure, and integrate the components. The NCCoE assumes that an organization has 1. 8 the technical resources to implement all or parts of the build, or has access to companies that can 0 0 -5 perform the implementation on its behalf. . 4.3.4 Tracking and Location The ITAM system described in this guide can provide an organization with location information for specific assets. This location information is typically in the form of building, room number, rack number, etc. The location information is usually manually entered into one or more asset databases. The location information in this project is not obtained via the global positioning system or other wireless/radio frequency tracking. 4.3.5 Operating Systems This project uses Ubuntu Linux, CentOS Linux, RedHat Enterprise Linux, Windows Server 2012R2, and Windows 7 operating systems. Operating systems were chosen based on the requirements of the software. For example, BelManage and CA ITAM need to run on Windows 2012R2. NIST SP 1800-5B: IT Asset Management 8Operating systems were securely configured based on the Department of Defense standard configuration guidance known as the Security Technical Implementation Guidelines (STIGs) and Security Requirements guides. They are publicly available at http://iase.disa.mil/stigs/Pages/index.aspx. Each T h si STIG includes a set of rules and guidelines for configuring the operating system implementation. For p u b example, the Microsoft Windows 2012R2 STIG (http://iase.disa.mil/stigs/os/windows/Pages/index.aspx) cil a was used to configure the Windows servers used in the build. The specific percentage of STIG t oi n compliance for each operating system used in the build is listed in NIST SP 1800-5C of this publication, si va How-To Guides. Note that the lab instantiation of the build did not require or allow implementation of a ali every rule and guide in each STIG. b el rf ee 4.4 Constraints o c f ah This project has the constraints described in the following subsections. r g e rf o 4.4.1 Limited Scalability Testing m : h tt The NCCoE is a laboratory environment and is, therefore, constrained in terms of replicating a sizeable p /: / user base, such as that in most financial services sector companies. However, the products used in the d o o.i build do not have that constraint and are designed for enterprise deployments. r g / 1 0 6. 4.4.2 Limited Assets 0 2 8 N/ The NCCoE lab has access to a limited number and variety of IT assets. The assets at the NCCoE were SI T included in the ITAM system, and the components used in the build do not have a limitation on the S. P 1. amount or variety of assets. 8 0 0 -5 . 4.4.3 Mobile Devices Due to scoping constraints, mobile devices were not included in the ITAM project. The NCCoE has several other projects dealing with mobile device security and management that can be used in conjunction with this ITAM project. For more information, please visit the NCCoE’s Mobile Device Security project page: https://nccoe.nist.gov/projects/building_blocks/mobile_device_security. 4.4.4 Network Devices The ITAM lab is almost totally composed of virtual machines. Some of the virtual machines are performing the duties of network devices, such as routers, firewalls, and switches. Where possible, the configurations and data collected by these devices are used by the ITAM system. NIST SP 1800-5B: IT Asset Management 94.4.5 Limited Replication of Enterprise Network The NCCoE was able to replicate the physical asset, physical security, IT systems, and network security T h silos in a limited manner. The goal was to demonstrate both logically and physically that functions could si up be performed from a centralized ITAM system regardless of where it is located in the enterprise. In a b cil real-world environment, the interconnections between the silos are fully dependent on the business a t oi needs and compliance requirements of the individual enterprise. We did not attempt to replicate these n a si interconnections. Rather, we acknowledge that implementing the project build or its components would v alia create new interfaces across silos. We focused on providing general information on how to remain within b el the bounds of compliance should the build be adopted. rf e e o 4.5 Risk Assessment and Mitigation c f h a gr NIST Special Publication (SP) 800-30, Guide for Conducting Risk Assessments , states that risk is “a e rf measure of the extent to which an entity is threatened by a potential circumstance or event, and o m : h typically a function of (i) the adverse impacts that would arise if the circumstance or event occurs and t pt (ii) the likelihood of occurrence.” The guide further defines risk assessment as “the process of /: / d identifying, estimating, and prioritizing risks to organizational operations (including mission, functions, o o.i image, reputation), organizational assets, individuals, other organizations, and the Nation, resulting r g 1/ from the operation of an information system. Part of risk management incorporates threat and 0 6. vulnerability analyses, and considers mitigations provided by security controls planned or in place.” 0 2 8 / N The NCCoE recommends that any discussion of risk management, particularly at the enterprise level, SI T S. begins with a comprehensive review of NIST SP 800-37, Guide for Applying the Risk Management P 1. Framework to Federal Information Systems —material that is available to the public. The risk 8 0 0 -5 management framework (RMF) guidance, as a whole, proved to be invaluable in giving us a baseline to . assess risks, from which we developed the project, the security characteristics of the build, and this guide. We performed two types of risk assessment: the initial analysis of the risk posed to the financial sector, which led to the creation of the use case and the desired security characteristics, and an analysis to show users how to manage the cybersecurity risk to the components introduced by adoption of the solution. In order to effectively enforce and audit security policy, an organization must first know what equipment and software are present. For example, knowing what hardware and software are present is the first step to enabling application whitelisting or blacklisting, and network access controls. The ability to view the status and configuration of everything in an organization from one centralized location is a very powerful tool that could result in disaster if it were to fall into the wrong hands. Therefore, the ITAM system must be extremely well protected and monitored. In response, we implemented access controls, network access restrictions, network monitoring, secure data transmission, configuration NIST SP 1800-5B: IT Asset Management 10management, and user activity monitoring. Section 4.5.2 provides a security evaluation of the architecture and a list of the security characteristics. T h si 4.5.1 Assessing Risk Posture p u b cil Using the guidance in NIST's series of publications concerning the RMF, the NCCoE performed two key a oit activities to identify the most compelling risks encountered by organizations within the financial sector. n si The first was a face-to-face meeting with members of the financial sector community to define the main a v a security risks to business operations. This meeting identified a primary risk concern: the lack of a ali b converged view and reporting capability for IT assets. We then identified the core risk area, ITAM, and el rf established the core operational risks encountered daily in this area. The following associated tactical e e o risks were identified: c f h a r ▪ lack of knowledge of the IT asset locations g e orf ▪ lack of configuration controls for IT assets m : th ▪ ineffective patch management t p /: / d ▪ lack of software vulnerability management o ro.i ▪ lack of a common operating picture of the enterprise's IT assets g / 1 6.0 ▪ lack of a converged repository of IT assets 0 2 8 The phone interviews with members of the financial sector gave us a better understanding of the / N SI business risks as they relate to the potential cost and business value. NIST SP 800-39, Managing T S. P Information Security Risk , focuses particularly on the business aspect of risk, namely at the 1. 08 enterprise level. This foundation is essential for any further risk analysis, risk response/mitigation, and 0 -5 risk monitoring activities. The following is a summary of the strategic risks: . ▪ impact on service delivery – ensuring people have access to systems needed to perform their job functions in the security operations organization ▪ cost of implementation – implementing ITAM once and using it across all systems may reduce both system management and operational costs. Reuse of existing systems where possible ▪ budget expenditure as it relates to investment in security technologies ▪ projected cost savings and operational efficiencies to be gained as a result of new investment in security ▪ compliance with existing industry standards – FFIEC CAT requires deliberate and timely control of IT assets. ▪ high-quality reputation or public image ▪ risk of alternative or no action NIST SP 1800-5B: IT Asset Management 11Undertaking these activities in accordance with the NIST RMF guidance yielded the necessary operational and strategic risk information, which was subsequently translated to security characteristics. Table 4-1 illustrates the mapping of these characteristics to NIST's SP 800-53 Rev. 4  controls, along T h si with the Cybersecurity Assessment Tool (CAT) and other security controls and best practices. p u b cil Implementing these security controls will substantially lower overall cyber-risk by providing mitigations a t oi against known cyber threats. Having a comprehensive ITAM system in place, like the one in this n a si document, enables the effective implementation of other mitigations such as application v a whitelisting/blacklisting, and network access controls. A full list of the security technologies used to ali b el implement this reference architecture can be found in Table 4-2. rf e e o 4.5.2 Security Characteristics and Controls Mapping c f h a r Table 4-1 maps the project’s security characteristics to the NIST Framework for Improving Critical g e rf Infrastructure Cybersecurity (CSF), relevant NIST standards, Federal Financial Institution Examination o m : h Council Cybersecurity Assessment Tool (FFIEC CAT), and best practices. The mapping in Table 4-1 comes tt from the white paper we drafted when we initially defined this challenge . p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 12Table 4-1 Security Characteristics and Controls Mapping T Financial Sector p sih Cybersecurity Standards and Best Practices Best Practices u b cil a t Cybersecurity Cybersecurity oi Cybersecurity Framework NIST 800-53 IEC/ISO27001 va si n Security Characteristics F Fr ua nm cte iow no [r 2k ] F Cr aa tm ege ow ryo r [k 2 ] Subcategory    FFIEC CAT a ali b el complement existing Identify Business Envi- ID.BE-4 Dependencies and criti- SA-14 D1.G.IT.B.2 rf e asset management, se- ronment cal functions for delivery of crit- e c fo curity, and network sys- ical services are established ah tems r eg rf o m : h t t /:p / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 13Financial Sector Cybersecurity Standards and Best Practices Best Practices T h si up Cybersecurity Cybersecurity b Cybersecurity Framework NIST 800-53 IEC/ISO27001 cil Security Characteristics Framework Framework FFIEC CAT a Subcategory    oit Function  Category  n si a v Protect Access Con- PR.AC-5: Network integrity is AC-4, AC-16 A.13.1.1, D3.DC.Im.B.1, a ali trol protected, incorporating net- A.13.1.3, D3.DC.Im.Int.1 b rf el work segregation where appro- A.13.2.1 e e priate o c f h a r g e rf o m : h t t /:p / d o o.i r g / 1 0 6. 0 2 8 / N SI S.T P 1. 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 14Financial Sector Cybersecurity Standards and Best Practices Best Practices T h si up Cybersecurity Cybersecurity b Cybersecurity Framework NIST 800-53 IEC/ISO27001 cil Security Characteristics Framework Framework FFIEC CAT a Subcategory    oit Function  Category  n si va provide APIs for com- Detect Anomalies DE.AE-3: Event data are aggre- AU-6, CA-7, D3.DC.Ev.E.1 a ali municating with other and Events gated and correlated from mul- IR-5, SI-4 b rf el security devices and tiple sources and sensors e e systems such as fire- o c f walls and intrusion de- h ra tection and identity and g e rf access management o m (IDAM) systems : h t t /:p / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 15Financial Sector Cybersecurity Standards and Best Practices Best Practices T h si up Cybersecurity Cybersecurity b Cybersecurity Framework NIST 800-53 IEC/ISO27001 cil Security Characteristics Framework Framework FFIEC CAT a Subcategory    oit Function  Category  n si a v Detect Detection DE.DP-4: Event detection infor- AU-6, CA-7, A.16.1.2 D3.DC.Ev.B.2, a ali Processes mation is communicated to ap- RA-5, SI-4 D5.ER.Is.B.1, b rf el propriate parties D5.ER.Is.E.1 e e o c f h a r g e rf o m : h t t /:p / d o o.i r know and control which Identify Asset Man- ID.AM-1: Physical devices and CA-7 A.8.1.1 D1.G.IT.B.1 g / 1 assets, both virtual and agement systems within the organization 0 6. 0 physical, are connected are inventoried 2 8 / N SI Identify Asset Man- ID.AM-2: Software platforms CM-8, SA-14, A.8.1.1 D1.G.IT.B.1 T S. agement and applications within the or- CA-7, CM-8, P 1. ganization are inventoried PE-20, SI-4 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 16Financial Sector Cybersecurity Standards and Best Practices Best Practices T h si up Cybersecurity Cybersecurity b Cybersecurity Framework NIST 800-53 IEC/ISO27001 cil Security Characteristics Framework Framework FFIEC CAT a Subcategory    oit Function  Category  n si va to the enterprise net- Identify Asset Man- ID.AM-5: Resources are priori- IA-3 A.8.2.1 D1.G.IT.B.2 a ali work agement tized based on their classifica- b rf el tion, criticality and business e e value o c f h Detect Security Con- DE.CM-7: Monitoring for unau- PE-6, SC-7, D3.DC.Ev.B.3 a r eg tinuous Moni- thorized personnel, connec- SC-30, SC-32 orf toring tions, devices and software is m : h performed t t p /: / d o o.i r g / 1 0 06. detect and alert when Detect Anomalies DE.AE-3: Event data are aggre- AU-2, AU-6, D3.DC.Ev.E.1 2 8 / unauthorized devices and Events gated and correlated from mul- CA-7, IR-4, N SI attempt to access the tiple sources and sensors IR-5, SI-4 T S. P network 1. Detect Security Con- DE.CM-1: The network is moni- AU-12, CA-7, D3.DC.An.B.2 8 0 0 tinuous Moni- tored to detect potential cyber- SC-7, SI-4 -5 . toring security events NIST SP 1800-5B: IT Asset Management 17Financial Sector Cybersecurity Standards and Best Practices Best Practices T h si up Cybersecurity Cybersecurity b Cybersecurity Framework NIST 800-53 IEC/ISO27001 cil Security Characteristics Framework Framework FFIEC CAT a Subcategory    oit Function  Category  n si va Detect Security Con- DE.CM-7: Monitoring for unau- CM-8, PE-6, D3.DC.Ev.B.3 a ali tinuous Moni- thorized personnel, connec- PE-20, SI-4, b rf el toring tions, devices and software is AU-12 e e performed o c f h Protect Protective PR.PT-1: Audit/log records are IA-3, IR-6 A.12.4.1, D1.G.SP.B.3, a r eg Technology determined, documented, im- A.12.4.3 D2.MA.Ma.B.1, orf plemented and reviewed in ac- D2.MA.Ma.B.2 m : h cordance with policy t t p //: integrate with ways to Identify Asset Man- ID.AM-2: Software platforms AU-2 A.8.1.1 D1.G.IT.B.1 d o.io validate a trusted net- agement and applications within the or- gr work connection ganization are inventoried / 1 0 06. Identify Asset Man- ID.AM-5: Resources are priori- CM-8, CA-7 A.8.1.1 D1.G.IT.B.1 2 /8 agement tized based on their classifica- N SI tion, criticality and business T PS. value 1. 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 18Financial Sector Cybersecurity Standards and Best Practices Best Practices T h si up Cybersecurity Cybersecurity b Cybersecurity Framework NIST 800-53 IEC/ISO27001 cil Security Characteristics Framework Framework FFIEC CAT a Subcategory    oit Function  Category  n si a v Identify Asset Man- ID.AM-5: Resources are priori- SA-14, IA-3 A.8.2.1 D1.G.IT.B.2 a ali agement tized based on their classifica- b rf el tion, criticality and business e e value o c f h Protect Protective PR.PT-1: Audit/log records are AU-6, IR-5, A.12.4.1, D1.G.SP.B.3 a r eg Technology determined, documented, im- IR-6 A.12.4.3 orf plemented, and reviewed in ac- m : h cordance with policy t t p //: Protect Data Security PR.DS-2: Data-in-transit is pro- SC-8 A.13.1.1, D3.PC.Am.B.13, d o.io tected A.13.2.1, D3.PC.Am.E.5, gr A.14.1.2 D3.PC.Am.Int.7 / 1 0 06. Detect Security Con- DE.CM-7: Monitoring for unau- AU-12, CA-7, D3.DC.Ev.B.3 2 /8 tinuous Moni- thorized personnel, connec- CM-8, PE-3, N SI toring tions, devices and software is PE-6, PE-20, T PS. performed SI-4 1. 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 19Financial Sector Cybersecurity Standards and Best Practices Best Practices T h si up Cybersecurity Cybersecurity b Cybersecurity Framework NIST 800-53 IEC/ISO27001 cil Security Characteristics Framework Framework FFIEC CAT a Subcategory    oit Function  Category  n si a v Respond Communica- RS.CO-2: Events are reported AU-6, IR-6 A.16.1.2 D5.IR.Pl.B.2, a ali tions consistent with established cri- D5.DR.Re.B.4, b rf el teria D5.DR.Re.E.6, e e D5.ER.Es.B.4 o c f h enable administrators Identify Asset Man- ID.AM-1: Physical devices and CM-8, IA-3 A.8.1.1 D1.G.IT.B.1 a r eg to define and control agement systems within the organization orf the hardware and soft- are inventoried m : h ware that can be con- ptt nected to the corporate Identify Asset Man- ID.AM-2: Software platforms CM-8 A.8.1.1 D1.G.IT.B.1 //: d environment agement and applications within the or- o.io ganization are inventoried r g 1/ Detect Security Con- DE.CM-7: Monitoring for unau- AU-12, CA-7, D3.DC.Ev.B.3 0 06. tinuous Moni- thorized personnel, connec- CM-8, PE-3, 2 /8 toring tions, devices and software is PE-6, PE-20, N SI performed SI-4 T S. P 1. enforce software re- Protect Access Con- PR.AC-1: Identities and creden- CM-2, IA-3 D3.PC.Im.B.7, 8 0 0 striction policies relat- trol tials are managed for author- D3.PC.Am.B.6 -5 . ing to what software is ized devices, users (and soft- ware) NIST SP 1800-5B: IT Asset Management 20Financial Sector Cybersecurity Standards and Best Practices Best Practices T h si up Cybersecurity Cybersecurity b Cybersecurity Framework NIST 800-53 IEC/ISO27001 cil Security Characteristics Framework Framework FFIEC CAT a Subcategory    oit Function  Category  n si va allowed to run in the Protect Protective PR.PT-1: Audit/log records are AU-6, IR-5, A.12.4.1, D1.G.SP.B.3, a ali corporate environment Technology determined, documented, im- IR-6 A.12.4.3 D2.MA.Ma.B.1, b rf el plemented, and reviewed in ac- D2.MA.Ma.B.2 e e cordance with policy o c f h Detect Security Con- DE.CM-7: Monitoring for unau- AU-12, CA-7, D3.DC.Ev.B.3 a r eg tinuous Moni- thorized personnel, connec- CM-8, PE-3, orf toring tions, devices and software is PE-6, PE-20, m : h performed SI-4 t t p //: Identify Risk Assess- ID.RA-1: Asset vulnerabilities CA-7, CA-8, A.12.6.1, D2.TI.Ti.B.2, d o.io ment are identified and documented. RA-5, SI-2, A.18.2.3 D1.RM.RA.E.2 gr SI-4, SI-5 / 1 0 06. Identify Risk Assess- ID.RA-2: Threat and vulnerabil- PM-15, SI-5 A.6.1.4 D2.TI.Ti.B.1 2 /8 ment ity information is received from N SI information sharing forums and T PS. sources 1. 8 0 0 Respond Mitigate Vul- RS.MI-3: Newly identified vul- CA-7, RA-5 A.12.6.1 D1.RM.RA.E.1 -5 . nerabilities nerabilities are mitigated or documented as accepted risks NIST SP 1800-5B: IT Asset Management 21Financial Sector Cybersecurity Standards and Best Practices Best Practices T h si up Cybersecurity Cybersecurity b Cybersecurity Framework NIST 800-53 IEC/ISO27001 cil Security Characteristics Framework Framework FFIEC CAT a Subcategory    oit Function  Category  n si va record and track the Detect Security Con- DE.CM-7 Monitoring for unau- AU-12, CA-7, D3.DC.Ev.B.3 a ali prescribed attributes of tinuous Moni- thorized personnel, connec- CM-8, PE-20, b rf el assets toring tions, devices, and software is SI-4 e e performed o c f h audit and monitor Detect Security Con- DE.CM-7: Monitoring for unau- AU-12, CA-7, D3.DC.Ev.B.3 a r eg changes in the asset’s tinuous Moni- thorized personnel, connec- CM-8, PE-20, orf state and connection toring tions, devices and software is SI-4 m : h performed t t p //: Protect Protective PR.PT-1: Audit/log records are AU-6, IR-5, A.12.4.1, D1.G.SP.B.3, d o.io Technology determined, documented, im- IR-6, SI-4 A.12.4.3 D2.MA.Ma.B.1, gr plemented, and reviewed in ac- D2.MA.Ma.B.2 / 1 0 cordance with policy 6. 0 2 /8 integrate with log anal- Protect Protective PR.PT-1: Audit/log records are AU-6, IR-5, A.12.4.1, D1.G.SP.B.3, N SI ysis tools to collect and Technology determined, documented, im- IR-6, SI-4 A.12.4.3 D2.MA.Ma.B.1, T PS. store audited infor- plemented, and reviewed in ac- D2.MA.Ma.B.2 1. 8 mation cordance with policy 0 0 -5 . NIST SP 1800-5B: IT Asset Management 22Financial Sector Cybersecurity Standards and Best Practices Best Practices T h si up Cybersecurity Cybersecurity b Cybersecurity Framework NIST 800-53 IEC/ISO27001 cil Security Characteristics Framework Framework FFIEC CAT a Subcategory    oit Function  Category  n si a v does not introduce new Detect Security Con- DE.CM-8: Vulnerability scans RA-5 12.6.1 D3.DC.Th.E.5 a ali attack vectors into ex- tinuous Moni- are performed b rf el isting systems toring e e o c f 4.6 Technologies h a r g e rf Table 4-2 lists all of the technologies used in this project and provides a mapping among the generic application term, the specific product used, o m and the security control(s) that the product provides. The Architecture Location column refers to Figure 5-4, ITAM Build. : h t t p Table 4-2 Products and Technologies /: / d o o.i Architecture CSF NIST 800-53 gr Company Product Version Use 1/ Location Subcategory rev4 Controls 0 6. 0 AlphaPoint AssetCentral 2.1.1 Physical Stores and displays information on all ID.AM-1 CM-8 2 8 N/ Technology Build 1157 Asset Mgmt. physical assets in a data center. SI T S. RedJack Fathom 1.8.0 DMZ Collects and analyzes NetFlow data DE.CM-1 AU-12, CA7, P 1. and unencrypted banner information SC-7, SI-4 8 0 0 from network traffic to detect ma- -5 . chines and anomalies. NIST SP 1800-5B: IT Asset Management 23Architecture CSF NIST 800-53 Company Product Version Use Location Subcategory rev4 Controls hT N/A (open Bro 2.3.2 DMZ Monitors the network and reports on DE.CM-1 AU-12, CA-7, si p source) all connections. Also analyzes known SC-7, SI-4 u cilb bad IP addresses and misconfigured ta network settings. oi n si N/A (open Snort 2.9.6.0 DMZ Examines network traffic and gener- DE.CM-1 AU-12, CA-7, a av source) ates alerts based on signatures of SC-7, SI-4 bali known security issues. el rf Belarc BelManage 8.1.31 Network Collects information on the operating ID.AM-1 CM-8 e e o Security system and installed software. c f ID.AM-2 CM-8 h a r DE.CM-7 AU-12, CA-7, g e rf CM-2, CM-3, o m CM-8, PE-3, : h t PE-6, PE-20, t p /: SI-4 / d o o.i Belarc BelManage N/A Network Provides query capability and auto- DE.CM-7 AU-12, CA-7, r /g Analytics Security mated analytics for BelManage data. CM-2, CM-3, 1 6.0 CM-8, PE-3, 0 2 PE-6, PE-20, 8 / N SI-4 SI T S. PuppetLabs Puppet 8.3 IT Systems Provides configuration management, RS.MI-2 IR-4 P 081. enforcement and validation. ID.AM-2 CM-8 0 -5 . NIST SP 1800-5B: IT Asset Management 24Architecture CSF NIST 800-53 Company Product Version Use Location Subcategory rev4 Controls hT N/A (open OpenVAS 4.0.1 Network Scans machines for known vulnerabili- DE.CM-8 RA-5 si up source) Security ties. ID.RA-1 CA-7, CA-8, b cil RA-5, SI-2, SI-4, a t oi SI-5 n a si ID.RA-2 PM-15, PM-16, v alia SI-5 b el Splunk Splunk 6.2 ITAM Collects, stores and analyzes the IT as- ID.AM-1 CM-8 rf e Enterprise set data. e ID.AM-2 CM-8 o c f h DE.AE-3 AU-6, CA-7, a r g IR-4, IR-5, IR-8, e orf SI-4 m : h Microsoft WSUS 6.3.9600.1747 DMZ Provides patches and updates to Mi- RS.MI-2 IR-4 t t /:p 7 crosoft Windows machines. / d o.io Ubuntu Apt-Cache Apt DMZ Provides patches and updates to Ub- RS:MI-2 IR-4 gr 1.0.1ubuntu2 untu Linux machines. / 1 0 6. CA ITAM Physical Provides physical asset management. ID.AM-1 CM-8 0 82 Technologies Asset Mgmt. / N SI Tyco iStar Edge Physical Provides physical access management. PR.AC-1 AC-2, IA Family T PS. Security 1. 8 0 N/A (open Openswan U2.6.38 DMZ Provides secure access and transport PR.DS-2 SC-3 0 -5 source) to the off-site mainframe computer. . NIST SP 1800-5B: IT Asset Management 25Architecture CSF NIST 800-53 Company Product Version Use Location Subcategory rev4 Controls hT N/A (open pfSense 2.2.2 All Provides routing and network segrega- PR.AC-5 AC-4, SC-7 si p source) (6 instances) tion between all network segments. u b cil Vanguard Security N/A External Provides security alert information ID.AM-1, CM-8 a t oi Integrity Manager from mainframe assets ID.AM-2 n si Professionals a v alia Microsoft Server Server2012R2 IT Systems Provide certificates and PKI manage- PR.AC-1: Iden- AC-2, IA Family elb 2012R2 ment. tities and cre- erf Certificate dentials are e o Authority managed. c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 265 Architecture T sih 5.1 Reference Architecture Description p u b cil ITAM refers to a set of policies and procedures that an organization uses to track, audit, and monitor the a oit state of its IT assets, and maintain system configurations. These assets include “… computing device, n si information technology (IT) system, IT network, IT circuit, software (both an installed instance and a a av physical instance), virtual computing platform (common in cloud and virtualized computing), and related ali b hardware (e.g., locks, cabinets, keyboards)” . The cybersecurity value of ITAM is derived from some el rf key aspects of the Risk Management Framework  and the NIST Framework for Improving Critical e e o Infrastructure Cybersecurity , including: c f h ra ▪ selection and application of baseline security controls g e orf ▪ continuous monitoring and reporting of asset status to a data store m : h ▪ implementation of anomaly detection mechanisms. Examples include deviations from normal t t p /: network traffic or deviations from established configuration baselines / d o o.i ▪ provision of context to detected anomalies and cybersecurity events within the reporting and r g analytic engine / 1 0 6. Implementing the first two elements above addresses the Select, Implement, and Monitor aspects of 0 2 /8 the Risk Management Framework by providing a method to select a baseline, implement it (both N SI configuration and enforcement), and detect changes in the baseline. ITAM addresses the Identify, T S. P Protect, Detect, and Respond aspects of the NIST Framework for Improving Critical Infrastructure 1. 08 Cybersecurity  by implementing the last two bullets, which identify anomalies and add context to 0 -5 events, aiding in remediation. . The ITAM processes supported by our reference architecture include data collection, data storage, configuration management, policy enforcement, data analytics, and reporting/visualization. The reference architecture is depicted in Figure 5-1. NIST SP 1800-5B: IT Asset Management 27Figure 5-1 Reference Architecture T h si p u b cil a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P Figure 5-2, ITAM Reference Functionality, shows how data flows through the ITAM system. Tier 3 is 1. 8 0 composed of enterprise assets themselves. Tier 3 is made up of all of the assets being tracked including 0 -5 . hardware, software, and virtual machines. Tier 2 includes the sensors and independent systems that feed data into the enterprise ITAM system. Tier 2 systems include passive and active collection sensor and agents. Tier 1 is the enterprise ITAM system that provides the aggregation of data from all Tier 2 systems into business and security intelligence. NIST SP 1800-5B: IT Asset Management 28Figure 5-2 ITAM Reference Functionality T h si p u b cil a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / The following capabilities are demonstrated in the ITAM build (see Figure 5-2, ITAM Reference N TSI Functionality): S. P 1. 8 ▪ Data Collection is the capability to enumerate and report the unique software and system 0 0 -5 configuration of each asset and transfer that information to the Data Storage capability. . ▪ Data Storage is the capability that receives data from the data collection capability, re-formats as needed, and stores the data in a storage system. ▪ Data Analytics is the capability that performs analytic functions on the data made available by the Data Storage capability. ▪ Corporate Governance and Policies are all of the rules that are placed upon the IT assets. These rules can include the network/web sites that employees can visit, what software can be installed, and what network services are allowed. ▪ Configuration Management Systems enforce Corporate Governance and Policies through actions such as applying software patches and updates, removing blacklisted software, and automatically updating configurations. ▪ Reporting and Visualizations is the capability that generates human-readable graphical and numerical tables of information provided by the Data Analytics capability. NIST SP 1800-5B: IT Asset Management 29All six are “run-time” capabilities in that they happen periodically in an automated fashion. After performing the initial configuration and manually entering the asset into the asset database, most tasks are performed automatically. Analysts are required to perform a periodic review of the reports stored in T h si the analytic engine to determine anomalies and perform remediation. p u b cil The architecture for this project correlates asset management information with security and event a t oi management information in order to provide context to events, intrusions, attacks, and anomalies on n a si the network. It consists of processes and technologies that enable the enrollment, tracking and v a monitoring of assets throughout the enterprise. Furthermore, it provides processes to detect unenrolled ali b el or untrusted assets within the enterprise. rf e o e Figure 5-3 Typical Asset Lifecycle  c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . In a typical lifecycle, an asset goes through the enrollment, operation, and end-of-life phases. Enrollment usually involves manual activities performed by IT staff such as assigning and tagging the asset with a serial number and barcode, loading a baseline IT image, assigning the asset to an owner, and, finally, recording the serial number as well as other attributes into a database. The attributes might also include primary location, hardware model, baseline IT image, and owner. As the asset goes through the operations phase, changes can occur. Such changes could include introduction of new or unauthorized software, the removal of certain critical software, or the removal of the physical asset itself from the enterprise. These changes need to be tracked and recorded. As a NIST SP 1800-5B: IT Asset Management 30consequence, asset monitoring, anomaly detection, reporting, and policy enforcement are the primary activities in this phase. T h The assets within the enterprise are monitored using installed agents that reside on the asset, as well as si up network-based monitoring systems that scan and capture network traffic. These monitoring systems b cil collect data from and about the assets and send periodic reports to the analytics engine. Each a t oi monitoring system sends reports with slightly differing emphasis on aspects of these enterprise assets. n a si Reports are collected regarding installed and licensed software, vulnerabilities, anomalous traffic (i.e. v a traffic to new sites or drastic changes in the volume of traffic), and policy enforcement status. ali b el rf As an asset reaches the end of its operational life, it goes through activities within the end-of-life phase e o e that include returning the asset to IT support for data removal and removing the serial number from the c f registration database and other associated databases. Finally, the asset is prepared for physical removal h a gr from the enterprise facility. e rf o m The ITAM workflow calls for enrolling the asset once it is received, assigning and recording a serial : th number, loading a base IT image with a list of approved software, including configuration management t p /: agents and asset management agents that start monitoring, and reporting on the assets once enrolled. / d o.io These software agents collect information previously defined by administrators. r g / 1 A security and configuration baseline is enforced by configuration management agents, installed 0 6. 0 software is captured by software asset management agents, and both categories of agents forward 2 8 / reports to their respective servers, which serve as data storage facilities. The servers format the data in N TSI a suitable form prior to forwarding these periodic reports to the analytics engine. With the visualization S. 1.P capability of the analytics engine, an analyst or manager can retrieve a visual report with the 8 0 appropriate level of specificity. Changes that affect the asset attributes are captured in these reports 0 -5 . sent to the analytics engine. While the ITAM system does provide some automated anomaly detection, analysts should periodically review reports to determine anomalies or relevant changes that may have occurred. Views with specific information about the assets are defined within the analytics engine, enabling analysts to detect policy violations or anomalies that could warrant further investigation. Alerts from other security information sources are also triggers for more detailed investigations by an analyst. Detection of policy violations triggers policy enforcement or remediation if a relevant and negative alert was detected. These alerts could include, but are not limited to, newly discovered vulnerabilities or the discovery of blacklisted software. The configuration management facility would be used to enforce the removal of such software or the patching of the vulnerability on any number of hosts, bringing the enterprise into a more compliant state as defined by enterprise policy. NIST SP 1800-5B: IT Asset Management 315.2 Reference Architecture Relationship This ITAM project presents the following four scenarios: T h p si 1. A new laptop is purchased: the ITAM system will track the laptop from arrival, through u b configuration, and to its new owner. The laptop will continue to be monitored during its lifecycle. cil a t oi 2. A server is transferred from one department to another. The ITAM system is used to update the n si physical asset system and the server itself. a v a ali 3. A virtual machine migrates between physical servers. The ITAM system is notified of all b el migrations and can alert if a policy violation occurs. rf e e 4. Incident detection, response, and prevention: If a sensor, such as an intrusion detection system, o c f triggers an alert, the ITAM system should provide additional information on that asset such as h a r configuration, location, and ownership, if possible. g e orf The ITAM system ties into the existing silos of physical assets, physical security, IT systems, and network m : h security to provide a comprehensive view of all assets in the enterprise. This view allows for queries, t t p dashboards, and process automation supporting the four scenarios listed above. /: / d o o.i Scenario 1: New devices are entered into the existing physical asset database, which sends a message to r /g the ITAM system, which triggers other messages to be sent (IT support for configuration). When IT 1 0 6. support configures the new laptop, that triggers numerous ITAM database updates related to hardware 0 82 and software configuration. When the configured laptop is delivered to the new owner, a database / N SI update is performed recording the new ownership information. T S. P 1. Scenario 2: Scenario 2 is very similar to the first scenario. A machine changes ownership and is 8 00 reconfigured. In this scenario, a work order is entered to transfer a server from one department to -5 . another. This work order finds its way into the ITAM system, which triggers a series of events, messages, and reconfigurations that result in updates to the databases and changes to the software on the server. Scenario 3: The ITAM system receives a message for each virtual machine migration. These messages are checked against policy to determine if the move is valid or not. If the move is not valid, an alert is raised. These migration messages can also be used to improve performance by detecting machine or configuration issues that cause excess migrations. Scenario 4: The ITAM system adds context to security alerts from various sensors that are already on the network. For example, if an intrusion detection system triggers an alert such as “Illegal connection 192.168.1.102 -> 8.8.8.8 TCP”, the ITAM system provides all of the system information pertaining to 192.168.1.102 (the internal machine) such as machine name, operating system, configuration, location and owner. This saves the analyst valuable time and allows for more detailed event filters. NIST SP 1800-5B: IT Asset Management 325.3 Building an Instance of the Reference Architecture We built one instance of the centralized ITAM capability. This build consists of a DMZ along with T sih network security, IT systems, physical security, and physical asset management silos to implement the p u workflow and the ITAM system. Each silo has its own router, private subnet, and functionality. Each silo b cil supports aspects of the Risk Management Framework and the NIST Framework for Improving Critical a t oi Infrastructure Cybersecurity. Each silo performs data collection, data storage, data analytics, and n a si visualization specific to each silo’s purpose. Additionally, each silo integrates into the ITAM system to v a ali provide comprehensive reporting and visualizations for the end user. b el rf A detailed list of the components used in the ITAM build can be found in Table 4-2. e e o c f 5.3.1 ITAM Build h a r g rf e The NCCoE constructed the ITAM build infrastructure using off-the-shelf hardware and software, along o m with open source tools. While the reference solution was demonstrated with a certain suite of products, : th the guide does not endorse these products in particular. Instead, it presents the characteristics and t p /: capabilities that an organization's security experts can use to identify similar standards-based products / d o.io that can be integrated quickly and cost-effectively with existing tools and infrastructure. r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 33Figure 5-4 ITAM Build T h si p u b cil a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . The build architecture consists of multiple networks implemented to mirror the infrastructure of a typical financial services sector corporation. Figure 5-4 illustrates the ITAM build. The build is made up of five subnets that are all connected to a sixth DMZ network. The DMZ network (Figure 5-5) provides technologies that monitor and detect cybersecurity events, conduct patch management, and provide secure access to the mainframe computer. The Physical Asset Management Network (Figure 5-9) provides management of data such as system barcodes, room numbers, and ownership information. Network Security (Figure 5-6) provides vulnerability scanning along with a database for collection and analysis of data from hardware and software components. The IT Systems Network (Figure 5-7) includes systems that provide typical IT services such as email, public key infrastructure (PKI), and directory services. Physical Security (Figure 5-8) consists of management consoles for devices that operate and manage physical security. Such devices consist of badge readers and cameras. Firewalls between each subnet are configured to limit access to and from the networks, blocking all traffic except required inter- network communications. NIST SP 1800-5B: IT Asset Management 34Figure 5-5 DMZ Network T h si p u b cil a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h Demilitarized Zone – The DMZ in Figure 5-5 provides a protected neutral network space that the other t pt networks of the production network can use to route traffic to and from the Internet or each other. /: / d There is an external and internal facing subnet. The DMZ also provides technologies that monitor and o o.i detect cybersecurity events, conduct patch management, and issue secure access to the mainframe r g 1/ computer. DMZ devices consist of Router0, Apt-Cacher, Bro, Fathom Sensor, Snort, and WSUS, as shown 0 6. in Figure 5-6. Due to network configuration constraints, the network sensors were placed inside of the 0 2 /8 DMZ instead of in the Network Security subnet (Figure 5-6). N SI T S. Figure 5-6 Network Security Network P 1. 8 0 0 -5 . Network Security – The network security architecture is represented in Figure 5-6. Network Security is where all devices pertaining to network security reside. These types of devices include IDS/IPS, SIEM/logging systems and vulnerability scanners. Devices within this network consist of Router2, OpenVAS, BelManage, and BelManage Data Analytics servers. NIST SP 1800-5B: IT Asset Management 35Figure 5-7 IT Systems Network T h si p u b cil a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / IT Systems – The IT Systems network, shown in Figure 5-7, is dedicated to traditional IT systems. Devices 1 0 6. included in this particular subnet are Router1, two Windows 7 clients, a wiki, certificate authority, email 0 2 8 server, and two Windows 2012 Active Directory servers. One serves as primary while the other serves as / N SI a backup. Active Directory1 and Active Directory2 also provide domain name services (DNS). T S. P 1. Figure 5-8 Physical Security Network 8 0 0 -5 . Physical Security – The Physical Security Network (Figure 5-8) houses the devices that operate and manage physical security such as badge reader and cameras, along with their management consoles. Video Edge is a digital video recorder that records video from Camera1 and Camera2. Both cameras are NIST SP 1800-5B: IT Asset Management 36in the server room recording anyone who physically accesses the ITAM hardware. iStar Edge is an embedded system that contains two radio frequency identification (RFID) badge readers. The iStar Controller communicates with both the Video Edge and iStar Edge systems. The iStar Controller T h si determines if a valid badge was presented and if that badge should grant access into the server room. p u b cil Figure 5-9 Physical Asset Management a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / Physical Asset Management – The Physical Asset Management Network (Figure 5-9) contains devices N TSI that provide and collect information regarding physical assets. The devices include Router 3 and the S. P data center asset management system, or AssetCentral. AssetCentral is a physical asset inventory and 1. 8 0 analysis system from AlphaPoint Technology. This tool allows users to view assets from multiple 0 -5 . viewpoints including building, room, floor, rack, project, collection, or owner. CA ITAM is running IT Asset Management software from CA Technologies. The CA ITAM system records both new IT assets and ownership changes to IT assets. 5.3.2 Access Authorization Information Flow and Control Points The ITAM solution deploys sensors throughout the enterprise that collect data from, or about, enterprise assets. The sensors can be installed on the assets, collecting data about installed software, or they can be remote devices that monitor and scan the network, reporting on vulnerabilities, anomalies, and intrusions. These sensors forward collected data to middle tier services that are responsible for storing, formatting, filtering, and forwarding the data to the analysis engine. Further analysis of the data is performed on the analysis engine and involves running select queries to retrieve defined data using a visualization tool also installed on the analysis engine. NIST SP 1800-5B: IT Asset Management 37Figure 5-10 ITAM Data Flow T h si p u b cil a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 385.3.3 Tier 1 Systems Tier 1 systems collect, store, and analyze the data that they receive from the Tier 2 systems. They allow T h si users to analyze the data and to visualize it for further analysis. p u b cil 5.3.3.1 Splunk Enterprise a t oi i n s Splunk Enterprise serves as an operational intelligence platform that collects, stores, and analyzes the va data from IT assets. The Splunk Enterprise services are responsible for the indexing, analysis, and a ali visualization of the data. All filtered and formatted data makes its way, eventually, to the Splunk b el rf Enterprise system. Additional information can be found at http://www.splunk.com/. e e o c f 5.3.4 Tier 2 Systems h a r g e Tier 2 is composed of systems that each perform a unique task. Each Tier 2 system is fully capable of rf mo collecting, storing, and analyzing data pertaining to its unique task. The middle tier systems filter : h relevant and desired data from the raw data collected and forward this data to the analysis engine and t t p /: visualization tool for further analysis. / d o o.i 5.3.4.1 Fathom r g / 1 6.0 Fathom Sensor passively monitors, captures, and optionally forwards summarized network traffic to its 0 2 service running on the Amazon AWScloud. The Fathom service periodically compares the network traffic 8 / SIN in the ITAM build to an aggregate of the network traffic from several other organizations to determine if T S. abnormal activity has occurred. If abnormal activity is detected, Fathom Sensor will capture the type of P 81. activity and forward this information to Splunk Enterprise for further analysis. Additional information 0 0 -5 can be found at http://www.redjack.com/. . 5.3.4.2 Bro Bro monitors all network traffic in the enterprise and is configured to detect policy violations. It uses AlienVault, Mandiant and TOR threat intelligence data feeds to detect traffic to or from known bad sites. Alerts and messages from Bro are forwarded to the analysis engine and visualization tool. Network traffic information such as connections, DNS traffic, HTTP traffic, and SSL certificates are also forwarded to Splunk Enterprise. Bro messages are, by default, ASCII and tab delimited. Additional information can be found at https://www.bro.org/. 5.3.4.3 Snort Snort is used to detect intrusions by capturing network traffic and comparing it to known signatures. If intrusions are detected, Snort creates alerts and forwards such alerts via CSV format to Splunk Enterprise. Information such as source and destination IP and port addresses, as well as type of NIST SP 1800-5B: IT Asset Management 39signature match, are included in the updates. Additional information can be found at https://www.snort.org/. T sih 5.3.4.4 OpenVAS p u cilb OpenVAS periodically scans enterprise hosts for known vulnerabilities, generates reports based on its a t findings, and forwards these reports in XML format to Splunk Enterprise. These reports indicate oi n si vulnerable systems, applications, and services. Additional information can be found at a v http://www.openvas.org/. a ali b rf el 5.3.4.5 WSUS e e o Enterprise hosts with Microsoft Windows operating systems are configured to receive updates from c f h WSUS. WSUS detects whether or not the hosts have the latest updates and sends updates to those hosts a r g e that are not in compliance. WSUS forwards reports in CSV format with details of compliance to Splunk rf o Enterprise. Additional information can be found at https://technet.microsoft.com/en- m : h us/windowsserver/bb332157.aspx. t t p /: / d 5.3.4.6 BelManage o o.i gr The BelManage server has agents installed on all clients. BelManage agents collect information about / 1 0 the installed software and forward it to the BelManage server, which stores it in its local database. The 6. 0 2 CSV-formatted reports are retrieved from the database and are sent periodically to Splunk Enterprise. 8 / N Additional information can be found at http://www.belarc.com/belmanage.html. SI T S. 1.P 5.3.4.7 BelManage Data Analytics 8 0 0 -5 BelManage Data Analytics (BDA) provides an easy way for users to access, query, and create reports . based on the data collected and analyzed by BelManage. The ITAM project gathers data from some of the queries for incorporation in overall dashboards. Additional information can be found at http://www.belarc.com/data_analytics.html. The information in BelManage is gathered directly by Splunk Enterprise using an SQL database query. 5.3.4.8 Puppet Enterprise Puppet Enterprise enforces a configuration baseline on servers and workstations. Puppet agents run periodically, downloading a compiled configuration catalog from the Master and executing it on the hosts. A successful Puppet Enterprise agent run can make configuration changes, install new software or remove unwanted software, and sends success status updates to the Master. The ITAM solution configured the Puppet Enterprise Master to forward an absent or present status for enterprise hosts indicating whether or not they have had successful agent runs. These status messages are forwarded to Splunk Enterprise using the syslog facility. Additional information can be found at https://puppetlabs.com/puppet/puppet-enterprise. NIST SP 1800-5B: IT Asset Management 405.3.4.9 Openswan Openswan is an open-source virtual private network (VPN) for Linux operating systems. Openswan is T h used in the ITAM project for connecting the lab at the NCCoE to a facility in Nevada run by Vanguard si p Integrity Professionals, where the mainframe computer is located. Openswan is configured to provide a u b cil site-to-site VPN using IPsec. Additional information can be found at https://www.openswan.org/. a t oi n si 5.3.4.10 Ubuntu Apt-Cacher0 a v a ali Ubuntu Apt-Cacher0 is an Ubuntu Linux server that provides package caching services for the ITAM lab. b el All of the Ubuntu devices on the network receive their software, patches, and updates from Ubuntu Apt- rf e Cacher0. This centralizes update management, reduces the number of machines accessing the Internet, e o c f and reduces Internet bandwidth usage. Additional information can be found at h a https://help.ubuntu.com/community/Apt-Cacher-Server. r g e rf o 5.3.4.11 AssetCentral m : h tt AssetCentral is a Web-based IT asset management and data center management solution. Information p /: / on all physical IT assets used in the ITAM project was entered into AssetCentral. This information d o o.i includes make, model, serial number, barcode, room, rack, and owner. This information is then used to r g / provide a complete picture of the state of an asset. Splunk Enterprise utilizes a direct SQL database 1 0 6. query to gather information from AssetCentral. 0 2 8 / N 5.3.4.12 CA Technologies IT Asset Manager SI T S. P CA Technologies IT Asset Manager provides asset management lifecycle support. This project uses CA 1. 8 0 ITAM for asset-based workflow management. For example, when a new asset arrives, it is entered into 0 -5 the CA ITAM product, which then tracks its provisioning and delivery. Splunk Enterprise utilizes a direct . SQL database query to gather information from CA ITAM. Additional information can be found at http://www.ca.com/us/intellicenter/ca-it-asset-manager.aspx. 5.3.4.13 iStar/C-Cure Controller The C-Cure controller from Software House provides badging and access controls for the physical security silo of this project. The C-Cure controller is part of the physical security system from Tyco Security Products that we used. The C-Cure Controller interacts with the iStar Edge and VideoEdge systems to provide an overall physical security solution. Access request information is exported from the iStar/C-Cure controller in .CSV format for use by Splunk Enterprise. Additional information can be found at http://www.swhouse.com/products/CCURE_ID_Badging.aspx. NIST SP 1800-5B: IT Asset Management 415.3.4.14 VideoEdge VideoEdge is a network video recorder that records video from Camera1 and Camera2. VideoEdge is T h part of the physical security system from Tyco Security Products used in this project. Additional si p information can be found at http://www.americandynamics.net/products/videoedge_nvr.aspx. u b cil a oit 5.3.5 Tier 3 Systems n si a Tier 3 systems are the assets (end points) on the enterprise network that are owned by the enterprise, v a ali such as workstations, switches, servers, users’ laptops, virtual machines, and other devices. All b rf el enterprise assets are monitored from the start of their lifecycle until disposal by the systems in the Tier e e 2. Device location, owner, installed software catalog, current security vulnerabilities, and abnormal o c f traffic activity are captured to allow for better visibility by administrators. h a r g rf e 5.3.5.1 AD1 o m : h Active Directory (AD) is a special-purpose database that holds objects and attributes related to users, t pt contacts, groups, computers, and organizational units. AD is used for authentication, authorization, and /: / d auditing of users and computers. Additionally, AD1 provides domain name services (DNS) to the entire o o.i lab network. The AD machines used for this project are run on top of the Microsoft Windows 2012R2 64- r g 1/ bit operating system. Additional information can be found at https://msdn.microsoft.com/en- 0 06. us/library/Aa746492%28v=VS.85%29.aspx. 2 8 / N SI 5.3.5.2 AD2 T S. P 1. AD2 is a replica of AD1. The two systems provide redundancy and fault tolerance. 8 0 0 -5 5.3.5.3 Certificate Authority . The Certificate Authority (CA) provides PKI capabilities to the lab. The CA creates and signs X.509 cryptographic certificates for users and computers that are used throughout the lab. This project utilizes the CA that is part of the Microsoft Windows 2012R2 64-bit operating system. Additional information can be found at https://technet.microsoft.com/en-us/library/cc770357%28v=ws.10%29.aspx. 5.3.5.4 Email Server The ITAM project utilizes the Postfix email server. The email server is used to collect messages, both status and informational, as well as for workflow management. Additional information can be found at http://www.postfix.org/. NIST SP 1800-5B: IT Asset Management 42NIST SP 1800-5B: IT Asset Management 43 This publication is available free of charge from: http://doi.org/10.6028/NIST.SP.1800-5. 5.3.5.5 Ubuntu-Client1 Ubuntu-Client1 functions as a representative Linux client for the ITAM lab. Ubuntu-Client1 is configured as a full desktop load with a graphical operating system. The purpose of Ubuntu-Client1 is to show that the various ITAM functions, such as hardware and software monitoring, function correctly on a Linux system. Additional information can be found at http://www.ubuntu.com/. 5.3.5.6 Win7-Client1 Win7-Client1 functions as a representative Microsoft Windows client for the ITAM lab. Win7-Client1 includes the full Microsoft Windows 7 desktop installation along with additional software such as Firefox, Google Chrome, and WinSCP. Win7-Client1 is a member of the lab5.nccoe.gov domain. The purpose of Win7-Client1 is to show that the various ITAM functions, such as hardware and software monitoring, function correctly on a Windows system. 5.3.5.7 Win7-Client2 Win7-Client2 performs the same functions as Win7-Client1. The purpose of Win7-Client2 is to provide additional data points for the ITAM system. 5.3.5.8 Mainframe The mainframe computer provided by Vanguard Integrity Professionals and running their security, compliance, and configuration management software provides the ITAM system with information regarding the state of the mainframe. State information includes configuration, usage, and compliance information. The mainframe computer is physically located at Vanguard and accessed via VPN. You can find additional information at https://www.go2vanguard.com/. 5.3.5.9 iStar Edge The iStar Edge is a door controller that is accessed over Internet Protocol (IP)-based networks. iStar controls access to two doors by using its RFID badge readers. The iStar Edge is controlled via the iStar Controller. The iStar system provides the ITAM system with information on human assets that are entering sensitive server rooms. The iStar Edge controller is part of the physical security system from Tyco Security Products used in this project. The iStar Edge is part of the physical security silo of the ITAM system. Additional information can be found at http://www.swhouse.com/products/hardware_iSTAR_Edge.aspx.NIST SP 1800-5B: IT Asset Management 44 This publication is available free of charge from: http://doi.org/10.6028/NIST.SP.1800-5. 5.3.5.10 Camera1 Camera1 is an Illustra 600 compact mini-dome IP camera that is part of the physical security silo of the ITAM system. Camera1 is part of the physical security system from Tyco Security Products. Camera1 sends its images to the VideoEdge network video recorder. Additional information can be found at http://www.americandynamics.net/products/illustra-minidomes.aspx. 5.3.5.11 Camera2 Camera2 is same as Camera1 but is pointed in a different direction to capture different images. 5.3.5.12 Routers/Firewalls The ITAM lab uses six routers/firewalls to route, segment, and filter traffic inside of the ITAM network. All of the routers/firewalls are virtual machines running the community version of pfSense. Each network segment has its own router/firewall and each router/firewall has its own unique configuration. Alerts and messages are forwarded to the analysis and visualization system. Additional information can be found at https://www.pfsense.org.Appendix A List of Acronyms AD Active Directory T h si p CA CA Technologies u b acil CA Certificate Authority t oi n i s COTS Commercial Off-The-Shelf a v a CRADA Collaborative Research and Development Agreement ali b el CSF NIST Framework for Improving Critical Infrastructure Cybersecurity rf e e o .csv Comma-Separated Value c f h a DMZ Demilitarized Zone r g e rf FS Financial Sector o m : h HR Human Resources t t p //: ID Identity d o o.i ITAM Information Technology Asset Management r g / 1 0 IDS Intrusion Detection System 6. 0 2 8 IP Internet Protocol / N SI T NAS Network Attached Storage S. P 1. 8 NCCoE National Cybersecurity Center of Excellence 0 0 -5 . NIST National Institute of Standards and Technology OS Operating System PKI Public Key Infrastructure SME Subject Matter Expert SQL Structured Query Language SSL Secure Socket Layer STIG Security Technical Implementation Guideline TLS Transport Layer Security VLAN Virtual Local Area Network VPN Virtual Private Network NIST SP 1800-5B: IT Asset Management 45Appendix B References  CIS Critical Security Controls, SANS Institute [Website], https://www.sans.org/critical-security- T h si controls/ [accessed 08/07/18]. p u b cil  Framework for Improving Critical Infrastructure Cybersecurity, Version 1.1, National Institute of a t oi Standards and Technology, Gaithersburg, Maryland, April 16, 2018. n i s http://www.nist.gov/cyberframework/ [accessed 08/07/18]. a v a ali  Joint Task Force Transformation Initiative, Security and Privacy Controls for Federal Information b el rf Systems and Organizations, NIST Special Publication (SP) 800-53 Revision 4, National Institute of e e Standards and Technology, Gaithersburg, Maryland, April 2013. o c f http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-53r4.pdf [accessed 08/07/18]. h a r g rf e  Security Technical Implementation Guides (STIGs), Defense Information Systems Agency o m [Website], http://iase.disa.mil/stigs/Pages/index.aspx [accessed 08/07/18]. : h t pt  International Organization for Standardization/International Electrotechnical Commission, /: / d Information Technology – Security techniques – Code of practice for information security o o.i controls, ISO/IEC 27002, 2013. http://www.iso.org/iso/catalogue_detail?csnumber=54533 r g 1/ [accessed 08/07/18]. 0 6. 0 2  Joint Task Force Transformation Initiative, Guide for Conducting Risk Assessments, NIST Special 8 / SIN Publication (SP) 800-30 Revision 1, National Institute of Standards and Technology, T S. Gaithersburg, Maryland, September 2012. P 81. https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-30r1.pdf [accessed 0 0 -5 08/07/18]. .  Risk Management Framework: Quick Start Guides, National Institute of Standards and Technology [Website], http://csrc.nist.gov/groups/SMA/fisma/Risk-Management-Framework/ [accessed 08/07/18].  Joint Task Force Transformation Initiative, Managing Information Security Risk: Organization, Mission, and Information System View, NIST Special Publication (SP) 800-39, National Institute of Standards and Technology, Gaithersburg, Maryland, March 2011. http://csrc.nist.gov/publications/nistpubs/800-39/SP800-39-final.pdf [accessed 08/07/18].  IT Asset Management: Securing Assets for the Financial Services Sector, Version 2, National Institute of Standards and Technology, Gaithersburg, Maryland, May 1, 2014, https://www.nccoe.nist.gov/sites/default/files/library/project-descriptions/fs-itam-project- description-final.pdf [accessed 08/07/18]. NIST SP 1800-5B: IT Asset Management 46 International Organization for Standardization/International Electrotechnical Commission, Information technology — Security techniques — Information security management systems — Requirements, IEC/ISO 27001, 2013. http://www.iso.org/iso/iso27001. [accessed 08/07/18]. T h si up  J. Wunder, A. Halbardier, and D. Waltermire, Specification for Asset Identification, NISTIR 7693 b cil Version 1.1, National Institute of Standards and Technology, Gaithersburg, Maryland, June 2011. a t oi https://nvlpubs.nist.gov/nistpubs/Legacy/IR/nistir7693.pdf [accessed 08/07/18]. n si va  Risk Management Framework (RMF) Overview, National Institute of Standards and Technology a ali [Website], http://csrc.nist.gov/groups/SMA/fisma/framework.html [accessed 08/07/18]. b el erf  http://wc1.smartdraw.com/cmsstorage/exampleimages/44b341d1-a502-465f-854a- e o c f 4e68b8e4bf75.png [accessed 08/07/18]. h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5B: IT Asset Management 47NIST SPECIAL PUBLICATION 1800-5C IT Asset Management Volume C: How-To Guides Michael Stone Leah Kauffman, Editor-in-Chief National Cybersecurity Center of Excellence Information Technology Laboratory Chinedum Irrechukwu Harry Perper Devin Wynne The MITRE Corporation McLean, VA September 2018 This publication is available free of charge from: http://doi.org/10.6028/NIST.SP.1800-5 The first draft of this publication is available free of charge from: https://www.nccoe.nist.gov/sites/default/files/library/sp1800/fs-itam-nist-sp1800-5-draft.pdfDISCLAIMER Certain commercial entities, equipment, products, or materials may be identified in this document in T sih order to describe an experimental procedure or concept adequately. Such identification is not intended p u to imply recommendation or endorsement by NIST or NCCoE, nor is it intended to imply that the b acil entities, equipment, products, or materials are necessarily the best available for the purpose. t oi n si a v a ali b el rf e e o c f National Institute of Standards and Technology Special Publication 1800-5C, Natl. Inst. Stand. Technol. h a r Spec. Publ. 1800-5C, 166 pages, (September 2018), CODEN: NSPUE2 g e rf mo : h t pt /: / d o o.i r g / 1 FEEDBACK 0 6. 0 2 8 As a private-public partnership, we are always seeking feedback on our Practice Guides. We are / N SI particularly interested in seeing how businesses apply NCCoE reference designs in the real world. If you T PS. have implemented the reference design, or have questions about applying it in your environment, 1. 8 please email us at financial_nccoe@nist.gov. 0 0 -5 . All comments are subject to release under the Freedom of Information Act (FOIA). National Cybersecurity Center of Excellence National Institute of Standards and Technology 100 Bureau Drive Mailstop 2002 Gaithersburg, MD 20899 Email: nccoe@nist.gov NIST SP 1800-5C: IT Asset Management iNATIONAL CYBERSECURITY CENTER OF EXCELLENCE The National Cybersecurity Center of Excellence (NCCoE), a part of the National Institute of Standards T sih and Technology (NIST), is a collaborative hub where industry organizations, government agencies, and p u academic institutions work together to address businesses' most pressing cybersecurity issues. This b acil public-private partnership enables the creation of practical cybersecurity solutions for specific t noi industries, as well as for broad, cross-sector technology challenges. Through consortia under si a Cooperative Research and Development Agreements (CRADAs), including technology partners—from v a ali Fortune 50 market leaders to smaller companies specializing in IT security—the NCCoE applies standards b el and best practices to develop modular, easily adaptable example cybersecurity solutions using rf e commercially available technology. The NCCoE documents these example solutions in the NIST Special e o c f Publication 1800 series, which maps capabilities to the NIST Cyber Security Framework and details the h a steps needed for another entity to recreate the example solution. The NCCoE was established in 2012 by r g e rf NIST in partnership with the State of Maryland and Montgomery County, Md. o m : h To learn more about the NCCoE, visit https://www.nccoe.nist.gov/. To learn more about NIST, visit t t p https://www.nist.gov. /: / d o o.i NIST CYBERSECURITY PRACTICE GUIDES r g / 1 0 NIST Cybersecurity Practice Guides (Special Publication Series 1800) target specific cybersecurity 6. 0 2 challenges in the public and private sectors. They are practical, user-friendly guides that facilitate the 8 / N adoption of standards-based approaches to cybersecurity. They show members of the information SI T S. security community how to implement example solutions that help them align more easily with relevant P 1. standards and best practices, and provide users with the materials lists, configuration files, and other 8 0 0 information they need to implement a similar approach. -5 . The documents in this series describe example implementations of cybersecurity practices that businesses and other organizations may voluntarily adopt. These documents do not describe regulations or mandatory practices, nor do they carry statutory authority. ABSTRACT While a physical asset management system can tell you the location of a computer, it cannot answer questions like, “What operating systems are our laptops running?” and “Which devices are vulnerable to the latest threat?” An effective IT asset management (ITAM) solution can tie together physical and virtual assets and provide management with a complete picture of what, where, and how assets are being used. ITAM enhances visibility for security analysts, which leads to better asset utilization and security. KEYWORDS asset management; financial sector; information technology asset management; ITAM; personnel security; physical security; operational security NIST SP 1800-5C: IT Asset Management iiACKNOWLEDGMENTS We are grateful to the following individuals for their generous contributions of expertise and time. T h si p u b Name Organization cil a t oi si n FS-ISAC Financial Services Information Sharing and Analysis Center a v a ali Gorrell Cheek Western Union b el rf e o e Joe Buselmeier American Express c f h a gr Sean Franklin American Express e rf o m : h Ron Ritchey Bank of America t t p /: / d Sounil Yu Bank of America o o.i r g / 1 Joel Van Dyk Depository Trust & Clearing Corporation 0 6. 0 2 8 / Dan Schutzer Financial Services Roundtable N SI T S. P 1. George Mattingly Navy Federal Credit Union 8 0 0 -5 . Jimmie Owens Navy Federal Credit Union Mike Curry State Street Timothy Shea RSA Mark McGovern MobileSystem7 Atul Shah Microsoft Leah Kauffman NIST Benham (Ben) Shariati University of Maryland Baltimore County Valerie Herrington Herrington Technologies Susan Symington MITRE Corporation Sallie Edwards MITRE Corporation NIST SP 1800-5C: IT Asset Management iiiName Organization T sih Sarah Weeks MITRE Corporation p u b acil Lina Scorza MITRE Corporation t oi n si a Karen Scarfone Scarfone Cybersecurity v a ali b el rf The Technology Partners/Collaborators who participated in this build submitted their capabilities in e e o response to a notice in the Federal Register. Respondents with relevant capabilities or product hc f components were invited to sign a Cooperative Research and Development Agreement (CRADA) with a r eg NIST, allowing them to participate in a consortium to build this example solution. We worked with: rf o m : h Technology Partner/Collaborator Build Involvement t t p /: / d o AlphaPoint Technology AssetCentral o.i r g / 1 0 Belarc BelManage, BelManage Analytics 6. 0 2 8 / N Computer Associates ITAM SI T S. P 1. Microsoft WSUS, Server 2012R2 Certificate Authority 8 0 0 -5 . Peniel Solutions Technology/Industry Expertise PI Achievers Penetration Testing Services PuppetLabs Puppet RedJack Fathom Splunk Splunk Enterprise Tyco iStar Edge Vanguard Integrity Professionals Security Manager NIST SP 1800-5C: IT Asset Management ivContents T 1 Introduction ........................................................................................ 1 h si p u 1.1 Practice Guide Structure ............................................................................................... 1 b cil a t 1.2 Build Overview .............................................................................................................. 2 oi n si 1.2.1 Build Architecture Components Overview ................................................................... 5 a v a ali 1.2.2 Build Network Components .......................................................................................... 6 b rf el 1.2.3 Operating Systems ........................................................................................................ 7 e e o 1.3 Typographic Conventions .............................................................................................. 8 c f h ra 2 Tier 1 .................................................................................................. 8 g e rf o 2.1 Software Configurations ................................................................................................ 8 m : th 2.1.1 Splunk Enterprise .......................................................................................................... 8 t p /: / d 2.1.2 How It’s Used ................................................................................................................ 8 o ro.i 2.1.3 Installing Splunk Enterprise .......................................................................................... 9 g / 1 0 2.1.4 Configurations ............................................................................................................. 11 6. 0 82 2.1.5 Lookup Table Files ....................................................................................................... 27 / N TSI 3 Tier 2 ................................................................................................ 28 S. P 1. 8 3.1 AssetCentral ................................................................................................................ 28 0 0 -5 . 3.1.1 How It’s Used .............................................................................................................. 28 3.1.2 Virtual Machine Configuration .................................................................................... 29 3.1.3 Network Configuration ............................................................................................... 29 3.1.4 Installing AssetCentral ................................................................................................ 29 3.1.5 Installing MySQL (MariaDB) ........................................................................................ 29 3.1.6 Installing Apache ......................................................................................................... 30 3.1.7 Installing PHP5 ............................................................................................................ 30 3.1.8 Post Installation Tasks ................................................................................................. 30 3.1.9 Database Update – Add a View .................................................................................. 31 3.1.10 Add Assets into AssetCentral ...................................................................................... 32 3.2 BelManage ................................................................................................................... 32 3.2.1 How It’s Used .............................................................................................................. 32 NIST SP 1800-5C: IT Asset Management v3.2.2 Virtual Machine Configuration .................................................................................... 33 3.2.3 Network Configuration ............................................................................................... 33 T h 3.2.4 Installing BelManage ................................................................................................... 33 si p u 3.2.5 Integration and Final Steps ......................................................................................... 35 b cil ta 3.3 Bro ............................................................................................................................... 36 oi n si 3.3.1 How It’s Used .............................................................................................................. 36 a v alia 3.3.2 Virtual Machine Configuration.................................................................................... 36 b rf el 3.3.3 Network Configuration ............................................................................................... 37 e e o 3.3.4 Installing Bro ............................................................................................................... 37 c f ah 3.3.5 Installing Intelligence Gathering Software .................................................................. 39 r g e rf 3.3.6 Configuring Bro ........................................................................................................... 39 o m : h 3.3.7 Installing Splunk Universal Forwarder ........................................................................ 40 t t /:p 3.3.8 Configuring Splunk Universal Forwarder .................................................................... 41 / d o 3.3.9 Configurations and Scripts .......................................................................................... 42 o.i r g / 3.4 CA Technologies IT Asset Manager ............................................................................. 50 1 0 06. 3.4.1 How It’s Used .............................................................................................................. 50 2 8 / N 3.4.2 Virtual Machine Configuration.................................................................................... 51 SI T S. 3.4.3 Network Configuration ............................................................................................... 51 P 1. 08 3.4.4 Installing CA ITAM ....................................................................................................... 51 0 -5 . 3.4.5 Configurations ............................................................................................................. 52 3.5 Fathom Sensor from RedJack ...................................................................................... 54 3.5.1 How It’s Used .............................................................................................................. 55 3.5.2 Virtual Machine Configuration.................................................................................... 55 3.5.3 Network Configuration ............................................................................................... 55 3.5.4 Installing Fathom Sensor ............................................................................................. 55 3.5.5 Installing Splunk Universal Forwarder ........................................................................ 61 3.5.6 Configuring Splunk Universal Forwarder .................................................................... 62 3.5.7 Helpful Commands and Information .......................................................................... 62 3.5.8 Configurations and Scripts .......................................................................................... 63 3.6 OpenVAS ...................................................................................................................... 64 3.6.1 How It’s Used .............................................................................................................. 64 NIST SP 1800-5C: IT Asset Management vi3.6.2 Virtual Machine Configuration .................................................................................... 64 3.6.3 Network Configuration ............................................................................................... 64 T h 3.6.4 Installation Prerequisites ............................................................................................ 65 si p u 3.6.5 Installing OpenVAS ...................................................................................................... 65 b cil ta 3.6.6 Configuring OpenVAS .................................................................................................. 67 oi n si 3.6.7 Installing Splunk Universal Forwarder ........................................................................ 69 a v alia 3.6.8 Configuring Splunk Universal Forwarder .................................................................... 69 b el 3.6.9 Configurations and Scripts .......................................................................................... 70 rf e o e 3.7 Puppet Enterprise ........................................................................................................ 74 c f ah 3.7.1 How It’s Used .............................................................................................................. 74 r g e rf 3.7.2 Prerequisites ............................................................................................................... 74 o m : h 3.7.3 Installing Puppet Enterprise Server ............................................................................ 75 t t /:p 3.7.4 Puppet Enterprise Linux Agent Installation ................................................................ 75 / d o 3.7.5 Puppet Enterprise Windows Agent Installation .......................................................... 76 o.i r /g 3.7.6 Puppet Enterprise Agent Configuration ...................................................................... 76 1 0 06. 3.7.7 Puppet Enterprise Manifest Files and Modules .......................................................... 77 2 8 N/ 3.7.8 Reporting .................................................................................................................... 79 SI T S. 3.7.9 Report Directory Cleanup ........................................................................................... 80 P 1. 8 3.7.10 Puppet Code and Scripts ............................................................................................. 80 0 0 -5 . 3.8 Snort ............................................................................................................................ 93 3.8.1 How It’s Used .............................................................................................................. 93 3.8.2 Virtual Machine Configuration.................................................................................... 93 3.8.3 Network Configuration ............................................................................................... 93 3.8.4 Installing Snort ............................................................................................................ 94 3.8.5 Installing Snort ............................................................................................................ 94 3.8.6 Get Updated Community Rules .................................................................................. 94 3.8.7 Installing Barnyard2 .................................................................................................... 95 3.8.8 Testing ......................................................................................................................... 96 3.8.9 Installing Splunk Universal Forwarder ........................................................................ 97 3.8.10 Configuring Splunk Universal Forwarder .................................................................... 97 3.8.11 Configurations and Scripts .......................................................................................... 98 NIST SP 1800-5C: IT Asset Management vii3.9 Tyco Security Products .............................................................................................. 134 3.9.1 Installing Tyco Security Products .............................................................................. 134 T h 3.9.2 Configurations ........................................................................................................... 134 si p bu 3.10 Windows Server Update Services (WSUS) ................................................................ 136 cil a oit 3.10.1 How It’s Used ............................................................................................................ 136 n si 3.10.2 Virtual Machine Configuration.................................................................................. 136 a v a ali 3.10.3 Network Configuration ............................................................................................. 136 b el rf 3.10.4 Installing WSUS ......................................................................................................... 137 e e o 3.10.5 Configurations ........................................................................................................... 137 c f h a 3.10.6 Configure Active Directory Server to Require WSUS ................................................ 137 r g e rf 3.10.7 Create WSUS Statistics for Splunk Enterprise ........................................................... 138 o m : h 3.10.8 Installing Splunk Universal Forwarder ...................................................................... 140 t t /:p 3.10.9 Configuring Splunk Universal Forwarder .................................................................. 140 / d o.io 3.10.10 Configurations and Scripts ........................................................................................ 141 r g 1/ 4 Tier 3 .............................................................................................. 142 0 6. 0 2 4.1 Active Directory Server .............................................................................................. 142 8 / N SI 4.1.1 Software Configurations ........................................................................................... 143 T S. 1.P 4.1.2 How It’s Used ............................................................................................................ 143 8 0 0 4.1.3 Installation ................................................................................................................ 143 -5 . 4.2 AssetCentral .............................................................................................................. 146 4.2.1 How It’s Used ............................................................................................................ 146 4.2.2 Virtual Machine Configuration.................................................................................. 146 4.2.3 Network Configuration ............................................................................................. 146 4.2.4 Installing AssetCentral .............................................................................................. 146 4.2.5 Installing MySQL (MariaDB) ...................................................................................... 147 4.2.6 Installing Apache ....................................................................................................... 147 4.2.7 Installing PHP5 .......................................................................................................... 148 4.2.8 Post Installation Tasks ............................................................................................... 148 4.3 Email .......................................................................................................................... 148 4.3.1 How It’s Used ............................................................................................................ 148 NIST SP 1800-5C: IT Asset Management viii4.3.2 Virtual Machine Configuration.................................................................................. 149 4.3.3 Network Configuration ............................................................................................. 149 T h 4.3.4 Installing Email .......................................................................................................... 149 si p u 4.3.5 Configure Email ......................................................................................................... 149 b cil ta 4.3.6 User Accounts ........................................................................................................... 150 oi n si 4.3.7 DNS Settings .............................................................................................................. 150 a v alia 4.3.8 Configuration Files .................................................................................................... 151 b el 4.4 Openswan (VPN) ....................................................................................................... 152 rf e e o 4.4.1 How It’s Used ............................................................................................................ 152 c f ah 4.4.2 Virtual Machine Configuration.................................................................................. 152 r g e rf 4.4.3 Network Configuration ............................................................................................. 152 o m : h 4.4.4 Installing Openswan .................................................................................................. 153 t t /:p 4.4.5 Installing Openswan .................................................................................................. 153 / d o 4.4.6 Configurations and Scripts ........................................................................................ 154 o.i r g / 4.5 Ubuntu Apt-Cacher .................................................................................................... 157 1 0 06. 4.5.1 How It’s Used ............................................................................................................ 157 2 8 / N 4.5.2 Virtual Machine Configuration.................................................................................. 157 SI T S. 4.5.3 Network Configuration ............................................................................................. 157 P 1. 08 4.5.4 Installing Ubuntu Apt-Cacher .................................................................................... 157 0 -5 . 4.5.5 Client Configuration .................................................................................................. 158 4.6 Windows 2012 Certificate Authority ......................................................................... 158 4.6.1 Software Configurations ........................................................................................... 158 4.6.2 How It’s Used ............................................................................................................ 158 4.6.3 Certificate Generation and Issuance ......................................................................... 162 4.7 Common PKI Activities .............................................................................................. 163 4.7.1 Generating a Certificate Signing Request from OpenSSL ......................................... 163 4.7.2 Submitting the CSR to the CA Service ....................................................................... 163 4.7.3 Exporting a Root Certificate from a Microsoft CA .................................................... 164 4.7.4 Converting from DER Encoding to PEM Encoding .................................................... 164 4.8 Process Improvement Achievers (PIA) Security Evaluation ...................................... 164 NIST SP 1800-5C: IT Asset Management ixAppendix A List of Acronyms ............................................................... 165 T h si p List of Figures u b cil a oit Figure 1-1 ITAM Build ........................................................................................................................... 5 n a si Figure 2-1 Splunk Enterprise Syslog TCP Input .................................................................................... 11 v a bali Figure 2-2 Splunk Enterprise Syslog UDP Input ................................................................................... 11 el erf Figure 2-3 Splunk Enterprise Receive from Splunk Universal Forwarder ............................................. 12 e o c f Figure 3-1 CCURE 9000 Overview ..................................................................................................... 135 h a r eg Figure 3-2 CCURE 9000 Messages ..................................................................................................... 135 rf o m : h t t p /: List of Tables / d o o.i r Table 1-1 Build Architecture Component List ....................................................................................... 3 g / 1 0 6. Table 2-1 Splunk Enterprise Data Collection Methods .......................................................................... 9 0 2 8 / Table 2-2 Splunk Enterprise Indexes ................................................................................................... 12 N SI T S. Table 2-3 Splunk Enterprise Apps ....................................................................................................... 13 P 1. 08 Table 2-4 Required Database Drivers ................................................................................................. 14 0 -5 . Table 2-5 DB Connect v2 Identities ..................................................................................................... 15 Table 3-1 Recommended Versions for AssetCentral – Tier 2 ............................................................... 29 Table 4-1 Recommended Versions for AssetCentral – Tier 3 ............................................................. 147 NIST SP 1800-5C: IT Asset Management x1 Introduction T The following volumes of this guide show information technology (IT) professionals and security h p si engineers how we implemented this example solution. We cover all the products employed in this u cilb reference design. We do not recreate the product manufacturers’ documentation, which is presumed to a t be widely available. Rather, these volumes show how we incorporated the products together in our oi n si environment. a v a ali Note: These are not comprehensive tutorials. There are many possible service and security configurations b el for these products that are out of scope for this reference design. rf e e c fo 1.1 Practice Guide Structure h a r g This National Institute of Standards and Technology (NIST) Cybersecurity Practice Guide demonstrates a e orf standards-based reference design and provides users with the information they need to replicate all, or m : h parts of the build created in the NCCoE ITAM Lab. This reference design is modular and can be deployed t t p in whole or in part. /: / d o o.i This guide contains three volumes: r g / 01 ▪ NIST SP 1800-5A: Executive Summary 6. 0 2 ▪ NIST SP 1800-5B: Approach, Architecture, and Security Characteristics – what we built and why 8 / N SI ▪ NIST SP 1800-5C: How-To Guides – instructions for building the example solution (you are here) T S. P 1. Depending on your role in your organization, you might use this guide in different ways: 8 0 0 -5 Business decision makers, including chief security and technology officers, will be interested in the . Executive Summary, NIST SP 1800-5A, which describes the following topics: ▪ challenges enterprises face in implementing and using ITAM systems ▪ example solution built at the NCCoE ▪ benefits of adopting the example solution Technology or security program managers who are concerned with how to identify, understand, assess, and mitigate risk will be interested in NIST SP 1800-5B, which describes what we did and why. The following sections will be of particular interest: ▪ Section 4.5, Risk Assessment and Mitigation, where we identify the steps we took to protect and monitor the ITAM system ▪ Section 4.5.1, Assessing Risk Posture, where we identify the security measures used in this implementation NIST SP 1800-5C: IT Asset Management 1▪ Section 4.5.2, Security Characteristics and Controls Mapping, where we map the security characteristics of this example solution to cybersecurity standards and best practices T ▪ Section 4.6, Technologies, where we identify the products and technologies we used and map h p si them to the relevant security controls u b cil You might share the Executive Summary, NIST SP 1800-5A, with your leadership team members to help a t oi them understand the importance of adopting standards-based IT Asset Management. n si va IT professionals who want to implement an approach like this will find this whole practice guide useful. a ali You can use this How-To portion of the guide, NIST SP 1800-5C, to replicate all or parts of the build b el rf created in our lab. This How-To portion of the guide provides specific product installation, configuration, e o e and integration instructions for implementing the example solution. We do not recreate the product c f manufacturers’ documentation, which is generally widely available. Rather, we show how we h a gr incorporated the products together in our environment to create an example solution. e rf o m This guide assumes that IT professionals have experience implementing security products within the : th enterprise. While we have used a suite of commercial products to address this challenge, this guide does t p /: not endorse these particular products. Your organization can adopt this solution or one that adheres to / d o.io these guidelines in whole, or you can use this guide as a starting point for tailoring and implementing gr parts of IT Asset Management. Your organization’s security experts should identify the products that will / 1 6.0 best integrate with your existing tools and IT system infrastructure. We hope that you will seek products 0 2 that are congruent with applicable standards and best practices. Section 4.6, Technologies, lists the 8 / N products that we used and maps them to the cybersecurity controls provided by this reference solution. SI T S. P A NIST Cybersecurity Practice Guide does not describe “the” solution, but a possible solution. 1. 8 0 Comments, suggestions, and success stories will improve subsequent versions of this guide. Please 0 -5 . contribute your thoughts to financial_nccoe@nist.gov. 1.2 Build Overview The NCCoE constructed the Information Technology Access Management (ITAM) build infrastructure using commercial off-the-shelf (COTS) hardware and software along with open source tools. The lab network is connected to the public Internet through a virtual private network (VPN) appliance and firewall to enable secure Internet and remote access. The lab network is not connected to the NIST enterprise network. Table 1-1 lists the software and hardware components used in the build, as well the specific function each component contributes. NIST SP 1800-5C: IT Asset Management 2Table 1-1 Build Architecture Component List Internet Protocol Operating T Host Product Function sih Address System p u b Demilitarized Zone cil ta Bro Bro Network security monitor 172.16.0.20 Ubuntu 14.04 oi n si FathomSensor RedJack Fathom Network analysis 172.16.0.50 CentOS 7 a v a OpenSwan OpenSwan Virtual Private Network 172.16.0.67 Ubuntu 14.04 ali b (VPN) el erf Router0 pfSense Router/firewall 172.16.0.11 BSD pfSense e o 10.33.5.9 appliance c f ah Snort Cisco/Sourcefire Intrusion Detection 172.16.0.40 Ubuntu 14.04 r eg Snort System rf mo Apt-cacher0 Ubuntu apt-cacher Patch management 172.16.0.77 Ubuntu 14.04 : th WSUS Microsoft WSUS Patch management 172.16.0.45 Server 2012R2 t p //: IT Systems d o o.i AD1 Microsoft Active Directory manager, AAA, 172.16.1.20 Server 2012R2 r /g Directory DNS 1 0 6. AD2 Microsoft Active Directory manager, AAA, 172.16.1.21 Server 2012R2 0 2 8 Directory DNS / N SI CA server Microsoft Certifi- PKI certificate authority 172.16.1.41 Server 2012R2 T S. cate Authority P 1. 08 Email Server Postfix Email server for the lab 172.16.1.50 Ubuntu 14.04 0 -5 . PE Master Puppet Labs Configuration manage- 172.16.1.40 Ubuntu 14.04 Puppet Enterprise ment Router1 pfSense Router/firewall 172.16.0.12 BSD pfSense 172.16.1.1 appliance Ubuntu Client1 Ubuntu Desktop Representative Linux DHCP Ubuntu 14.04 client Win7-Client1 Microsoft Representative Windows DHCP Windows 7 Windows7 client Enterprise Win7-Client2 Microsoft Representative Windows DHCP Windows 7 Windows7 client Enterprise Network Security Router2 pfSense Router/firewall 172.16.0.13 BSD pfSense 172.16.2.11 appliance BelManage Belarc BelManage Software, hardware, 172.16.2.71 Windows Server configuration information 2012R2 NIST SP 1800-5C: IT Asset Management 3Internet Protocol Operating Host Product Function Address System T BDA Belarc BelManage Analytic information for 172.16.2.72 Windows 7 h p si Data Analytics BelManage u b cil OpenVAS OpenVAS Vulnerability analysis 172.16.2.33 Ubuntu 14.04 a t system oi n si Physical Asset Management a v a Router3 pfSense Router/firewall 172.16.0.14 BSD pfSense ali b 172.16.3.11 appliance el erf AssetCentral AlphaPoint IT and datacenter asset 172.16.3.103 CentOS7 e o AssetCentral management system c f ah CA ITAM CA Technologies IT Lifecycle asset manage- 172.16.3.92 Windows Server r eg Asset Manager ment 2012R2 rf o m Physical Security : h t Router4 pfSense Router/firewall 172.16.0.15 BSD pfSense t p /: 192.168.1.11 appliance / d o o.i iStar Edge Tyco iStar Edge Security system with 192.168.1.169 Embedded gr badge reader for door / 1 0 access 6. 0 2 NVR Tyco/American Digital video recorder for 192.168.1.178 Suse Linux 8 N/ Dynamics IP security cameras (JeOS) SI T VideoEdge S. P 1. Camera1 Illustra 600 IP IP security camera 192.168.1.176 Embedded 8 0 camera 0 -5 . Camera2 Illustra 600 IP IP security camera 192.168.1.177 Embedded camera CCure9000 CCure9000 Controller for iStar Edge 192.168.1.167 Windows 7 and NVR ITAM Router5 pfSense Router/firewall 172.16.0.16 BSD pfSense 172.16.5.11 appliance Splunk Splunk Enterprise Data aggregation, 172.16.5.55 RHEL 7 storage, analysis and visualization NIST SP 1800-5C: IT Asset Management 41.2.1 Build Architecture Components Overview The build architecture consists of multiple networks implemented to mirror the infrastructure of a T h typical financial industry corporation. The networks include a Demilitarized Zone (DMZ) network along si up with several subnets as shown in Figure 1-1. The DMZ network provides technologies that monitor and b cil detect cybersecurity events, conduct patch management, and provide secure access to the mainframe a t oi computer. The Physical Asset Management Network provides management of identities and credentials n a si for authorized devices and users. Network Security provides vulnerability scanning, along with a v alia database for collection and analysis of data from hardware and software components. The IT Systems b el Network conducts configuration management and validation of client machines. Physical Security erf consists of management consoles for devices that operate and manage physical security. Such devices e c fo consist of badge readers and cameras. Firewalls are configured to limit access to and from the networks, h a blocking all traffic except required internetwork communications. r g e orf Figure 1-1 ITAM Build m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5C: IT Asset Management 51.2.2 Build Network Components Internet – The public Internet is accessible by the lab environment to facilitate access for vendor T h software and NCCoE administrators. Internet access is not required to implement the build. si p u b VPN Firewall – The VPN firewall is the access control point for vendors to support the installation and cil a t configuration of their components of the architecture. The NCCoE also used this access to facilitate oi n si product training. This firewall also blocks unauthorized traffic from the public Internet to the production a v networks. Additional firewalls are used to secure the multiple domain networks (ITAM, DMZ, Network a bali Security, IT Systems, Physical Security, Physical Asset Management). Each network uses pfSense routers el rf for all of its routing and firewall needs. The router is also performing duties as an NTP server and DHCP e o e server on all subnets except the DMZ, which does not allow DHCP. c f h a Demilitarized Zone – The DMZ provides a protected neutral network space that the other networks of r g e rf the production network can use to route traffic to/from the Internet or each other. There is an external o m and internal facing subnet. The DMZ also provides technologies that monitor and detect cybersecurity : h t events, conduct patch management, and issue secure access to the mainframe computer. DMZ devices t p /: consist of Router0, Ubuntu Apt-Cacher, Bro, Fathom Sensor, Snort and WSUS. / d o o.i ITAM – The ITAM network contains the Splunk Enterprise server that serves as the IT asset management r g / 1 database. The Splunk Enterprise server gathers logging and status information from all machines in the 0 6. 0 environment. The ITAM network also contains Router5. 2 8 / N SI Network Security – The network security architecture is represented in Figure 1-1. Network security is T S. where all devices pertaining to network security reside. These devices include Intrusion Detection P 1. 8 System/Intrusion Prevention System (IDS/IPS), Security Event and Incident Management (SEIM), logging 0 0 -5 systems and vulnerability scanners. Devices within this network consist of Router2, OpenVAS, Belarc and . Splunk Enterprise servers. IT Systems – The IT systems network is dedicated to traditional IT systems. Examples of such systems are Domain Name System (DNS), Active Directory, email, certificate authority, internal Web servers and client machines. Devices included in this subnet are Router1, two Windows 7 clients, a Wiki and two Windows 2012 Active Directory servers. One serves as primary while the other serves as a backup. Puppet Enterprise Master enforces security and configuration baselines across all endpoints. Physical Security – The physical security network houses the devices that operate and manage physical security, such as badge readers and cameras, along with their management consoles. The devices include Router4, iStar Edge, CCure controller, two badge readers and two Internet Protocol (IP) cameras. Physical Asset Management – The physical asset management network contains devices that provide and collect information regarding physical assets. The devices include Router3, AssetCentral and CA Technologies IT Asset Manager. AssetCentral is a physical asset inventory and analysis system from AlphaPoint Technology. It allows users to view assets from multiple viewpoints, including building, NIST SP 1800-5C: IT Asset Management 6room, floor, rack, project, collection, or owner. AssetCentral is running on CentOS Linux. CA IT Asset Manager allows users to holistically manage IT hardware assets, from planning and requisition to retirement and disposal. T h si p bu 1.2.3 Operating Systems cil a oit All machines used in the build had either Windows 7 enterprise, Windows server 2012 R2, Ubuntu n si 14.04, RedHat Enterprise Linux 7.1 or CentOS 7 operating systems (OSs) installed. a v a bali 1.2.3.1 Base Windows Installation and Hardening Details el erf The NCCoE base Windows OS images are Server 2012 R2 x86_64 and Windows 7 Enterprise x86_64 e c fo Department of Defense (DoD) Security Technical Implementation Guide (STIG) images. The installation h a of both Windows systems was performed using installation media provided by the Defense Information r g rf e Systems Agency (DISA). These images were chosen because they are standardized, hardened and fully o m documented. : h t t /:p 1.2.3.2 Base Linux Installation and Hardening Details / d o o.i The NCCoE base Linux OS is CentOS 7. This OS is available as an open source image. The OS was r /g configured to meet the DoD CentOS 6, STIG. No CentOS 7 STIG was available at the time the build was 1 0 6. implemented. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5C: IT Asset Management 71.3 Typographic Conventions The following table presents typographic conventions used in this volume. T h si p u Typeface/Symbol Meaning Example b cil a Italics file names and path names; For detailed definitions of terms, see t oi n references to documents that the NCCoE Glossary. si a are not hyperlinks; new v a ali terms; and placeholders b el Bold names of menus, options, Choose File > Edit. rf e command buttons, and fields e c fo Monospace command-line input, mkdir h a on-screen computer output, r g e sample code examples, and rf o status codes m : h Monospace Bold command-line user input service sshd start t t p contrasted with computer /: / d output o o.i blue text link to other parts of the All publications from NIST’s NCCoE r g 1/ document, a web URL, or an are available at 0 6. email address https://www.nccoe.nist.gov. 0 2 8 / N TSI 2 Tier 1 S. P 1. 8 0 0 2.1 Software Configurations -5 . 2.1.1 Splunk Enterprise Splunk Enterprise is a software platform to search, analyze, and visualize the machine-generated data gathered from the websites, applications, sensors, and devices that comprise your IT infrastructure or business. Splunk Enterprise is comprised of a database, analytic engine, front-end and various ways of gathering data. 2.1.2 How It’s Used In the FS ITAM build Splunk Enterprise receives data from all of the sensors and IT asset management systems. Splunk Enterprise then indexes the data, analyzes it, and displays the results as both reports and graphical desktops. NIST SP 1800-5C: IT Asset Management 8Analysts can quickly view reports and dashboards to view commonly requested information. Analysts can also form ad-hoc queries on any of the data gathered and analyzed. Splunk Enterprise also provides the ability to alert on any security or performance event. T h si up On the high-level architecture diagram Splunk Enterprise is the Tier 1 ITAM server. Splunk Enterprise is b cil running its own syslog server and collecting syslog information from all hosts on the network (port 514 a t oi TCP/UDP). Splunk Enterprise utilizes several methods to acquire data from the ITAM systems which are n a si shown in Table 2-1. The Splunk Enterprise server listens on TCP port 9997 for connections from v a Universal Forwarders. ali b el rf Table 2-1 Splunk Enterprise Data Collection Methods e e o c f Product Method h a gr AssetCentral Database Connection e rf o Bro Splunk Universal Forwarder m : th CA Technologies ITAM Database Connection t p //: Snort Splunk Universal Forwarder d o o.i Fathom Splunk Universal Forwarder r g / 1 BelManage Database Connection 0 6. 0 2 Puppet Splunk Universal Forwarder 8 / N SI Tyco Files & Directories T S. P WSUS Splunk Universal Forwarder 1. 8 0 OpenVAS Splunk Universal Forwarder 0 -5 . Vanguard Splunk Universal Forwarder 2.1.3 Installing Splunk Enterprise 1. Splunk Enterprise is installed on a hardened RedHat Enterprise Linux system. Please download the latest RPM file from Splunk and follow the instructions for installing from an RPM file. Instal- lation was performed following the instruction from Splunk at http://docs.splunk.com/Docu- mentation/Splunk/6.2.3/Installation/InstallonLinux#RedHat_RP% 20M_install. 2. After installing the RPM file (explained in the Splunk Enterprise installation instructions), the fol- lowing steps are recommended to start Splunk Enterprise automatically at boot time: cd <splunk install_directory>/bin Commonly: cd /opt/splunk/bin ./splunk start --accept-license NIST SP 1800-5C: IT Asset Management 9./splunk enable boot-start ./splunk enable boot-start -user splunkuser T h ./splunk start si p bu 3. Splunk Enterprise also requires several ports to be opened through the firewall(s). To allow cil a these ports through the built-in firewall on RHEL, enter the following commands: t oi n si sudo firewall-cmd -permanent --add-port =8000/tcp a v alia sudo firewall-cmd -permanent --add-port =9997/tcp b rf el sudo firewall-cmd -permanent --add-port =514/tcp e e o sudo firewall-cmd -permanent --add-port =514/udp c f h a sudo firewall-cmd -reload r g e rf sudo firewall-cmd -list-ports o m : h 4. It is also recommended to increase the number of files that can be open simultaneously. This is t t /:p done by editing the /etc/security/limits.conf file. Please add the following lines to the end of / od /etc/security/limits.conf: o.i r /g soft nproc 8192 1 0 6. hard nproc 8192 0 2 8 N/ soft nofile 8192 SI T S. soft nofile 8192 P 1. 8 0 Note: These will not take effect until you log off and on again. You can issue the ulimit—a 0 -5 . command to verify that it worked. 5. Splunk Enterprise can now be accessed by opening a web browser and going to http://localhost:8000 Initial login = admin Initial password = changeme 2.1.3.1 Disable Transparent Huge Pages Using Transparent Huge Pages causes performance degradation of up to 30% when using Splunk Enterprise. Splunk recommends disabling Huge Transparent Pages and details the issue at http://docs.splunk.com/Documentation/Splunk/6.2.3/ReleaseNotes/SplunkandTHP. 1. To disable Transparent Huge Pages, we added the following lines to the end of /etc/rc.d/rc.local: #disable THP at boot time NIST SP 1800-5C: IT Asset Management 10if test -f /sys/kernel/mm/transparent_hugepage/enabled; then echo never > /sys/kernel/mm/transparent_hugepage/enabled fi T h si p if test -f /sys/kernel/mm/transparent_hugepapge/defrag; then echo never > u b sys/kernel/mm/transparent_hugepapge/defrag cil a oit fi n si a 2. Ensure that rc.local is executable: v a bali chmod +x /etc/rc.d/rc.local el erf 3. Run the rc.local script to make the changes: e o c f /etc/rc.d/rc.local h a r g e rf 2.1.4 Configurations o m : th 2.1.4.1 Splunk Enterprise Data Inputs t p /: / d o 2.1.4.1.1 Syslog TCP ro.i 1. Go to Settings > Data Inputs > TCP. g / 1 0 6. Figure 2-1 Splunk Enterprise Syslog TCP Input 0 2 8 / N SI T S. P 1. 8 0 0 -5 . 2.1.4.1.2 Syslog UDP 1. Go to Settings > Data Inputs > UDP. Figure 2-2 Splunk Enterprise Syslog UDP Input NIST SP 1800-5C: IT Asset Management 112.1.4.1.3 Receive Data from Splunk Universal Forwarders 1. Go to Settings > Forwarding and Receiving > Configure Receiving. T h 2. Click the New button, and enter port 9997. si p u b Figure 2-3 Splunk Enterprise Receive from Splunk Universal Forwarder cil a t oi n si a v a ali b el rf e e o hc f a r g e rf 2.1.4.2 Splunk Enterprise Indexes o m : h Splunk Enterprise stores events in indexes. By default, the main index holds all events. However, using t t p multiple indexes has several benefits including controlling user access to events, different retention /: / d policies for different events, and faster searches in certain situations. A separate index was created for o o.i each input type and stored in the data directory (/data/splunk). Table 2-2 contains the list of indexes r g / 1 that were created. 0 6. 0 82 To create a new index, follow these steps. / N SI T 1. On the web page for Splunk Enterprise (https://172.16.5.55:8000). S. P 1. 8 2. Navigate to Settings > Indexes. Then, click New. 0 0 -5 . 3. Enter a Name for the index (see Table 1-1 for the list of names). 4. Ensure that the Home Path is set to /data/splunk. Follow the above steps for each index that you need to create. For additional information on indexes, go to: http://docs.splunk.com/Documentation/Splunk/6.2.3/Indexer/Setupmultipleindexes. Table 2-2 Splunk Enterprise Indexes Index Name alerts assetcentral belmanage_computers belmanage_hotfixesmissing belmanage_hw_changes NIST SP 1800-5C: IT Asset Management 12Index Name belmanage_sw_changes T h belmanage_software si p bu bro cil ta ca_itam oi n si fathom a v alia firewall b el mainframe rf e e openvas o c f h puppet a r g e router_configs rf o m snort : h t pt syslog /: / d tyco o o.i gr wsus / 1 0 6. 0 2.1.4.3 Splunk Enterprise Apps 2 8 / N SI Several Splunk Enterprise Apps were used in this project. The list of Splunk Enterprise Apps needed for T S. the ITAM project can be found in Table 2-3. Splunk Enterprise Apps assist in processing, analyzing and P 1. 8 displaying different types of data. To download Splunk Enterprise Apps you must have a valid Splunk 0 0 -5 account. You can install Splunk Enterprise Apps from https://splunkbase.splunk.com/. . To install Splunk Enterpise Apps, follow these steps: 1. Download App from https://splunkbase.splunk.com/. 2. On Splunk Enterprise web (https://172.16.5.55:8000). a. Apps (top left of web page) > Manage Apps b. Click Install app from file. Table 2-3 Splunk Enterprise Apps Splunk Add-On for Bro Extracts information from Bro logs. Splunk WebLog Add-On Extracts information from web logs, such as those from an Apache server. Splunk for Snort Extracts information from Snort logs. NIST SP 1800-5C: IT Asset Management 13Splunk DB Connect v2 Run queries on external databases and stores the info in Splunk Enterprise indexes. hT Splunk App for CEF Extracts Common Event Format data si up Technology Add-On for pfSense Extracts information from pfSense router logs. b acil IP Reputation Provides IP reputation information for Splunk Enterprise queries. t oi si n Google Maps Provides geographic information and display for IP addresses. a v a ali b el The Splunk DB Connect v2 app requires the downloading and installation of specific database drivers. rf e Database-specific drivers should be placed in the directory e o c f $SPLUNK_HOME/etc/apps/splunk_app_db_connect/bin/lib. This project required the installation of h a database drivers for Microsoft SQL and MySQL. The drivers must be obtained from the database r g e rf manufacturers; in this case Microsoft and MySQL/Oracle. For more detailed information, please refer to o m Install database drivers at : h t http://docs.splunk.com/Documentation/DBX/latest/DeployDBX/Installdatabasedrivers. The required t p /: drivers are listed in Table 2-4. / d o o.i Table 2-4 Required Database Drivers r g / 1 0 6. Database Driver 0 2 8 / Microsoft SQL sqljdbc4.jar N SI S.T MySQL mysql-connector-java-5.1.36-bin.jar P 1. 8 00 2.1.4.4 Splunk Enterprise Connections -5 . This section provides information about setting up connections that use the Splunk Enterprise DB Connect v2 app. The Splunk Enterprise DB Connect v2 app is used to connect to the following external databases: AssetCentral, BelManage and CA-ITAM. To get data from an external database Splunk Enterprise DB Connect v2 requires 3 main steps: 1. Setup an identity. The identity is the username used to log into the database. 2. Setup a connection. The connection is the network and database information. 3. Setup an operation. The operation is what you want to do with the database (run an SQL query). Table 2-5 provides the information needed to perform these steps. NIST SP 1800-5C: IT Asset Management 14Table 2-5 DB Connect v2 Identities Identity Used with T h si asset_query AssetCentral p u b cil mike BelManage a t oi splunk CA ITAM n si a av 2.1.4.4.1 Splunk Enterprise DB Connect v2 Connections bali There should only be one database connection to each individual database. The database connections el rf use the identities listed in Table 2-5. Please remember to select the Enable button when you configure e e o each connection. c f h ra DB Connect V2 AssetCentral Connection: g e orf ▪ AssetCentral m : th ▪ Status: Enabled t p /: / d ▪ Connection Name: assetcentral o ro.i ▪ App: Splunk DB Connect v2 g / 1 6.0 ▪ Host: assetcentral 0 2 8 ▪ Database Types: MySQL / N SI T ▪ Default Database: assetcentral S. P 81. ▪ Identity: asset_query 0 0 -5 ▪ Port: 3306 . ▪ Enable SSL: NOT CHECKED ▪ Readonly: NOT CHECKED DB Connect V2 BelManage Connection: ▪ BelManage ▪ Status: Enabled ▪ Connection Name: BelManage ▪ App: Splunk DB Connect v2 ▪ Host: belmanage ▪ Database Types: MS-SQL Server Using MS Generic Driver ▪ Default Database: BelMonitor82_1 NIST SP 1800-5C: IT Asset Management 15▪ Identity: mike ▪ Port: 1433 T sih ▪ Enable SSL: NOT CHECKED p u b ▪ Readonly: NOT CHECKED cil a oit DB Connect V2 CA-ITAM Connection: n si a ▪ CA-ITAM v a bali ▪ Status: Enabled el erf ▪ Connection Name: ca-itam e o c f ▪ App: Splunk DB Connect v2 h a r eg ▪ Host: ca-itam rf o m ▪ Database Types: MS-SQL Server Using MS Generic Driver : h tt ▪ Default Database: mdb p /: / od ▪ Identity: splunk o.i gr ▪ Port: 1433 / 1 0 6. ▪ Enable SSL: NOT CHECKED 0 2 8 N/ ▪ Readonly: NOT CHECKED SI T PS. 2.1.4.4.2 Splunk Enterprise DB Connect v2 Operations 1. 8 Operations are the SQL operations performed on the database connections and the results are saved 0 0 -5 into Splunk Enterprise indexes. The operations can be run automatically, on a recurring basis, or when . new data is detected. Each operation has four components: ▪ Name Input ▪ Choose and Preview Table ▪ Set Parameters ▪ Metadata NIST SP 1800-5C: IT Asset Management 16The following subsections show the configurations for each operation. AssetCentral: T h p si DB Input: assetcentral u b cil 1. Name Input a t oi n si a. Status: Enabled a v a ali b. Name: assetcentral b el rf c. Description: Assets from AssetCentral e e o c f d. App: Splunk DB Connect v2 h a r eg e. Connection: assetcentral rf o m : h f. Click the Continue button. t t p /: 2. Choose and Preview Table / d o o.i a. Make sure that Simple Query Mode is selected. r g / 1 0 b. Catalog: assetcentral 6. 0 2 /8 c. Schema: NULL N SI T S. d. Table: assetview P 1. 8 0 e. Max rows: 100 0 -5 . f. Click the Magnifying Glass button and up to 100 rows should be returned and displayed. g. Click the Continue button. 3. Set Parameters a. Type: Batch Input b. Max Rows to Retrieve: 100000 c. Timestamp: Current Index Time d. Output Timestamp Format: YYYY-MM-dd HH:mm:ss e. Execution Frequency: 0 0 * * * f. Click the Continue button. NIST SP 1800-5C: IT Asset Management 174. Metadata a. Source: assetcentral T h p si b. Sourcetype: assetcentral u b cil c. Index: assetcentral a t oi n si d. Select Resource Pool: local a v a ali e. Click the Save button. b el rf BelManage_Computers: e e o c f DB Input: BelManage_Computers h a r eg 1. Name Input rf o m : h a. Status: Enabled t t p /: b. Name: BelManage_Computers / d o o.i c. Description: Computer info from BelManage r g / 1 0 d. App: Splunk DB Connect v2 6. 0 2 /8 e. Connection: BelManage N SI T S. f. Click the Continue button. P 1. 8 0 2. Choose and Preview Table 0 -5 . a. Make sure that Simple Query Mode is selected. b. Catalog: BelMonitor82_1 c. Schema: dbo d. Table: Computers e. Max rows: 100 f. Click the Magnifying Glass button and up to 100 rows should be returned and displayed. g. Click the Continue button. 3. Set Parameters a. Type: Rising Column b. Max Rows to Retrieve: 100000 NIST SP 1800-5C: IT Asset Management 18c. Specify Rising Column: ProfileDate d. Timestamp: Current Index Time T h p si e. Output Timestamp Format: YYYY-MM-dd HH:mm:ss u b cil f. Execution Frequency: * * * * * a t oi n si g. Click the Continue button. a v a ali 4. Metadata b el rf a. Source: belmanage e e o c f b. Souretype: belmanage_computers h a r eg c. Index: belmanage_computers rf o m : h d. Select Resource Pool: local t t p /: e. Click the Save button. / d o o.i Belmanage_hotfixesmissing: r g / 1 0 DB Input: belmanage_hotfixesmissing 6. 0 2 /8 1. Name Input N SI T S. a. Status: Enabled P 1. 8 0 b. Name: belmanage_hotfixesmissing 0 -5 . c. Description: List of hotfixes/patches missing from each computer d. App: Splunk DB Connect v2 e. Connection: BelManage f. Click the Continue button. 2. Choose and Preview Table a. Make sure that Advanced Query Mode is selected. b. In the entry box type in the following SQL statement: SELECT HotfixesMissing.*, Computers.ProfileName, Comput-ers.NetworkIPAddress FROM HotfixesMissing INNER JOIN Computers on HotfixesMissing.Id = Computers.Id NIST SP 1800-5C: IT Asset Management 19c. Click the Magnifying Glass button and up to 100 rows should be returned and displayed. d. Click the Continue button. T h p si 3. Set Parameters u b cil a. Type: Batch Input a t oi n si b. Max Rows to Retrieve: 100000 a v a ali c. Timestamp: Current Index Time b el rf d. Output Timestamp Format: YYYY-MM-dd HH:mm:ss e e o c f e. Execution Frequency: 30 4 * * * h a r eg f. Click the Continue button. rf o m : h 4. Metadata t t p /: a. Source: belmanage / d o o.i b. Sourcetype: belmanage_hotfixesmissing r g / 1 0 c. Index: belmanage_hotfixesmissing 6. 0 2 /8 d. Select Resource Pool: local N SI T S. e. Click the Save button. P 1. 8 0 Belmanage_hw_changes: 0 -5 . DB Input: belmanage_hw_changes 1. Name Input a. Status: Enabled b. Name: belmanage_hw_changes c. Description: BelManage hardware changes d. App: Splunk DB Connect v2 e. Connection: BelManage f. Click the Continue button. 2. Choose and Preview Table a. Make sure that Simple Query Mode is selected. NIST SP 1800-5C: IT Asset Management 20b. Catalog: BelMonitor82_1 c. Schema: dbo T h p si d. Table: HistoryReportAllHardware u b cil e. Max rows: 100 a t oi n si f. Click the Magnifying Glass button and up to 100 rows should be returned and displayed. a v a ali g. Click the Continue button. b el rf 3. Set Parameters e e o c f a. Type: Rising Column h a r eg b. Max Rows to Retrieve: 10000 rf o m : h c. Specify Rising Column: ActionDate t t p /: d. Timestamp: Current Index Time / d o o.i e. Output Timestamp Format: YYYY-MM-dd HH:mm:ss r g / 1 0 f. Execution Frequency: */15 * * * * 6. 0 2 /8 g. Click the Continue button. N SI T S. 4. Metadata P 1. 8 0 a. Source: belmanage 0 -5 . b. Sourcetype: belmanage_hw_changes c. Index: belmanage_hw_changes d. Select Resource Pool: local e. Click the Save button. Belmanage_software: DB Input: belmanage_software 1. Name Input a. Status: Enabled b. Name: belmanage_software c. Description: Software from BelManage NIST SP 1800-5C: IT Asset Management 21d. App: Splunk DB Connect v2 e. Connection: BelManage T h p si f. Click the Continue button. u b cil 2. Choose and Preview Table a t oi n si a. Make sure that Advanced Query Mode is selected. a v a ali b. In the entry box type in the following SQL statement: b el rf SELECT e e o ProfileName, c f h ra Directory, g e rf C.ProfileDate AS ProfileDate_soft, CAST(C.ProfileDate AS DATE) AS o m ProfileDateDate_soft, : h t pt DATEDIFF (dd, ProfileDate, GETDATE() ) AS ProfileDateDaysAgo_soft, /: / DATEDIFF (mm, ProfileDate, GETDATE() ) AS ProfileDate-MonthsAgo_soft, d o o.i CASE WHEN CAST ( (CAST(GETDATE() AS FLOAT) - CAST(ProfileDate AS FLOAT)) r g 1/ AS INT) < 31 THEN 'yes' ELSE 'no' END AS 0 6. 0 ProfileDateWithin-Last30Days_soft, 2 8 / N CASE WHEN CAST ( (CAST(GETDATE() AS FLOAT) - CAST(ProfileDate AS FLOAT)) SI T AS INT) < 61 THEN 'yes' ELSE 'no' END AS S. P 81. ProfileDateWithin-Last60Days_soft, 0 0 -5 CASE WHEN CAST ( (CAST(GETDATE() AS FLOAT) - CAST(ProfileDate AS FLOAT)) . AS INT) < 91 THEN 'yes' ELSE 'no' END AS ProfileDateWithin-Last90Days_soft, CASE WHEN LastUsedTime > CAST('1971-01-01' AS smalldatetime) THEN LastUsedTime ELSE NULL END AS LastUsedTime_soft, CASE WHEN LastUsedTime > CAST('1971-01-01' AS smalldatetime) THEN CAST(LastUsedTime AS DATE) ELSE NULL END AS LastUsedDate_soft, -- SS2005 compatible:CASE WHEN LastUsedTime > CAST('1971-01-01' AS smalldatetime) THEN CAST(FLOOR(CAST(LastUsedTime AS FLOAT)) AS smalldatetime) ELSE NULL END AS LastUsedDate_soft, CASE WHEN LastUsedTime > CAST('1971-01-01' AS smalldatetime) THEN DATEDIFF(dd,LastUsedTime, C.ProfileDate) ELSE NULL END AS LastUsed-DaysAgo_soft, CASE WHEN LastUsedTime > CAST('1971-01-01' AS smalldatetime) THEN DATEDIFF(mm,LastUsedTime, C.ProfileDate) ELSE NULL END AS NIST SP 1800-5C: IT Asset Management 22LastUsed-MonthsAgo_soft, CASE WHEN LastUsedTime > CAST('1971-01-01' AS smalldatetime) THEN CASE WHEN CAST ( (CAST(C.ProfileDate AS FLOAT) - CAST(LastUsedTime AS FLOAT)) T sih AS INT) < 31 THEN 'yes' ELSE 'no' END ELSE NULL END AS p u b LastUsedTimeWithinLast30Days_soft, cil a oit CASE WHEN LastUsedTime > CAST('1971-01-01' AS smalldatetime) THEN CASE si n WHEN CAST ( (CAST(C.ProfileDate AS FLOAT) - CAST(LastUsedTime AS FLOAT)) a AS INT) < 61 THEN 'yes' ELSE 'no' END ELSE NULL END AS v a bali LastUsedTimeWithinLast60Days_soft, el rf CASE WHEN LastUsedTime > CAST('1971-01-01' AS smalldatetime) THEN CASE e e o WHEN CAST ( (CAST(C.ProfileDate AS FLOAT) - CAST(LastUsedTime AS FLOAT)) c f AS INT) < 91 THEN 'yes' ELSE 'no' END ELSE NULL END AS h a r eg LastUsedTimeWithinLast90Days_soft, rf o m Company AS Company_soft, Product AS Product_soft, Version6Part AS : h Version6Part_soft, Version AS Version_soft, t t p /: CAST(dbo.VersionMajor(Version6Part) AS varchar(6)) AS Ver-sionMajor_soft, / d o o.i CAST(dbo.VersionMajor(Version6Part) AS varchar(6)) + '.' + r g CAST(dbo.VersionMinor(Version6Part) AS varchar(6)) AS VersionMa- / 1 0 jorMinor_soft, 6. 0 82 CAST(dbo.VersionMajor(Version6Part) AS varchar(6)) + '.' + / N CAST(dbo.VersionMinor(Version6Part) AS varchar(6)) + '.' + SI T CAST(dbo.VersionRev(Version6Part) AS varchar(6)) AS VersionMajorMi- S. P norRev_soft, 1. 8 00 FileDescription, Filename, FileSize, -5 . dbo.VersionFormat(dbo.VersionCompose (ProductVersionNoMS, ProductVersionNoLS)) AS ProductVersionNo, dbo.VersionFormat(dbo.VersionCompose (FileVersionNoMS, FileVer-sionNoLS)) AS FileVersionNo, CASE StartUp WHEN 1 THEN 'auto' ELSE 'user' END AS StartUp, CASE InUse WHEN 1 THEN 'yes' WHEN 0 THEN 'no' ELSE NULL END AS InUse, CASE ServiceStatus WHEN 1 THEN 'running' WHEN 0 THEN 'stopped' ELSE NULL END AS ServiceStatus, CASE ServiceStartType WHEN 2 THEN 'auto' WHEN 3 THEN 'manual' WHEN 4 THEN 'disabled' ELSE NULL END AS ServiceStartType, LastUserDomain, LastUser, LastUserFullName, CASE WHEN Is64Bit = 1 THEN 'yes' ELSE 'no' END AS Is64Bit, NIST SP 1800-5C: IT Asset Management 23CASE WHEN IsNativeToOs = 1 THEN 'yes' ELSE 'no' END AS IsNativeToOs, MachineType, ExeHeaderTypeLong AS ExeHeaderType, LoginUser, T h si p S.Language AS Language_soft, S.LanguageName AS LanguageName_soft FROM u b cil Software S INNER JOIN Computers C ON S.Id = C.Id; a t oi n c. Click the Magnifying Glass button and up to 100 rows should be returned and displayed. si a v alia d. Click the Continue button. b el rf 3. Set Parameters e e c fo a. Type: Rising Column h a r g b. Max Rows to Retrieve: 10000 e rf o m c. Specify Rising Column: ProfileDate_soft : h t t p d. Timestamp: Current Index Time /: / d o o.i e. Output Timestamp Format: YYYY-MM-dd HH:mm:ss r g / 01 f. Execution Frequency: * * * * 6. 0 2 8 g. Click the Continue button. / N SI S.T 4. Metadata P 1. 08 a. Source: belmanage 0 -5 . b. Sourcetype: belmanage_software c. Index: belmanage_software d. Select Resource Pool: local e. Click the Save button. Belmanage_sw_changes: DB Input: belmanage_sw_changes 1. Name Input a. Status: Enabled b. Name: belmanage_sw_changes c. Description: Software changes from BelManage NIST SP 1800-5C: IT Asset Management 24d. App: Splunk DB Connect v2 e. Connection: BelManage T h p si f. Click the Continue button. u b cil 2. Choose and Preview Table a t oi n si a. Make sure that Simple Query Mode is selected. a v a ali b. Catalog: BelMonitor82_1 b el rf c. Schema: dbo e e o c f d. Table: SoftwareHistoryReport h a r eg e. Max rows: 100 rf o m : h f. Click the Magnifying Glass button and up to 100 rows should be returned and displayed. t t p /: g. Click the Continue button. / d o o.i 3. Set Parameters r g / 1 0 a. Type: Rising Column 6. 0 2 /8 b. Max Rows to Retrieve: 100000 N SI T S. c. Specify Rising Column: ActionDate P 1. 8 0 d. Timestamp: Current Index Time 0 -5 . e. Output Timestamp Format: YYYY-MM-dd HH:mm:ss f. Execution Frequency: */30 * * * * g. Click the Continue button. 4. Metadata a. Source: belmanage b. Sourcetype: belmanage_sw_changes c. Index: belmanage_sw_changes d. Select Resource Pool: local e. Click the Save button. NIST SP 1800-5C: IT Asset Management 25CA ITAM: DB Input: ca-itam T h p si 1. Name Input u b cil a. Status: Enabled a t oi n si b. Name: ca-itam a v a ali c. Description: Asset from CA ITAM software b el rf d. App: Splunk DB Connect v2 e e o c f e. Connection: ca-itam h a r eg f. Click the Continue button. rf o m : h 2. Choose and Preview Table t t p /: a. Make sure that Advanced Query Mode is selected. / d o o.i b. In the entry box type in the following SQL statement: r g / 1 0 SELECT DISTINCT 6. 0 82 aud_ca_owned_resource.resource_name,audit_model_uuid,audit_resource_cl / N ass, audit_resource_subclass, SI T ca_owned_resource.own_resource_id,ca_owned_resource.mac_address,ca_own S. P ed_resource.ip_address,ca_owned_resource.host_name,ca_owned_resource.s 1. 8 erial_number,ca_owned_resource.asset_source_uuid,ca_owned_resource.cre 0 0 ation_user,ca_owned_resource.creation_date, -5 . al_aud_contact_view.first_name, al_aud_contact_view.middle_name, al_aud_contact_view.last_name, al_aud_contact_view.pri_phone_number, ca_owned_resource.last_update_date FROM aud_ca_owned_resource INNER JOIN ca_owned_resource ON aud_ca_owned_resource.resource_name=ca_owned_resource.resource_name INNER JOIN al_aud_contact_view ON ca_owned_resource.resource_contact_uuid = al_aud_contact_view.contact_uuid c. Click the Magnifying Glass button and up to 100 rows should be returned and displayed. d. Click the Continue button. 3. Set Parameters a. Type: Rising Column NIST SP 1800-5C: IT Asset Management 26b. Max Rows to Retrieve: 1000 c. Specify Rising Column: last_update_date T h p si d. Timestamp: Current Index Time u b cil e. Output Timestamp Format: YYYY-MM-dd HH:mm:ss a t oi n si f. Execution Frequency: */5 * * * * a v a ali g. Click the Continue button. b el rf 4. Metadata e e o c f a. Source: ca-itam h a r eg b. Sourcetype: ca-itam rf o m : h c. Index: ca_itam t t p /: Note: the index name is ca_itam with an underscore. Splunk Enterprise does not accept / d o dashes in index names. o.i r g 1/ d. Select Resource Pool: local 0 6. 0 2 e. Click the Save button. 8 / N SI S.T 2.1.5 Lookup Table Files P 1. 08 Several lookup table files are necessary for this project. The lookup table files are in comma separated 0 -5 value format and contain data generated by reports that are used in other reports and dash-boards. . To create a lookup table file: 1. Open the Splunk Enterprise web page (https://172.16.5.55:8000) and go to the Lookup table files page. 2. Select Settings > Lookups. 3. Click Lookup table files. 4. Click the New button. Create the following lookup table files: ▪ /opt/splunk/etc/apps/search/lookups/AssetRisk_Alltime.csv ▪ /opt/splunk/etc/apps/search/lookups/AssetRisk_Last7days.csv ▪ /opt/splunk/etc/apps/search/lookups/AssetRisk_Last24hours.csv NIST SP 1800-5C: IT Asset Management 27▪ /opt/splunk/etc/apps/search/lookups/asset_value_table.csv ▪ /opt/splunk/etc/apps/search/lookups/license_table.csv T sih ▪ /opt/splunk/etc/apps/search/lookups/updown p u b ▪ /opt/splunk/etc/apps/search/lookups/vun_rating_table.csv cil a t oi 2.1.5.1 Splunk Enterprise Configuration Files n si a v Splunk Enterprise configuration files can be found in the external file titled a bali Splunk_Configuration_Files.tar.gz. el rf e Configuration files are stored on Splunk Enterprise in the $SPLUNK_HOME/etc/system/local directory. e o c f h 2.1.5.2 Splunk Enterprise Dashboards a r g e rf Splunk Enterprise stores dashboards in XML format. All of the dashboards can be found in the external o m file titled Splunk_Dashboards.tar.gz. : h t t p /: Splunk Enterprise dashboard files are stored on Splunk Enterprise in the / d o $SPLUNK_HOME/etc/apps/search/local/data/ui/views directory. o.i r g 1/ 2.1.5.3 Restarting Splunk Enterprise After Configuration File Changes 0 6. 0 2 When you make changes to Splunk Enterprise using configuration files, you might need to restart Splunk 8 / N Enterprise for the changes to take effect. See the following link for details: SI T S. http://docs.splunk.com/Documentation/Splunk/6.2.3/Admin/Configurationfilechangesthatreq P 1. uirerestart. 8 0 0 -5 . 3 Tier 2 3.1 AssetCentral AssetCentral is an IT infrastructure management system that stores and displays information related to physical assets including location, make, model, and serial number. AssetCentral can help run an entire data center by monitoring weight, utilization, available space, heat and power distribution. AssetCentral is installed on a CentOS7 system. 3.1.1 How It’s Used In the FS ITAM build AssetCentral is used to provide physical asset location. AssetCentral provides the building, room and rack of an asset. NIST SP 1800-5C: IT Asset Management 283.1.2 Virtual Machine Configuration The virtual machine is configured with 1 network interface cards, 4 GB of RAM and 1 CPU cores. T h si p 3.1.3 Network Configuration u b cil ta The management network interface card is configured as such: oi n a si ▪ IPv4 Manual v a ali ▪ IPv6 Ignore/Disabled b el rf ▪ IP Address: 172.16.1.50 e e c fo ▪ Netmask: 255.255.255.0 h a r ▪ Gateway: 172.16.1.11 g e orf ▪ DNS Servers: 172.16.1.20, 172.16.1.21 m : th ▪ Search Domains: lab5.nccoe.gov t p /: / od 3.1.4 Installing AssetCentral o.i r g / AssetCentral is installed on a hardened CentOS7 Linux system. AssetCentral requires PHP, Web Server 1 0 6. (Apache) and MySQL database to be installed. 0 2 8 / N Table 3-1 Recommended Versions for AssetCentral – Tier 2 SI T S. P 1. Vendor Product Version 8 0 0 RedHat Enterprise Linux Server 6.4 (Santiago) (x86_64) -5 . Apache Web Server httpd-2.2.15-26.el6.x86_64 mysql Server 5.1.66 php 5.33 or higher 3.1.5 Installing MySQL (MariaDB) # yum -y install mariadb-server mariadb #systemctl start mariadb.service #systemctl enable mariadb.service # mysql_secure_installation 1. Answer the questions with the default answers while performing the mysql_secure_installation. 2. Create a database – assetcentral. NIST SP 1800-5C: IT Asset Management 293. Create a user – assetcentral. 4. Grant all privileges to assetcentral user. T h si p 3.1.6 Installing Apache u b acil # yum -y install httpd t oi n si #systemctl start httpd.service a v a #systemctl enable httpd.service ali b el #firewall-cmd --permanent --zone=public --add-service=http rf e e #firewall-cmd --permanent --zone=public --add-service=https o c f h #firewall-cmd -reload a r g e rf 3.1.6.1 HTTP Configuration o m : h 1. Go to HTTPD root; normally (/etc/httpd). t t p /: / d 2. Under the modules directory, make sure libphp5.so exists. o o.i gr 3. Change document root (webroot) as per environment in httpd.conf. / 1 0 6. 20 3.1.7 Installing PHP5 8 / N SI #yum -y install php T S. P #systemctl restart httpd.service 1. 8 0 0 #yum search php -5 . #yum -y install php-mysql #yum -y install php-gd php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php- snmp php-soap curl curl-devel 1. Restart Apache: #systemctl restart httpd.service 3.1.8 Post Installation Tasks 1. Copy AssetCentral files and folders from previous install to the new webroot. 2. Under the location (../assetcentral/application/config), make necessary changes as per environ- ment. NIST SP 1800-5C: IT Asset Management 303.1.8.1 Sample <?php defined('ASSET_CENTRAL') or die(''); define('AC_URL_SUBDIR', '/acprod'); T define('AC_URL_SCRIPT','/index.php'); define('AC_URL_PARAM','go'); h si define('AC_URL_PREFIX',AC_URL_SUBDIR . AC_URL_SCRIPT.'?' p u cilb . AC_URL_PARAM . '='); define('AC_ERROR_REPORTING',E_ERROR); a t oi //no slash at the end of this url define('URL_SITE','http://10.1.xx.xxx'); n si define('OS','NIX'); // *NIX WIN BSD MAC a v alia //default database (read) define('DB_TYPE_READ','MYSQL'); b define('DB_HOST_READ','127.0.0.1'); el erf //usually leave this blank for MYSQL define('DB_PORT_READ',''); e o define('DB_USER_READ','assetcentral'); define('DB_PASS_READ','xxxxx'); hc f define('DB_DATA_READ','asset_prod'); define('DB_PREFIX_READ',''); a r g e rf 3.1.9 Database Update – Add a View o m : h A database view was created on AssetCentral to gather all of the information required by the ITAM t t p /: project in one place. This database view is accessed directly from Splunk Enterprise. / d o o.i 1. On the AssetCentral machine, open a terminal window and type the following command to en- r g 1/ ter the MySQL client application (you will be asked for the root password of the MySQL data- 0 6. base): 0 2 8 N/ mysql assetcentral -u root -p SI T PS. 2. The following command will create the assetview view (from inside of the MySQL client applica- 1. 8 tion): 0 0 -5 . create view assetview as select a.asset_id, a.rack_id, a.system_id, a.contact_id, a.serial_number, a.asset_tag, a.asset_name, a.ip_addr, a.description, a.title, a.internal_number, rack.rack_name, rack.room_id, rack.rack_type, rack.rack_notes, s.system_name, s.system_description, c.contact_name, c.phone_number, c.email_address, room.room_name, room.floor_id, floor.floor_name from assets a left join racks rack on a.rack_id = rack.rack_id left join systems s on a.system_id = s.system_id left join contacts c on a.contact_id = c.contact_id left join rooms room on rack.room_id = room.room_id left join floors floor on room.floor_id = floor.floor_id where a.asset_deleted != 1; 3. Create a new database user and assign that user privilges on the assetview view (from inside of the MySQL client application): NIST SP 1800-5C: IT Asset Management 31create new users and privileges inside mysql/mariadb create user 'asset_query'@'localhost'; set password for 'asset_query'@'localhost' = password('password'); grant select T sih on assetcentral.assetview to 'asset_query'@'localhost'; grant file on *.* to p 'asset_query'@'localhost'; u b cil a 4. Ensure that the MySQL network port is listening and is allowed through the firewall. You must t oi n be root to run these commands. si a v a 5. To verify that MySQL is listening: ali b el netstat -l |grep mysql rf e e o 6. To allow MySQL through the firewalld firewall: c f h a firewall-cmd -permanent -add-service=mysql firewall-cmd -reload r g e orf 7. To make sure the firewall rule was added correctly: m : th firewall-cmd -list-services t p /: / od 3.1.10 Add Assets into AssetCentral o.i r g / For AssetCentral to be of use, the end user must populate the system with all of the IT hardware to be 1 0 6. tracked. 0 2 8 / N AssetCentral provides a manual method of adding one or two assets as well as an automated method of SI S.T adding numerous assets that have been saved in a spreadsheet. P 1. 8 00 3.2 BelManage -5 . BelManage is installed on a Windows Server 2012R2 system. BelManage gathers hardware and software information from computers on the network. BelManage gathers, stores, analyzes and displays the hardware and software information in a Web application. The BelMonitor client is installed on all computers in the network and automatically sends the BelManage server information on hardware and software changes. 3.2.1 How It’s Used The ITAM system is using BelManage for its data gathering, analysis and reporting features. BelManage reports on all software installed and all hardware configurations for every machine on the network that is running the BelMonitor client. Splunk Enterprise connects to the BelManage database to pull data and provide further analysis and correlation. NIST SP 1800-5C: IT Asset Management 323.2.2 Virtual Machine Configuration The BelManage virtual machine is configured with 1 network interface card, 8 gigabytes (GB) of random T h access memory (RAM) and one central processing unit (CPU) core. si p u b cil 3.2.3 Network Configuration a t oi si n The management network interface card is configured as follows: a v alia ▪ IPv4 Manual b el ▪ IPv6 Disabled rf e e o ▪ IP Address: 172.16.2.71 c f h a ▪ Netmask: 255.255.255.0 r g e rf ▪ Gateway: 172.16.2.11 o m : h ▪ DNS Servers: 172.16.1.20, 172.16.1.21 t t p /: ▪ Search Domains: lab5.nccoe.gov / d o o.i r 3.2.4 Installing BelManage g / 1 0 6. Before installing BelManage, verify that your Windows Server 2012R2 system is installed correctly, 0 2 8 updated and that the network is correctly configured and working. Additionally, you may have to disable / N SI or modify some security services, such as AppLocker, during the installation process. T S. P 1. BelManage is installed by running the BelManage server installation program 8 0 0 (BelManageServer8.1.31.exe). Documentation is provided by Belarc at -5 . https://www.belarc.com/en/products_belmanage. 3.2.4.1 Prerequisites Internet Information Server (IIS) 4.0 or later must be installed. The website below has detailed instructions on installing IIS: http://www.iis.net/learn/install/installing-iis-85/installing-iis-85-on- windows-server-2012-r2. BelManage requires the following options: Static Content, Default Document, ASP Application Development, IIS Management Scripts and Tools, IIS 6 Metabase Compatibility, IIS 6 WMI Compatibility, and IIS 6 Scripting Tools. MS SQL Express will be installed as part of the normal BelManage installation process. Microsoft (MS) Structured Query Language (SQL) Server Management Studio is not required but is highly recommended. MS SQL Server Management Studio will make it easy to work on the BelManage database. Make sure you run MS SQL Server Management Studio as administrator or you will get NIST SP 1800-5C: IT Asset Management 33permission errors. Additional information can be found at: https://msdn.microsoft.com/en- us/library/ms174173.aspx. T sih 3.2.4.2 Installation Procedure p u b cil 3.2.4.2.1 Installing the BelManage Server a oit 1. Open Windows File Explorer and navigate to where your BelManage installer is located. n si a 2. Right-click on the BelManage installer file and select Run as Administrator. v a ali elb 3. Choose the default selections. rf e e Note: You will need to enter your BelManage license number during the installation process. o c f h a 3.2.4.2.2 Installing the BelManage Client r g rf e The BelMonitor client must be installed on all devices that you wish to monitor. o m : h The BelMonitor client should also be installed on the BelManage server if you wish to monitor. t t p //: 1. The BelMonitor client can be downloaded directly from the BelManage server that was just in- d o o.i stalled: Point your web browser to your BelManage server (172.16.2.71): r g / 01 http://172.16.2.71/BelManage 6. 0 2 8 2. Enter your login and password. / N SI S.T 3. Select the Getting Started option on the left side of the page. P 1. 08 4. Select Download your installable BelMonitor client from the middle of the page. 0 -5 . 5. Select the appropriate download – Windows, Linux, Mac OSX or Solaris. 6. Follow the steps in the relevant section. a. For Windows machines: i. Right-click the BelMonitor client and select Run as Administrator. ii. Then accept the default settings. The BelMonitor client will be installed and set to autorun when the system boots. There should be an icon in your system tray (right-side) that looks like a little green eye with eyelashes. b. For Linux machines: The BelMonitor client must be installed as the root user. i. To install the BelMonitorLinux client on Linux machines you must first install the 32-bit compatibility libraries. On Ubuntu the process is as follows: NIST SP 1800-5C: IT Asset Management 34apt-get install lib32stdc++6 ii. The BelMonitor client uses RPM (RedHat Package Manager) which can be installed T as follows: h si p u apt-get install rpm b cil a t iii. Make the BelMonitorLinux executable. oi n a si chmod a+x BelMonitorLinux v a ali iv. Start the installation. b el rf ./BelMonitorLinux e e o c f The BelMonitor client should now be running and reporting to the BelManage server every 15 minutes h a r (default setting). g e rf o m 3.2.5 Integration and Final Steps : h t t p 1. Use MS SQL Server Studio Manager to create a database user for the Splunk Enterprise database /: / od connection. A new user must be created and be added to the correct database for the Splunk ro.i Enterprise integration to work. g / 1 0 6. 2. Right-click MS SQL Server Studio Manager and select Run as Administrator. 0 2 8 N/ 3. Click Connect as the default settings should be correct: SI T PS. Server type: Database Engine 1. 8 0 0 Server name: BELARC\BELMANAGE -5 . Authentication: Windows Authentication 4. Once MS SQL Server Management Studio has logged in and started, create a new database user. a. Select Security > Logins. b. Right-click Logins and select New User. c. Enter a Login name. d. Select SQL Server authentication. e. Enter a password. f. Enter the password again in the Confirm password box. g. The Enforce password policy, Enforce password expiration and User must change pass- word at next login should all reflect your organization’s security rules. NIST SP 1800-5C: IT Asset Management 35Default database = BelMonitor82_1 Default language = English T h p si 5. Add the new user that you created in the preceding steps to the BelMonitor82_1 database. u b cil a. Select Databases > BelMonitor82_1 > Security > Users. a t oi n si b. Right-click Users and select New User. a v a ali c. Enter a user name for the new user in the User Name and Login Name fields. They b el should be identical. rf e e o Default schema = db_datareader c f h ra Schemas owned by this user = none selected g e rf o d. Database role membership: BelMonitorReader and db_datareader should be checked. m : h tt 6. Turn on or re-enable any security settings that you might have changed, such as AppLocker. p /: / d o o.i 3.3 Bro r g / 1 0 Bro is an open-source network security monitor. Bro efficiently analyzes all network traffic and provides 6. 20 insight into clear text password use, cryptographic certificate errors, traffic to known bad sites, network 8 / N flow, and file transfers. SI T S. P 1. 3.3.1 How It’s Used 8 0 0 -5 In the FS ITAM build, Bro monitors all traffic traversing the DMZ. Bro has a dedicated network interface . in promiscuous mode for sniffing/capturing traffic. This interface does not have an IP address assigned. Bro has a second network interface for management that is assigned IP address 172.16.0.20. When configuring Bro, make sure that Bro is sniffing/capturing on the correct network interface. On the high-level architecture diagram, Bro is in Tier 2. Bro uses the Splunk Universal Forwarder to send logs to Splunk Enterprise. Some of the logs include files, Hypertext Transfer Protocol (HTTP) traffic, Kerberos authentications, Secure Socket Layer (SSL) traffic, x509 certificates seen, known hosts, DNS traffic, all connections, notices, and intelligence alerts. 3.3.2 Virtual Machine Configuration The Bro virtual machine is configured with two network interface cards, 16 GB of RAM and four CPU cores. NIST SP 1800-5C: IT Asset Management 363.3.3 Network Configuration The management network interface card is configured as follows: T h p si ▪ IPv4 Manual u b cil ▪ IPv6 Ignore/Disabled a t oi n ▪ IP Address: 172.16.0.20 si a v ▪ Netmask: 255.255.255.0 a ali elb ▪ Gateway: 172.16.0.11 rf ee ▪ DNS Servers: 172.16.1.20, 172.16.1.21 o hc f ▪ Search Domains: lab5.nccoe.gov a r g e rf 3.3.4 Installing Bro o m : h Bro is installed on a hardened Ubuntu 14.04 Linux system. Please download the latest source package t t p /: from Bro and follow the instructions for installing from source. Installation was performed following the / d o instruction from Bro at: https://www.bro.org/sphinx/install/index.html. o.i r g / 1 3.3.4.1 Installation Prerequisites 0 6. 0 82 Bro requires the following libraries and tools to be installed before you begin: / N TSI ▪ Libpcap (http://www.tcpdump.org) S. P 1. ▪ OpenSSL libraries (http://www.openssl.org) 8 0 0 -5 ▪ BIND8 library . ▪ Libz ▪ Bash (for BroControl) ▪ Python (for BroControl) To build Bro from source, the following additional dependencies are required: ▪ CMake 2.8 or greater (http://www.cmake.org) ▪ Make ▪ C/C++ compiler ▪ SWIG (http://www.swig.org) ▪ Bison (GNU Parser Generator) ▪ Flex (Fast Lexical Analyzer) NIST SP 1800-5C: IT Asset Management 37▪ Libpcap headers (http://www.tcpdump.org) ▪ OpenSSL headers (http://www.openssl.org) T sih ▪ zlib headers p u b ▪ Perl cil a t oi 3.3.4.1.1 For Debian/Ubuntu Linux systems: n a si 1. It is always best to make sure your system is up-to-date by performing: v a ali sudo apt-get update sudo apt-get upgrade b el rf 2. Then install the prerequisites: e e o c f sudo apt-get install cmake make gcc g++ flex bison libpcap-dev libssl-dev h a python-dev swig zlib1g-dev r g e rf sudo apt-get install libgeoip-dev o m : h sudo apt-get install libgoogle-perftools-dev sudo apt-get install curl t t p /: sudo apt-get install git / d o o.i 3. Download and install Bro (this will install in /usr/local/bro): r g / 1 0 Note: You need to be root to install Bro. 6. 0 2 8 cd /usr/local / N SI T git clone https://github.com/actor-framework/actor-framework.git cd S. P /usr/local/actor-framework 1. 8 00 ./configure make -5 . make test make install 3.3.4.2 Installation Procedure cd /usr/local git clone --recursive git://git.bro.org/bro cd /usr/local/bro ./configure make make install 1. Add Bro bin directory to your runtime path: Edit .bashrc 2. Add the following line to the end of .bashrc: EXPORT PATH=/usr/local/bro/bin:$PATH NIST SP 1800-5C: IT Asset Management 383. Then: source .bashrc T h si 4. To start Bro the first time: p u b cil broctl deploy a t noi 5. To check the status of Bro: si a v broctl status a ali b el 3.3.5 Installing Intelligence Gathering Software rf e e o 1. Uses the mal-dnssearch package from Jon Schipp, which must be installed. The compiled version c f h will be installed into /usr/local/bin/mal-dnssearch. a r g e rf cd /opt o m : h git clone https://github.com/jonschipp/mal-dnssearch cd /opt/mal-dnssearch t t p /: sudo make / d o o.i sudo make install r g 1/ mkdir /usr/local/bro_intel 0 6. 20 cd /usr/local/bro_intel 8 / N SI 2. Copy the update_intel.sh script into /usr/local/bro_intel. T S. P 1. cp update_intel.sh /usr/local/bro_intel 8 0 0 chmod 700 /usr/local/bro_intel/update_intel.sh cd /usr/local/bro_intel -5 . ./update_intel.sh You should now have several files usable with the Bro Intelligence Framework, including tor.intel, mandiant.intel, and alienvault.intel. 3. To have the script run automatically every day, add a link inside /etc/cron.daily. ln -s /usr/local/bro_intel/update_intel.sh /etc/cron.daily/update_intel 3.3.6 Configuring Bro To implement all of the functionality in the FS-ITAM use case build, the default Bro configurations will need to be modified. Please follow these steps to gain the same functionality. 1. Stop Bro: NIST SP 1800-5C: IT Asset Management 39broctl stop 2. Copy and edit node.cfg: T sih cp /usr/local/bro/etc/node.cfg /usr/local/bro/etc/node.cfg.orig cp p <source_dir>/node.cfg /usr/local/bro/etc u b cil a Edit node.cfg, making sure that interface=eth0 is the correct interface on which you will be t oi n sniffing/capturing traffic (NOT your management interface). si a v a 3. Edit networks.cfg: ali b el rf The networks.cfg file identifies all of your internal networks, so please list them all here. Below e e is our example: o c f h a List of local networks in CIDR notation, optionally followed by a descriptive tag. For example: r g e orf 10.0.0.0/8 or fe80::/64 are valid prefixes. m : h t 10.0.0.0/8 Private IP space t p /: / od 192.168.0.0/16 Private IP space o.i r /g 172.16.0.0/16 Private IP space 1 0 6. 0 4. Edit the local.bro file to reflect the settings you want: 2 8 / N SI cp /usr/local/bro/share/bro/site/local.bro T S. P /usr/local/bro/share/bro/site/local.bro.orig 1. 8 00 cp <source_dir>/local.bro /usr/local/bro/share/bro/site/ -5 . 5. Check changes, install changes, and restart Bro: broctl check broctl install broctl start broctl status If everything goes right, you should start seeing log files in /usr/local/bro/logs/current. 3.3.7 Installing Splunk Universal Forwarder Note: You will need a Splunk account to download the Splunk Universal Forwarder. The Splunk Universal Forwarder is free and can be downloaded from: https://www.splunk.com/page/sign_up. 1. Download the Splunk Universal Forwarder from: http://www.splunk.com/en_us/download/uni- versal-forwarder.html. 2. You want the latest version for OS version 2.6+ kernel Linux distributions (64-bit). Since this is installing on Ubuntu, select the file that ends in .deb. An example is: splunkforwader-6.2.5-272645-linux-2.6-amd64.deb NIST SP 1800-5C: IT Asset Management 40Detailed installation instructions can be found at: http://docs.splunk.com/Documentation/Splunk/6.2.3/Installation/InstallonLinux. T h 3. An abridged version follows: si p u b dpkg -i <splunk_package_name.deb> cil a oit Example: dpkg -i splunkforwader-6.2.5-272645-linux-2.6-amd64.deb n si a 4. This will install in /opt/splunkforwarder: v a ali b cd /opt/splunkforwarder/bin el rf e ./splunk start --accept-license e o c f ./splunk enable boot-start h a r g e 5. Add forwarder: rf o m : h More information about adding a forwarder can be found at: t pt http://docs.splunk.com/Documentation/Splunk/6.2.3/Forwarding/Deployanixdfmanually. /: / d o cd /opt/splunkforwarder/bin o.i r g ./splunk add forward-server loghost:9997 -auth admin:changme / 1 0 6. 20 3.3.8 Configuring Splunk Universal Forwarder 8 / N SI Configuring Splunk Universal Forwarder as shown in the FS-ITAM use case requires X.509 Certificates for T S. P the Splunk Enterprise server/indexer and each Splunk Universal Forwarder. You will also need a copy of 1. 08 your certificate authority's public certificate. 0 -5 . 1. Create a directory to hold your certificates: mkdir /opt/splunkforwarder/etc/certs 2. Copy your certificates in PEM format to /opt/splunkforwarder/etc/certs: cp CAServerCert.pem /opt/splunkforwarder/etc/certs cp bro_worker1.pem /opt/splunkforwarder/etc/certs 3. Copy the Splunk Universal Forwarder configuration files: cp <server.conf> /opt/splunkforwarder/etc/system/local cp <inputs.conf> /opt/splunkforwarder/etc/system/local cp <outputs.conf> /opt/splunkforwarder/etc/system/local 4. Modify server.conf so that: ServerName=Bro is your hostname. NIST SP 1800-5C: IT Asset Management 41sslKeysfilePassword = <password for your private key> 5. Modify outputs.conf so that: T h si Server = loghost:9997 is your correct Splunk Enterprise server/indexer and port. p u b cil sslPassword = <password of your certificate private key> a t noi Note: This will be hashed and not clear text after a restart. si a av Inputs.conf should work, but you are free to modify it to include the Bro logs that you are interested in. ali b el Note: dns.log, conn.log and http.log generate a significant volume of messages for Splunk Enterprise to rf ee index. Depending on the size of your Splunk Enterprise license, this data volume might cause license o c f warnings or violations. See h ra http://docs.splunk.com/Documentation/Splunk/6.2.3/Admin/Aboutlicenseviolations for more g e rf information. o m : th 3.3.9 Configurations and Scripts t p /: / d Update_intel.sh should be placed in /usr/local/bro_intel. o o.i gr #!/bin/sh / 1 0 6. # This script downloads and formats reputation data from the Internet and formats it 0 2 so that Bro can use it as intel data. 8 / N SI # Good idea to restart bro every now and then: broctl restart T S. P 1. # /usr/local/bro/share/bro/site/local.bro looks for the files in this directory. 8 0 0 -5 # . # Uses the mal-dnssearch package from Jon Schipp # git clone https://github.com/jonschipp/mal-dnssearch # cd mal-dnssearch # sudo make install # cd /usr/local/bro_intel # download and format the Mandiant APT info mal-dnssearch -M mandiant -p | mal-dns2bro -T dns -s mandiant -n true > /usr/local/bro_intel/mandiant.intel NIST SP 1800-5C: IT Asset Management 42# download and format TOR info T h mal-dnssearch -M tor -p | mal-dns2bro -T ip -s tor -n true -u si p http://rules.emergingthreats.net/open/suricata/rules/tor.rules > u b cil /usr/local/bro_intel/tor.intel a t oi n si a v # download and format Alienvault reputation info a ali elb mal-dnssearch -M alienvault -p | mal-dns2bro -T ip -s alienvault -n true > rf /usr/local/bro_intel/alienvault.intel e e c fo h a gr /usr/local/bro/etc/node.cfg e rf mo # Example BroControl node configuration. : h tt # p /: / d # This example has a standalone node ready to go except for possibly changing o o.i r # the sniffing interface. g / 1 0 6. 0 2 /8 # This is a complete standalone configuration. Most likely you will N SI T # only need to change the interface. [bro] S. P 81. type=standalone host=localhost interface=eth1 0 0 -5 ## Below is an example clustered configuration. If you use this, . ## remove the [bro] node above. #[manager] #type=manager #host=host1 # #[proxy-1] #type=proxy #host=host1 # #[worker-1] #type=worker NIST SP 1800-5C: IT Asset Management 43#host=host2 #interface=eth0 T h # si p u #[worker-2] b cil ta #type=worker oi n si #host=host3 a v a ali #interface=eth0 b el rf # e e o #[worker-3] c f h a #type=worker r g e rf #host=host4 o m : h #interface=eth0 t t p /: / d o o.i /usr/local/bro/share/bro/site/local.bro r g / 1 0 ##! Local site policy. Customize as appropriate. 6. 0 2 8 ##! / N TSI ##! This file will not be overwritten when upgrading or reinstalling! S. P 1. 8 0 0 -5 # Capture plaintext passwords . redef HTTP::default_capture_password=T; redef FTP::default_capture_password=T; #Hash all HTTP - for APT script #redef HTTP::generate_md5=/.*/; # This script logs which scripts were loaded during each run. @load misc/loaded-scripts # Apply the default tuning scripts for common tuning settings. @load tuning/defaults # Load the scan detection script. NIST SP 1800-5C: IT Asset Management 44@load misc/scan T h # Log some information about web applications being used by users si p u # on your network. b cil ta @load misc/app-stats oi n si a v a ali # Detect traceroute being run on the network. b el rf @load misc/detect-traceroute e e o c f h a # Generate notices when vulnerable versions of software are discovered. r g e rf # The default is to only monitor software found in the address space defined o m : h # as "local". Refer to the software framework's documentation for more t t p /: # information. / d o o.i @load frameworks/software/vulnerable r g / 1 0 6. 0 2 # Detect software changing (e.g. attacker installing hacked SSHD). 8 / N SI @load frameworks/software/version-changes T S. P 1. 8 0 0 # This adds signatures to detect cleartext forward and reverse windows shells. -5 . @load-sigs frameworks/signatures/detect-windows-shells # Uncomment the following line to begin receiving (by default hourly) emails # containing all of your notices. # redef Notice::policy += { [$action = Notice::ACTION_ALARM, $priority = 0] }; # Load all of the scripts that detect software in various protocols. @load protocols/ftp/software @load protocols/smtp/software @load protocols/ssh/software NIST SP 1800-5C: IT Asset Management 45@load protocols/http/software # The detect-webapps script could possibly cause performance trouble when T h # running on live traffic. Enable it cautiously. si p u #@load protocols/http/detect-webapps b cil ta oi n si # This script detects DNS results pointing toward your Site::local_nets a v a ali # where the name is not part of your local DNS zone and is being hosted b el rf # externally. Requires that the Site::local_zones variable is defined. e e o @load protocols/dns/detect-external-names c f h a r g e rf # Load dhcp script to log known devices o m : h @load protocols/dhcp/known-devices-and-hostnames t t p /: / d o o.i # Script to detect various activity in FTP sessions. r g / 1 @load protocols/ftp/detect 0 6. 0 2 # Scripts that do asset tracking. 8 / N SI @load protocols/conn/known-hosts T S. P @load protocols/conn/known-services 1. 8 0 0 @load protocols/ssl/known-certs -5 . # This script enables SSL/TLS certificate validation. @load protocols/ssl/validate-certs # Check for SSL Heartbleed attack @load protocols/ssl/heartbleed # Check for weak keys @load protocols/ssl/weak-keys # Check for expiring certs NIST SP 1800-5C: IT Asset Management 46@load protocols/ssl/expiring-certs T h # Uncomment the following line to check each SSL certificate hash against the ICSI si p u # certificate notary service; see http://notary.icsi.berkeley.edu . b cil ta @load protocols/ssl/notary oi n si a v a ali # If you have libGeoIP support built in, do some geographic detections and b el rf # logging for SSH traffic. e e o @load protocols/ssh/geo-data c f h a # Detect hosts doing SSH bruteforce attacks. r g e rf @load protocols/ssh/detect-bruteforcing o m : h # Detect logins using "interesting" hostnames. t t p /: @load protocols/ssh/interesting-hostnames / d o o.i r g / 1 # Detect SQL injection attacks. 0 6. 0 2 @load protocols/http/detect-sqli 8 / N SI T S. P const feed_directory = "/usr/local/bro_intel"; 1. 8 0 0 -5 . # Intelligence framework #@load policy/frameworks/intel/seen #@load policy/frameworks/intel/do_notice @load frameworks/intel/seen @load frameworks/intel/do_notice #@load policy/integration/collective-intel #redef Intel::read_files += { # feed_directory + "/mandiant.intel", # feed_directory + "/tor.intel", # feed_directory + "/alienvault.intel", NIST SP 1800-5C: IT Asset Management 47##"/usr/local/bro/share/bro/site/bad_domains.txt", ##"/somewhere/yourdata1.txt", T h #}; si p u redef Intel::read_files += { "/usr/local/bro_intel/mandiant.intel", b cil "/usr/local/bro_intel/tor.intel", "/usr/local/bro_intel/alienvault.intel", a t oi n }; si a v a ali elb #### Network File Handling #### rf ee o c f # Enable MD5 and SHA1 hashing for all files. h a r g e @load frameworks/files/hash-all-files rf o m : h t pt # Detect SHA1 sums in Team Cymru's Malware Hash Registry. /: / od @load frameworks/files/detect-MHR o.i gr / 1 0 6. # Extract collected files 0 2 8 / #@load extract_files N SI T S. P 1. 8 # this is the original malware_detect using perl and clamavd 0 0 -5 . #@load malware_detect # can define this stuff here or in the site specific .bro scripts #redef Communication::listen_port = 47777/tcp; #redef Communication::nodes += { # ["broping"] = [$host = 127.0.0.1, $class="broping", $events = /ping/, $connect = F, $ssl = F], # ["malware_detect"] = [$host = 127.0.0.1, $class="malware_detect", $events = /malware_message/, $connect= F, $ssl = F] #}; #@load malware1 NIST SP 1800-5C: IT Asset Management 48#@load broccoli #@load whitelisting T h #@load broping si p u b cil ta event bro_init() { Analyzer::disable_analyzer(Analyzer::ANALYZER_SYSLOG); oi n si } a v a ali b el rf #event bro_init() e e o # { c f h a # local f = Log::get_filter(Notice::ALARM_LOG, "alarm-mail"); r g e rf # f$interv = 1day; o m : h # Log::add_filter(Notice::ALARM_LOG, f); t t p /: # } / d o o.i r g / 1 0 /opt/splunkforwarder/etc/system/local/server.conf 6. 0 2 8 [sslConfig] / N TSI sslKeysfilePassword = $1$2OJs1XSIp3Un S. P 1. 8 0 0 -5 [lmpool:auto_generated_pool_forwarder] description = auto_generated_pool_forwarder . quota = MAX slaves = * stack_id = forwarder [lmpool:auto_generated_pool_free] description = auto_generated_pool_free quota = MAX slaves = * stack_id = free [general] pass4SymmKey = $1$j644iTHO7Ccn serverName = bro /opt/splunkforwarder/etc/system/local/inputs.conf [default] host = bro sourcetype=BroLogs index=bro NIST SP 1800-5C: IT Asset Management 49[monitor:///usr/local/bro/logs/current/notice.log] sourcetype=bro_notice [monitor:///usr/local/bro/logs/current/weird.log] sourcetype=bro_weird [monitor:///usr/local/bro/logs/current/ssl.log] sourcetype=bro_ssl T [monitor:///usr/local/bro/logs/current/ssh.log] sourcetype=bro_ssh h si [monitor:///usr/local/bro/logs/current/software.log] sourcetype=bro_software p u [monitor:///usr/local/bro/logs/current/intel.log] sourcetype=bro_intel b cil [monitor:///usr/local/bro/logs/current/http.log] sourcetype=bro_http a t [monitor:///usr/local/bro/logs/current/conn.log] sourcetype=bro_conn oi n [monitor:///usr/local/bro/logs/current/x509.log] sourcetype=bro_x509 si a v [monitor:///usr/local/bro/logs/current/dns.log] sourcetype=bro_dns a ali b el #[monitor:///usr/local/bro/logs/current/*.log] rf ee #host=bro-worker1 o hc f #sourcetype=BroLogs a r g e #index=bro rf o m : h t pt #[monitor:///opt/splunkforwarder/var/log/splunk/splunkd.log] /: / d o o.i r g / /opt/splunkforwarder/etc/system/local/outputs.conf 1 0 6. 0 [tcpout] 2 8 / N defaultGroup = splunkssl SI T PS. 1. 8 00 [tcpout:splunkssl] server = loghost:9997 compressed = true -5 . sslVerifyServerCert = false sslRootCAPath = $SPLUNK_HOME/etc/certs/CAServerCert.pem sslCertPath = $SPLUNK_HOME/etc/certs/bro-worker1.pem sslPassword = $1$23DtXas9IZD8 3.4 CA Technologies IT Asset Manager CA Technologies IT Asset Manager (CA ITAM) allows you to holistically manage IT hardware assets, from planning and requisition to retirement and disposal. This solution helps to rein in IT costs and boost return on investment by identifying underutilized hardware assets, improving hardware usage profiles, managing contracts and usage patterns, and giving you a thorough understanding of the true costs of your IT asset base. 3.4.1 How It’s Used In the FS ITAM build, CA ITAM is used to track hardware assets from requisition to disposal. Data collected during this task will be analyzed and used to notify an administrator of a change in the network NIST SP 1800-5C: IT Asset Management 50architecture. When a new hardware asset is received, an administrator will enter into the database information that includes, but is not limited to, the asset name, host name, operating system, serial number, owner, location, mac address and IP address. The data is then stored for retrieval by Splunk T h si Enterprise. For this build, the CA ITAM database is pre-loaded with data from machines being used p u b throughout the ITAM architecture. The Tier 1 ITAM server is connected to the CA ITAM database to cil a query data stored in the CA ITAM resource tables. t oi n si a 3.4.2 Virtual Machine Configuration v a ali b The CA ITAM virtual machine is configured with one network interface cards, 16 GB of RAM, two CPU el rf cores, a 40 GB hard drive, and another 100 GB hard drive. The 100 GB of hard drive space is very e e o important for this machine. c f h a r eg 3.4.3 Network Configuration rf o m The management network interface card is configured as follows: : h t t /:p ▪ IPv4 Manual / d o.io ▪ IPv6 Disabled r g 1/ ▪ IP Address: 172.16.3.92 0 6. 20 ▪ Netmask: 255.255.255.0 8 / N SI ▪ Gateway: 172.16.3.11 T S. P ▪ DNS Servers: 172.16.1.20, 172.16.1.21 1. 8 0 0 ▪ Search Domains: lab5.nccoe.gov -5 . 3.4.4 Installing CA ITAM CA ITAM is installed on a clean 64-bit Windows Server 2012 R2 image with default Windows firewall configurations. Installation configurations are default for this build and are documented online by CA Technologies. CA Technologies installation guidelines can be found online at the following URL: https://support.ca.com/cadocs/0/CA%20IT%20Asset%20Manager%2012%208- ENU/Bookshelf_Files/PDF/APM_Impl_ENU.pdf. Prerequisites for this build are as follows: ▪ Java 7 JRE (32-bit) • Set the JAVA_HOME variable ▪ SQL Server 2012 with • Database Engine NIST SP 1800-5C: IT Asset Management 51• Backwards Compatibility • Client Connectivity T h si • Management tools p u cilb • Used mixed authentication as the authentication method a t oi ▪ NET Framework 3.5 n si a ▪ NET Framework 4.5 v a bali • Select ASP.NET el erf ▪ IIS e o c f Note: Make sure the application server supports the IIS under add roles and features h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . ▪ CA Business Intelligence Server ▪ CA Embedded Entitlements Manager 3.4.5 Configurations Once installed, the data importer engine is used to import data from a .CSV file into the MDB. The file is obtained from the Belarc Server, which exports data into a .CSV file. Then the file is copied onto the CA ITAM Server. 1. Save the .CSV file in \CA\ITAM\Storage\Common Store\Import. NIST SP 1800-5C: IT Asset Management 52The file contains data with the following field names: ProfileName, NetworkMACAddress, ComputerDomain, OperatingSystem, OSProductOptions, OSServicePack, SystemSerialNumber. T h A snippet of the .CSV file is displayed in the following figure: si p u b cil a t oi n si a v a ali 2. Open the CA Data Importer by logging into CA ITAM with administrator privileges and navigate b el to Administration > Data Importer > New Import. rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . 3. In the Administration tab, specify these settings: a. Name: <Name> b. Data File: <filename> c. Main Destination Object: Asset(Computer) d. Select First Row Has Column Names e. Data File Locale: English (United States) f. Data Delimiter: {Comma} 4. In Advanced Settings, select all three check boxes. NIST SP 1800-5C: IT Asset Management 535. Save the import. 6. Under Mapping, select Load Source Fields. T h p si 7. Map the Source Fields to the Destination Fields using the following rules: u b cil a. Computer domain = Asset.Host Name a t oi n si b. NetworkIPAddress = Asset.IP Address a v a ali c. NetworkMACAddress = Asset.MAC Address b el rf d. OperatingSystem = Asset.Model.Model Name e e o c f e. OSProductOptions = Asset.Asset Type Hierarchy.Class.Value h a r eg f. OSServicePack = Asset.Asset Type Hierarchy.Subclass.Value rf o m : h g. ProfileName = Asset.Asset Name t t p /: h. SystemSerialNumber = Asset.Serial Number / d o o.i 8. Under the Schedule, upload the .CSV data file again and Submit. Make sure that the data import r g 1/ service is running. 0 6. 0 2 9. Check the status of the job under Import Jobs. 8 / N TSI 10. Use the data stored in the MDB to run a query through the Splunk DB Connection (See S. P Section 2.1.1, Splunk Enterprise, to configure.). 1. 8 0 0 -5 11. Query is as follows: . SELECT DISTINCT aud_ca_owned_resource.resource_name,audit_mode_uuid,audit_resource_class,au dit_resource_subclass,ca_owned_resource.own_resource_id,ca_owned_resource.m ac_address,ca_owned_resource.ip_address,ca_owned_resource.host_name,ca_owne d_resource.serial_number,ca_owned_resource.asset_source_uuid,ca_owned_resou rce.creation_user,ca_owned_resource.creation_date FROM aud_ca_owned_resource INNER JOIN ca_owned_resource ON aud_ca_owned_resource.resource_name = ca_owned_resource.resource_name 3.5 Fathom Sensor from RedJack Fathom Sensor passively scans network traffic analyzing and reporting on netflow and cleartext banner information crossing the network. DNS and http traffic are also analyzed. Fathom Sensor detects anomalies on the network by analyzing these data streams. NIST SP 1800-5C: IT Asset Management 543.5.1 How It’s Used Fathom Sensor passively monitors, captures, and optionally forwards summarized network traffic to its T h service running on the Amazon AWS cloud. The data on the Amazon server is then analyzed by RedJack si up to detect anomalies. The data is also aggregated with data from other organizations to detect attack b cil trends. a t oi n si 3.5.2 Virtual Machine Configuration a v a ali The FathomSensor1 virtual machine is configured with 2 network interface cards (1 card for access and 1 b rf el for sniffing traffic), 16 GB of RAM, 1 CPU cores and 16 GB of hard drive space. e e o c f 3.5.3 Network Configuration h a r g e The management network interface card is configured as such: rf o m : h ▪ IPv4 Manual t t /:p ▪ IPv6 Disabled / d o.io ▪ IP Address: 172.16.0.50 r g 1/ ▪ No IP address for the second network interface card Netmask: 255.255.255.0 0 6. 0 ▪ Gateway: 172.16.0.11 2 8 / SIN ▪ DNS Servers: 172.16.1.20, 172.16.1.21 T PS. ▪ Search Domains: lab5.nccoe.gov 1. 8 0 0 -5 3.5.4 Installing Fathom Sensor . 3.5.4.1 VM Deployments This document will track the best-practices for provisioning, installing, and deploying the fathom-sensor in a virtual machine (VM). 3.5.4.2 Requirements Fathom Sensor VM requirements vary based on the size, traffic volume, and complexity of the network. The most important factor for performance is RAM. A small business network of <50 devices might be safe on a VM with 16GB RAM, where as a large enterprise gateway may require 32-64GB RAM and dedicated hardware. Fathom Sensor will continue to operate in a degraded state if it becomes resource starved, but it is best to start high. NIST SP 1800-5C: IT Asset Management 553.5.4.3 Configure the VM When creating the virtual machine, create two network interfaces, one for management, and one for T h monitoring. The monitoring interface must be set to promiscuous mode. si p u b Instructions vary by VM platform and host, but this is covered here: cil a t oi ▪ ESX – [KB: n a si 1004099](http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=dis v a playKC&externalId=1004099) ali b el ▪ Linux – [KB: rf e 287](http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayK e o c f C&externalId=287) h a gr ▪ Fusion – Password prompt can be disabled under Preferences > Network. e rf o m 3.5.4.4 Install CentOS 7 Minimal : h t pt Our reference platform is CentOS 7 x64. Install (using USB or ISO or whatever) a minimal install. /: / d o o.i 3.5.4.5 Configure OS r g / 01 Note: The following is based on the aforementioned VM with 2 NICs, one management NIC (eno1...) and 6. 0 one monitoring NIC (eno2...). 2 8 / N SI Before beginning the configuration, you should collect the following information: IP/Netmask/Gateway T PS. for management interface. This will need Internet access on port 80 and 443. Optionally, you can use 1. 8 DHCP. 0 0 -5 . 172.16.0.50 DNS server. This can be a local (to the customer) DNS server, or public (8.8.8.8, 4.2.2.4), however the latter will require firewall rules. Optionally, DHCP can configure this, however it needs to be set as above. 172.16.1.20, 172.16.1.21 NTP Server. This can be a local (to the customer), or a public (0.centos.pool.ntp.org) server, however the latter will require firewall rules. 172.16.0.11 NICs can be obscurely named, especially in VM environments. List all interfaces with: # ip addr. 3.5.4.6 Configure the Management Network with a Static IP # /etc/sysconfig/network-scripts/ifcfg-eno1 NIST SP 1800-5C: IT Asset Management 56BOOTPROTO=static IPADDR=172.16.0.50 NETMASK=255.255.255.0 ONBOOT=yes 3.5.4.7 Configure the Monitoring Interface Without an IP T h si 1. Configure the monitoring interface without an IP: p u b cil # /etc/sysconfig/network-scripts/ifcfg-eno2 a t noi BOOTPROTO=static ONBOOT=yes si a v 2. Disable IPv6 autoconfiguration on the monitoring interface: a ali elb # sysctl -w net.ipv6.conf.eno2.disable_ipv6=1 rf e o e 3.5.4.8 Configure DNS c f ah # vi /etc/resolv.conf r g e rf search lab5.nccoe.gov o m : h nameserver 172.16.1.20 t t p /: nameserver 172.16.1.21 / d o o.i 3.5.4.9 Set the Hostname r g / 01 # hostnamectl set-hostname fathomsensor1 6. 0 2 # vi /etc/hosts 8 / N SI 127.0.0.1 localhost T S. P 1. 172.16.0.50 fathomsensor1 8 0 0 -5 3.5.4.10 Adjust the Packages . 1. Not required, but if you are planning to install VMWare Tools, you need $ yum install perl net-tools gcc kernel-devel 2. Install basic tools $ yum install ntp bash-completion net-tools wget curl lsof tcpdump psmisc 3.5.4.11 Remove Unnecessary Packages $ systemctl stop postfix chronyd avahi-daemon.socket avahi-daemon.service $ systemctl disable avahi-daemon.socket avahi-daemon.service $ yum remove postfix chronyd avahi-autoipd avahi-libs avahi 3.5.4.12 Disable SELinux # vi /etc/selinux/config NIST SP 1800-5C: IT Asset Management 57SELINUX=permissive 3.5.4.13 Limit SSH T h si # vi /etc/ssh/sshd_config p u b ListenAddress 172.16.0.50 cil a t noi 3.5.4.14 NTP si a v Some VM platforms or configurations will provide a synchronized system clock. If you know this is the a bali case, you can skip this section. el erf #vi /etc/ntp.conf e o c f driftfile /var/lib/ntp/drift h a r eg restrict default nomodify notrap nopeer noquery rf o m server 0.centos.pool.ntp.org iburst : h tt server 1.centos.pool.ntp.org iburst p /: / d server 2.centos.pool.ntp.org iburst o o.i gr server 3.centos.pool.ntp.org iburst / 1 0 6. includefile /etc/ntp/crypto/pw 0 2 /8 keys /etc/ntp/keys N SI S.T disable monitor P 1. 8 1. Limit NTP to only listening on the management interface: 0 0 -5 . #vi /etc/sysconfig/ntpd OPTIONS="-g -I eno1 -I 172.16.0.50" 2. Before deployment, make sure the hardware clock is set to something reasonably correct: $ ntpdate 172.16.0.11 $ hwclock -w 3. Set NTP to start: $ systemctl enable ntpd $ systemctl start ntpd NIST SP 1800-5C: IT Asset Management 583.5.4.15 CollectD We use collectd to keep track of system (and fathom metrics) and report those metrics back to T h customer-metrics.redjack.com every 60 seconds. si p u b 1. First, we need to install it from EPEL (version number will change): cil a t oi #yum install n si a http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarc h.rpm v a ali #yum install collectd collectd-netlink b el erf 2. Then install the collectd config file, which will have a URL specific for this sensor, which we've e o been using as the sensor UUID. c f h a gr 3. Then enable collectd: e rf mo $ systemctl enable collectd : h tt $ systemctl start collectd p /: / d o 3.5.4.16 Install Fathom-Sensor o.i r g / 1. First install all the sensor RPMs: 1 0 6. 0 $ sudo yum install *.rpm 2 8 / N SI 2. Assuming that you have built a sensor config with `fathom-admin`: T S. 1.P $ cp fathom-sensor1.conf /etc/fathom/fathom-sensor.conf 8 0 0 $ chown fathom:fathom /etc/fathom/fathom-sensor.conf -5 . $ chmod 600 /etc/fathom/fathom-sensor.conf 3. Edit the sensor config to make sure that it is listening to the correct device: # vi /etc/fathom/fathom-sensor.conf FATHOM_SENSOR_NETWORK_DEVICE=eno2 3.5.4.17 Update Dynamic Run-Time Bindings 1. Update dynamic run-time bindings because sometimes it needs it: $ ldconfig 2. Then enable the “dedicated” version of the sensor. This has some hardcore properties in it that will reboot if there are continual problems: $ systemctl enable fathom-sensor-dedicated $ systemctl start fathom-sensor-dedicated NIST SP 1800-5C: IT Asset Management 593.5.4.18 Install and Configure Amazon S3 Command Line Tools Using PIP 1. Go to http://docs.aws.amazon.com/cli/latest/userguide/installing.html. T h p si 2. Verify that you have at least Python 2.7: u b cil $ python -version a t oi n 3. Download the pip installation script: si a av $ curl -O https://bootstrap.pypa.io/get-pip.py ali b el 4. Run the pip installation script: rf e e o $ sudo python get-pip.py c f h a 5. Install the AWS CLI: r g e rf $ sudo pip install awscli o m : th 3.5.4.19 Configure AWS CLI t p /: / d 1. Configure AWS CLI: o o.i gr #aws configure / 1 0 6. 2. You will get the data to configure AWS CLI from the fathom-sensor.conf file. We want the data 0 2 8 in JSON format. / N SI S.T AWS Access Key ID = FATHOM_SENSOR_AWS_ACCESS_KEY P 81. AWS Secret Access Key = FATHOM_SENSOR_AWS_SECRET_KEY Default region Name = None 0 0 -5 Default output format = json . 3. Create a directory to save the files gathered from Amazon AWS: #mkdir /opt/fathom-sync 4. Create a script to sync data with the Amazon AWS: #vi /usr/local/bin/fathom-sync.sh 5. Copy the following lines into fathom-sync.sh. Replace <SENSOR ID> with your individual sensor ID. #!/bin/sh /bin/aws s3 sync s3://fathom-pipeline/json/nccoe/<SENSOR ID>/ /opt/fathom-sync 6. Make the script executable: #chmod +x /usr/local/bin/fathom-sync NIST SP 1800-5C: IT Asset Management 607. Make the script run every hour by placing a link in /etc/cron.hourly: #cd /etc/cron.hourly T sih #ln -s /usr/local/bin/fathom-sync.sh /etc/cron.hourly/fathom-sync p u b cil 3.5.5 Installing Splunk Universal Forwarder a t oi si n Note: You will need a Splunk account to download the Splunk Universal Forwarder. It is free and can be va setup at: https://www.splunk.com/page/sign_up. a ali b el 1. Download the Splunk Universal Forwarder from: http://www.splunk.com/en_us/download/uni- erf versal-forwarder.html. e o hc f 2. Use the latest version for OS version 2.6+ kernel Linux distributions (64-bit). Since a gr this is installing on Ubuntu select the file that ends in .deb. An example is: e rf o m splunkforwader-6.2.5-272645-linux-2.6-amd64.deb : h t pt Detailed installation instructions can be found at: /: / d http://docs.splunk.com/Documentation/Splunk/6.2.3/Installation/InstallonLinux. o o.i gr 3. An abridged version follows: / 1 0 6. rpm -i <splunk_package_name.deb> 0 2 8 N/ Example: rpm -i splunkforwader-6.2.4-271043-linux-2.6-x86_64.rpm SI T PS. 4. This will install in /opt/splunkforwarder: 1. 8 00 cd /opt/splunkforwarder/bin -5 . ./splunk start --accept-license ./splunk enable boot-start 5. Add forwarder: More info about adding a forwarder can be found at: http://docs.splunk.com/Documentation/Splunk/6.2.3/Forwarding/Deployanixdfmanually. cd /opt/splunkforwarder/bin ./splunk add forward-server loghost:9997 -auth admin:changme NIST SP 1800-5C: IT Asset Management 613.5.6 Configuring Splunk Universal Forwarder Configuring Splunk Universal Forwarder as shown in the FS-ITAM use case requires X.509 Certificates for T h the Splunk Enterprise server/indexer and each Splunk Universal Forwarder. You will also need a copy of si up your certificate authority's public certificate. b cil ta 1. Create a directory to hold your certificates: oi n a si mkdir /opt/splunkforwarder/etc/certs v a ali 2. Copy your certificates in PEM format to /opt/splunkforwarder/etc/certs: b el rf cp CAServerCert.pem /opt/splunkforwarder/etc/certs e e o c f cp fathomsensor1.lab5.nccoe.pem /opt/splunkforwarder/etc/certs h a gr 3. Copy Splunk Universal Forwarder configuration files: e rf o m cp <server.conf> /opt/splunkforwarder/etc/system/local : h tt cp <inputs.conf> /opt/splunkforwarder/etc/system/local p /: / d cp <outputs.conf> /opt/splunkforwarder/etc/system/local o o.i gr 4. Modify server.conf so that: / 1 0 6. 0 ServerName=Bro is your hostname. 2 8 / N sslKeysfilePassword = <password for your private key> SI T S. P 5. Modify outputs.conf so that: 1. 8 0 0 -5 Server = loghost:9997 is your correct Splunk Enterprise server/indexer and port. . sslPassword = <password of your certificate private key> Note: this will be hashed and not clear text after a restart. 3.5.7 Helpful Commands and Information The following commands could prove useful when working with Amazon Web Servers S3. Replace <SENSOR ID> with your individual sensor ID. 1. List your sensor(s): aws s3 ls s3://fathom-pipeline/json/nccoe/ 2. List data types for a sensor: aws s3 ls s3://fathom-pipeline/json/nccoe/<SENSOR ID>/ NIST SP 1800-5C: IT Asset Management 623. List dates for the client-banner data type: aws s3 ls s3://fathom-pipeline/json/nccoe/<SENSOR ID>/client-banner/ T h si 4. List individual JSON files on that date: p u b cil aws s3 ls a t oi s3://fathom-pipeline/json/nccoe/<SENSOR ID>/client-banner/20150604/ n si va 5. The following command will convert from a certificate in PKCS12 format to PEM format: a ali b openssl pkcs12 -in certificate.pfx -out certificate.cer -nodes el rf e o e 3.5.8 Configurations and Scripts c f h a r g e orf /opt/splunkforwarder/etc/system/local/server.conf m : th [sslConfig] t p /: / sslKeysfilePassword = $1$2OJs1XSIp3Un d o o.i r g / 1 0 [lmpool:auto_generated_pool_forwarder] description = auto_generated_pool_forwarder 6. 0 quota = MAX 2 8 / N slaves = * SI T PS. stack_id = forwarder 1. 8 0 0 -5 . [lmpool:auto_generated_pool_free] description = auto_generated_pool_free quota = MAX slaves = * stack_id = free [general] pass4SymmKey = $1$j644iTHO7Ccn serverName = fathomsensor1.lab5.nccoe.gov /opt/splunkforwarder/etc/system/local/inputs.conf [default] host = fathomsensor1.lab5.nccoe.gov sourcetype=fathomsensor index=fathom [monitor:///opt/fathom-sync/*/client-banner*] /opt/splunkforwarder/etc/system/local/outputs.conf [tcpout] defaultGroup = splunkssl NIST SP 1800-5C: IT Asset Management 63[tcpout:splunkssl] server = loghost:9997 compressed = true T h sslVerifyServerCert = false si p u sslRootCAPath = $SPLUNK_HOME/etc/certs/CAServerCert.pem b cil ta sslCertPath = $SPLUNK_HOME/etc/certs/fathomsensor1.lab5.nccoe.gov.pem sslPassword = oi n $1$23DtXas9IZD8 si a v alia 3.6 OpenVAS b el rf OpenVAS is an open-source network vulnerability scanner and manager. OpenVAS runs customizable e e o scans and generates reports in multiple formats. OpenVAS is also a framework, and additional tools can hc f be added to it. a r g e orf 3.6.1 How It’s Used m : h t In the FS ITAM build, OpenVAS automatically runs vulnerability scans on all systems connected to the t p /: network. Every machine is scanned at least once a week. OpenVAS collects the information, stores it in a / d o.io database, and creates reports. OpenVAS can also download the latest vulnerabilities along with their r g CVE and NVT information. / 1 0 6. 0 On the high-level architecture diagram, OpenVAS is in Tier 2. OpenVAS utilizes the Splunk Universal 2 8 / Forwarder to send reports to Splunk Enterprise. Information is extracted from the OpenVAS database N TSI every hour, and any new records are forwarded to Splunk Enterprise. Splunk Enterprise uses the S. 1.P information from OpenVAS to provide context to analysts regarding the security of individual systems as 8 0 well as aggregating statistics to show the overall organizational security posture. 0 -5 . 3.6.2 Virtual Machine Configuration The OpenVAS virtual machine is configured with one network interface card, 16 GB of RAM and four CPU cores. 3.6.3 Network Configuration The management network interface card is configured as follows: ▪ IPv4 Manual ▪ IPv6 Ignore/Disabled ▪ IP Address: 172.16.2.33 ▪ Netmask: 255.255.255.0 ▪ Gateway: 172.16.2.11 NIST SP 1800-5C: IT Asset Management 64▪ DNS Servers: 172.16.1.20, 172.16.1.21 ▪ Search Domains: lab5.nccoe.gov T sih https://www.digitalocean.com/community/tutorials/how-to-use-openvas-to-audit-the-securit y-of- p u remote-systems-on-ubuntu-12-04 b cil a t oi 3.6.4 Installation Prerequisites n si a sudo apt-get update v a ali b sudo apt-get install python-software-properties el erf sudo apt-get install sqlite3 xsltproc texlive-latex-base e o c f texlive-latex-extra texlive-latex-recommended htmldoc alien rpm nsis fakeroot h a r g rf e 3.6.5 Installing OpenVAS o m : h OpenVAS is installed on a hardened Ubuntu 14.04 Linux system. Please download the latest source t t p package from OpenVAS and follow the instructions for installing from source. /: / d o o.i Installation was performed following the instructions gathered from the following web sites: r g / 01 ▪ http://www.openvas.org/ 6. 0 2 ▪ https://www.digitalocean.com/community/tutorials/how-to-use-openvas-to-audit-the-securit 8 / N y-of-remote-systems-on-ubuntu-12-04 SI T PS. ▪ https://launchpad.net/~openvas/+archive/ubuntu/openvas6 1. 8 0 0 -5 . 1. Add new file in /etc/apt/sources.list.d/openvas-openvas6-trusty.list: deb http://ppa.launchpad.net/openvas/openvas6/ubuntu precise main deb-src http://ppa.launchpad.net/openvas/openvas6/ubuntu precise main sudo apt-get install openvas-manager openvas-scanner openvas-administrator openvas-cli greenbone-security-assistant sudo openvas- mkcert 2. Answer the questions for the new certificate: sudo openvas-mkcert-client -n om -i 3. Download and build the vulnerability database: sudo openvas-nvt-sync NIST SP 1800-5C: IT Asset Management 654. Stop the services: sudo service openvas-manager stop T sih sudo service openvas-scanner stop p u cilb 5. Start the scanner application (this will download and sync a lot of data): a t oi sudo openvassd n si va 6. Rebuild the database: a ali b sudo openvasmd --rebuild el rf ee 7. Download and sync SCAP data: o c f h sudo openvas-scapdata-sync a r g e rf 8. Download and sync cert data: o m : h sudo openvas-certdata-sync t t p /: Note: You will most likely get an error because the Ubuntu package is missing some files. / d o o.i 9. The following commands will get the files from the Fedora package and install them in the cor- r g / 1 rect location: 0 6. 0 2 cd 8 / N SI wget http://www6.atomicorp.com/channels/atomic/fedora/18/i386/RPMS/openvas- T S. manager-5.0.8-27.fc18.art.i686.rpm P 1. 8 sudo apt-get install rpm2cpio 0 0 -5 . rpm2cpio openvas* | cpio -div sudo mkdir /usr/share/openvas/cert sudo cp ./usr/share/openvas/cert/* /usr/share/openvas/cert 10. Now sync the certs, and everything should work: sudo openvas-certdata-sync 11. Add user and permissions: sudo openvasad -c add_user -n admin -r Admin 12. Edit the following file and insert your OpenVAS IP address: sudo nano /etc/default/greenbone-security-assistant 13. Start up the services: sudo killall openvassd NIST SP 1800-5C: IT Asset Management 66sudo service openvas-scanner start sudo service openvas-manager start sudo service openvas-administrator restart T h sudo service greenbone-security-assistant restart si p bu 14. Enable start up at boot time: cil a oit sudo update-rc.d openvas-scanner enable 2 3 4 5 n a si sudo update-rc.d openvas-manager enable 2 3 4 5 v a ali sudo update-rc.d openvas-administrator enable 2 3 4 5 b el rf sudo update-rc.d greenbone-security-assistant enable 2 3 4 5 e e o c f 15. Try it out. Point your web browser to: h a r eg https://localhost:9392 rf o m https://172.16.2.33:9292 : h t t /:p Note: It must be https. / d o ro.i 3.6.6 Configuring OpenVAS g / 1 0 6. Full user documentation can be found at: http://docs.greenbone.net/index.html#user_documentation. 0 2 8 N/ OpenVAS supports immediate scans and scheduled scans. Scheduled scans enable full automation of SI T scanning and reporting. S. P 1. 8 1. Set up schedules: 0 0 -5 . a. Configuration > Schedules. b. Click the Star icon to create a new schedule. c. Create a schedule for every day of the week. Example: Monday scans - every day at 21:00. d. Do the same for the other 6 days of the week. 2. Setup targets: A target is an individual system to scan or a range of systems to scan. In the FS-ITAM lab a separate target was configured for each subnet. a. Configuration > Targets. NIST SP 1800-5C: IT Asset Management 67b. Click the Star icon to create a new target. Example: T h p si Name: Network Security. u b cil Hosts: 172.16.2.1-172.16.2.254. a t oi n si Comment: Network Security systems. a v a ali c. Click Create Target button to save. b el rf 3. Set up tasks: e e o c f A task is something that is done to a target. So we need to setup a scan on each target. h a r eg a. Scan Management > New Task. rf o m : h Name: Scan DMZ t t p /: Comment: Scan the DMZ systems / d o o.i Scan Config: Full and fast r g / 1 0 Scan Targets: DMZ (this is why the target must exist before the task). 6. 0 2 8 / Schedule: Tuesday scan (this is why the schedule must exist before the task). N SI T S. b. Click the Create Task button to save. P 1. 8 0 c. Continue adding all of the tasks that you need - one for each target. 0 -5 . 3.6.6.1 Openvas_results.py The openvas_results.py is a Python script that accesses the OpenVAS Sqlite3 database, extracts interesting values and then writes those to files in CSV and JSON formats. The openvas_results.py is run by cron every hour to check for new results from OpenVAS scans. The Splunk Universal Forwarder checks the CSV file written by openvas_results.py for any changes and sends those to the Splunk Enterprise server/indexer. 1. Place openvas_results.py in /root and make sure that it is executable: cp <openvas_results.py> /root chmod +x /root/openvas_results.py 2. Create a symbolic link in /etc/cron.hourly so that openvas_results.py runs every hour: ln -s /root/openvas_results.py /etc/cron.daily/openvas_results NIST SP 1800-5C: IT Asset Management 683.6.7 Installing Splunk Universal Forwarder Note: You will need a Splunk account to download the Splunk Universal Forwarder. It is free and can be T h set up at: https://www.splunk.com/page/sign_up. si p u b 1. Download the Splunk Universal Forwarder from: http://www.splunk.com/en_us/download/uni- cil a t versal-forwarder.html. oi n a si 2. You want the latest version for OS version 2.6+ kernel Linux distributions (64-bit). v a ali Since this is installing on Ubuntu, select the file that ends in .deb. An example is: b el rf splunkforwader-6.2.5-272645-linux-2.6-amd64.deb e e c fo Detailed installation instructions can be found at: h a http://docs.splunk.com/Documentation/Splunk/6.2.3/Installation/InstallonLinux. r g e rf 3. An abridged version follows: o m : h dpkg -i <splunk_package_name.deb> t t p /: / d Example: dpkg -i splunkforwader-6.2.5-272645-linux-2.6-amd64.deb o o.i gr 4. This will install in /opt/splunkforwarder: / 1 0 6. cd /opt/splunkforwarder/bin 0 2 8 / ./splunk start --accept-license N SI T S. ./splunk enable boot-start P 1. 08 5. Add forwarder: 0 -5 . More information about adding a forwarder can be found at: http://docs.splunk.com/Documentation/Splunk/6.2.3/Forwarding/Deployanixdfmanually. cd /opt/splunkforwarder/bin ./splunk add forward-server loghost:9997 -auth admin:changme 3.6.8 Configuring Splunk Universal Forwarder Configuring Splunk Universal Forwarder as shown in the FS-ITAM use case requires X.509 Certificates for the Splunk Enterprise server/indexer and each Splunk Universal Forwarder. You will also need a copy of your certificate authority’s public certificate. 1. Create a directory to hold your certificates: mkdir /opt/splunkforwarder/etc/certs NIST SP 1800-5C: IT Asset Management 692. Copy your certificates in PEM format to /opt/splunkforwarder/etc/certs: cp CAServerCert.pem /opt/splunkforwarder/etc/certs T sih cp bro_worker1.pem /opt/splunkforwarder/etc/certs p u cilb 3. Copy Splunk Universal Forwarder configuration files: a t oi cp <server.conf> /opt/splunkforwarder/etc/system/local n si a cp <inputs.conf> /opt/splunkforwarder/etc/system/local v a bali cp <outputs.conf> /opt/splunkforwarder/etc/system/local el erf 4. Modify server.conf so that: e o hc f ServerName=openvascd is your hostname. a r g rf e sslKeysfilePassword = <password for your private key> o m : h 5. Modify outputs.conf so that: t t p /: Server = loghost:9997 is your correct Splunk Enterprise server/indexer and port. / d o o.i sslPassword = <password of your certificate private key> r g / 1 0 Note: This will be hashed and not clear text after a restart. 6. 0 2 8 Inputs.conf should work, but you are free to modify it to include the OpenVAS logs that you are / N SI interested in. T S. P 1. 8 3.6.9 Configurations and Scripts 0 0 -5 . /root/openvas_results.py #! /usr/bin/env python # # Gathers info from OpenVAS database and writes it to a CSV and JSON for SplunkForwarder # import os import os.path import sys from time import sleep from datetime import datetime import ntpath import errno import sqlite3 import csv import json # Global variables and configs NIST SP 1800-5C: IT Asset Management 70# SQLITE3 database file file_db = "/var/lib/openvas/mgr/tasks.db" T h # JSON file to write results to si p u json_file = "/home/mike/openvas_results.json" b cil ta oi n si # CSV file to write results to - actually tab delimited csv_file = a v "/home/mike/openvas_results.csv" a ali elb # last_id is how we keep track of the last item added. This keeps us from re- rf processing old items. This value is kept in the openvas_state.txt file e e c fo last_id = 0 h ra g e orf #openvas_state.txt - change this to 0 if you want to start over openvas_state_file = m "/home/mike/openvas_state.txt" : h t t p # this is just a status of how many records have be processed. new_record_count = 0 /: / d o print "Getting OpenVAS reports" o.i r /g 1 0 06. if os.path.isfile(openvas_state_file) and os.access(openvas_state_file, os.W_OK): 2 8 / N openvas_state = open(openvas_state_file, 'r+') last_id = openvas_state.read() SI T S. else: P 1. 8 0 print "File %s does not exist, creating" % openvas_state_file 0 -5 . #sys.exit() openvas_state = open(openvas_state_file, 'w') openvas_state.write('0') print "Last ID = ", last_id # stripped removes non-printable characters def stripped(x): return "".join([i for i in x if 31 < ord(i) < 127]) try: db_conn = sqlite3.connect(file_db, check_same_thread=False) except: print "Cannot connect to %s" % file_db sys.exit() db_cursor = db_conn.cursor() NIST SP 1800-5C: IT Asset Management 71#query = """SELECT id, task, subnet, host, port, nvt, type, description, report from results""" T h si p query = """SELECT results.id, results.task, results.subnet, results.host, u b results.port, results.nvt, results.type, results.description, results.report, acil nvts.name, nvts.description, t oi si n nvts.cve, nvts.cvss_base, nvts.risk_factor from results LEFT JOIN nvts ON results.nvt a = nvts.uuid ORDER BY results.id""" v a bali el rf #field_names = ['id', 'task', 'subnet', 'host', 'port', 'nvt', 'type', e e o 'results_description', 'report', 'nvts_name', 'nvts_description', 'cve', 'cvss_base', c f 'risk_factor'] h a r eg rf o m csvfile = open(csv_file, 'a') : h tt csv_writer = csv.writer(csvfile, delimiter='\t', quotechar='|', p /: quoting=csv.QUOTE_MINIMAL) / d o o.i r g / 1 jsonfile = open(json_file, 'a') 0 6. 0 2 8 / N SI for row in db_cursor.execute(query): T S. 1.P #print row 8 0 0 id = row #this needs to be a number task = stripped(str(row)) -5 . subnet = stripped(str(row)) host = stripped(str(row)) port = stripped(str(row)) nvt = stripped(str(row)) type = stripped(str(row)) results_description = stripped(str(row)) report = stripped(str(row)) nvts_name = stripped(str(row)) nvts_description = stripped(str(row)) cve = stripped(str(row)) cvss_base = stripped(str(row)) risk_factor = stripped(str(row)) if int(id) > int(last_id): #print "Greater!" last_id = id openvas_state.seek(0,0) openvas_state.write(str(last_id)) new_record_count = new_record_count + 1 csv_writer.writerow([id, task, subnet, host, port, nvt, type, results_description, report, nvts_name, nvts_description, cve, cvss_base, risk_factor]) NIST SP 1800-5C: IT Asset Management 72json_dict = {'id': id, 'task': task, 'subnet': subnet, 'host': host, 'port': port, 'nvt': nvt, 'type': type, 'results_description': results_description, 'report': T sih report, 'nvts_name': nvts_name, 'nvts_description': nvts_description, 'cve': cve, p 'cvss_base': cvss_base, 'risk_factor': risk_factor} u b acil json.dump(json_dict, jsonfile, sort_keys = True, indent = 4, ensure_ascii = False) t oi si n #print "ID: %s LAST: %s" % (id, last_id), print "\n" a av db_conn.close() csvfile.close() jsonfile.close() ali b el print "Wrote %s new records." % new_record_count rf e e o c f ah /opt/splunkforwarder/etc/system/local/server.conf r g e rf [sslConfig] o m : h sslKeysfilePassword = $1$JnofjmZL66ZH t t p /: / d o o.i [lmpool:auto_generated_pool_forwarder] description = auto_generated_pool_forwarder gr quota = MAX / 1 0 6. slaves = * 0 2 8 / stack_id = forwarder N SI T S. P 1. 8 [lmpool:auto_generated_pool_free] description = auto_generated_pool_free quota = MAX 0 0 -5 . slaves = * stack_id = free [general] pass4SymmKey = $1$cTZL0iMNoPRH serverName = openvas /opt/splunkforwarder/etc/system/local/outputs.conf [tcpout] defaultGroup = splunkssl [tcpout:splunkssl] compressed = true server = loghost:9997 sslCertPath = $SPLUNK_HOME/etc/certs/openvas.lab5.nccoe.gov.pem sslPassword = $1$JnofjmZL66ZH sslRootCAPath = $SPLUNK_HOME/etc/certs/CAServerCert.pem sslVerifyServerCert = true NIST SP 1800-5C: IT Asset Management 73/opt/splunkforwarder/etc/system/local/inputs.conf T h si [default] host = openvas p u b index = openvas sourcetype = openvas cil a t oi [monitor:///home/mike/openvas_results.csv] n si a v 3.7 Puppet Enterprise a ali b el Puppet Enterprise enforces a configuration baseline on servers and workstations. Puppet agents rf e e installed on the hosts will run periodically, download a list of instructions referred to as a configuration o c f catalog from the Master, and then execute it on the hosts. A successful Puppet Enterprise agent run can h a r make configuration changes, install new software, remove unwanted software and send reports to the g e rf Master. o m : h t 3.7.1 How It’s Used t p /: / od In the Financial Services ITAM solution, Puppet Enterprise is used to enforce a base configuration for all ro.i endpoints and to enforce basic security configurations. On the endpoints, it ensures that anti-virus g / 1 software is installed, firewalls are enabled, IP forwarding is disabled, and the software asset 0 6. 0 management agent is installed. 2 8 / N SI Reporting is also a feature that was extended in this solution. With the inclusion of customized scripts, T S. Puppet Enterprise sends very valuable reports to the ITAM analysis engine. The reports include which P 1. 8 endpoint has successfully uploaded reports to the Puppet Enterprise master. 0 0 -5 . Failure to upload a report within a certain interval would indicate an anomaly with the endpoint or an off-line endpoint. Puppet Enterprise's functionality was extended to remove blacklisted software listed in a file made available from an analyst. A script was written to parse the file on a daily basis and inject the appropriate Puppet Enterprise code to remove such listed software. After successful removal, Puppet Enterprise writes a report identifying the offending endpoint, the uninstalled software and the time of removal. 3.7.2 Prerequisites Puppet Enterprise Server requires the following: ▪ at least a four core CPU, 6 GB of RAM and 100 GB of hard drive space ▪ network-wide name resolution via DNS ▪ network-wide time synchronization using NTP NIST SP 1800-5C: IT Asset Management 743.7.3 Installing Puppet Enterprise Server Instructions for installing Puppet Enterprise can be found at T h http://docs.puppetlabs.com/pe/latest/install_pe_mono.html. si p u b 1. Download the Puppet Enterprise tarball from the Puppet Labs web site. Use the instructions ref- cil a t erenced in the preceding link to locate and download the file. oi n a si 2. Run tar -xf <PuppetEnterpriseTarball> to unpack its contents. v a bali 3. List directory with ls to view current directory contents. el rf ee 4. Change into the directory with name puppet-enterprise-<version>-<OSversion>. o c f h 5. Execute sudo ./puppet-enterprise-installer. a r g e rf 6. Connect to Puppet Enterprise Server console by going to: o m https://YourPuppetServerFQDN:3000. : h t t p /: 7. Accept the untrusted connection and make an exception to this site by storing it in your trusted / d o list. o.i r g 1/ 8. Confirm the security exception. 0 6. 0 2 9. From Installation Web page, select Let's get started. 8 / N SI 10. Select Monolithic Installation. T S. P 1. 11. Choose Install on this Server. 8 0 0 -5 . 12. Do not enable the Puppet 4 language parser if your existing Puppet code was developed in Pup- pet 3.xx. 13. Choose to install PostGreSQL on the same server. 14. Supply a console password when prompted. 3.7.4 Puppet Enterprise Linux Agent Installation To install Puppet Enterprise agent on the same platform as the server: 1. Enter curl -k https://YourPuppetServerFQDN:8140/packages/current/install.bash |sudo bash at the agent terminal. 2. Request a certificate by typing puppet agent -t from the client node. 3. Go to the Puppet Enterprise server Web console and log in. NIST SP 1800-5C: IT Asset Management 754. Accept node requests by clicking on the Node link. 5. Click Accept to sign the Certificate. T h p si To install Puppet Enterprise agent on a different platform from the server: u b cil 1. Go to the Puppet Enterprise Web console. a t oi n si 2. Click on Classification. a v a ali 3. Select the PE Master Group. b el rf 4. Click the Classes tab. e e o c f 5. Select your platform from the new class textbox dropdown. h a r eg 6. Click Add Class. rf o m : h 7. Click Commit 1 Change. t t p /: 8. Run puppet agent -t to configure the newly assigned class. / d o o.i 9. To install the agent, enter curl -k https://<YourPuppetServerFQDN>:8140/packages/cur- r g 1/ rent/install.bash | sudo bash. 0 6. 0 2 8 3.7.5 Puppet Enterprise Windows Agent Installation / N SI S.T To install Puppet Enterprise agent on a Windows computer: P 1. 08 1. Make sure to start the installation file or log in to the system with an administrator account. 0 -5 . 2. Double-click the Puppet Enterprise executable file. 3. Accept the default options. 3.7.6 Puppet Enterprise Agent Configuration 1. Agents need to obtain certificates from the Puppet Enterprise Server/Master. Connect to the Puppet Enterprise Server console at https://PuppetEnterpriseServerFQDN. 2. Log in to the console with your configured username and password. 3. Click on Nodes. 4. Accept Node requests from each agent you have configured. The agent’s fully qualified domain name (FQDN) will be displayed. 5. A certificate request can be generated if you do not see one by typing puppet agent -t from the agent terminal. NIST SP 1800-5C: IT Asset Management 766. Certificate requests can be viewed from the Web console of Puppet Enterprise Server. 7. Windows agents offer the option of using the graphical user interface by clicking on Start Pro- T h grams > Puppet Enterprise > Run Puppet Agent. si p u b cil a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI 8. Puppet agents fetch and apply configurations retrieved from the Puppet Enterprise Master T PS. Server. This agent run occurs every 30 minutes. You can change this interval by adding an entry 1. 8 to the /etc/puppetlabs/puppet/puppet.conf file. 0 0 -5 . a. On Linux, add the entry runinterval = 12 to the main section of the /etc/pup- petlabs/puppet/puppet.conf file to have the agent run every 12 hours. b. On Windows, add the entry runinterval = 12 to the main section of the C:\Pro- gramData\PuppetLabs\puppet\etc\puppet.conf file to have the agent run every 12 hours. 3.7.7 Puppet Enterprise Manifest Files and Modules The main configuration file, also called a manifest file in Puppet Enterprise, is /etc/puppetlabs/puppet/environments/production/manifests/site.pp. You can place all the Puppet Enterprise code here for agents to run. In our solution, we created modules, declared classes, and called those modules from within the site.pp file. A module consists of a parent directory that contains a file’s subdirectory and a manifest’s subdirectory. Within the manifests subdirectory will be another file called init.pp that contains the Puppet Enterprise NIST SP 1800-5C: IT Asset Management 77code for that module. The init.pp file must have a class declaration statement. The files subdirectory can be empty or can contain files that need to be copied over to endpoints that will execute code in that module. All modules reside in the directory /etc/puppetlabs/puppet/modules. We have the following T h si modules: p u b cil ▪ /etc/puppetlabs/puppet/modules/windowsnodes a t oi n ▪ /etc/puppetlabs/puppet/modules/ubuntubase si a v ▪ /etc/puppetlabs/puppet/modules/redhatbase a ali elb ▪ /etc/puppetlabs/puppet/modules/clamav rf e e ▪ /etc/puppetlabs/puppet/modules/blacklist o hc f Each has a files directory /etc/puppetlabs/puppet/modules/<modulename>/files and a manifests a r g directory with the /etc/puppetlabs/puppet/modules/<modulename>/manifests/init.pp file. e rf o m : h 3.7.7.1 Module: windowsnodes t t p /: This module configures a baseline for Windows endpoints. Execution of this module copies a number of / d o executable files and the baseline.bat script over to the endpoints from the Puppet Enterprise Server. o.i r Once baseline.bat is executed on the endpoint, it will look for and install the copied over executable g / 1 0 programs, which consist of the belmonitor.exe asset management software agent and an anti-virus 6. 20 software. The text of the /etc/puppetlabs/puppet/modules/windowsnodes/init.pp manifest file is shown 8 N/ in the code and scripts section. SI T S. P 3.7.7.2 Module: ubuntubase 1. 8 0 0 -5 This module configures a baseline for Ubuntu endpoints. It installs software, disables IP forwarding, . installs clamav anti-virus, and copies over files including a script dailyscript that runs daily and is placed in the /etc/cron.daily directory. You can use the same technique to ensure that your scripts remain where you want them. 3.7.7.3 Module: redhatbase This module configures a baseline for RedHat or CentOS based endpoints. It disables IP forwarding on endpoints, copies over files including scripts that run periodically, ensures that the belmonitor asset management software is installed, and configures the logging to the appropriate logging server. NIST SP 1800-5C: IT Asset Management 783.7.7.4 Module: clamav This module installs clamav anti-virus on Ubuntu endpoints and ensures that the clamav-daemon service T h is running. si p bu class clamav{ cil a oit n a si package{'clamav-daemon': ensure=>installed, v a ali } b el rf e e o service{'clamav-daemon': ensure=>running, require=>Package['clamav-daemon'], c f h ra } g e rf } o m : h t 3.7.7.5 Module: blacklist t p /: / d This module removes blacklisted software from endpoints and reports success if the software package is o o.i removed. Its init.pp file is constantly being updated with new software slated for removal. A python r g / 1 script called blacklistenforcer.py is used to populate the module's 0 06. /etc/puppetlabs/puppet/modules/blacklist/manifests/init.pp file. Another python script is used to read 2 8 / reports from the /var/opt/lib/pe-puppet/reports/<HostFQDN> subdirectories to identify successfully N TSI removed blacklisted software. S. P 1. 8 3.7.7.6 Software Blacklist Removal 0 0 -5 . Puppet Enterprise Server is configured to remove blacklisted software from agent nodes. A python script placed in /etc/cron.daily directory runs daily, checking a blacklisted software. The python script will extract the software list from the file /etc/splunkreport/fakeblacklist.csv, write new Puppet code such that Puppet Enterprise catalog includes the blacklisted software, and identifies it to Puppet for removal. 3.7.8 Reporting Puppet agents forward reports of their runs to the Puppet Enterprise server. To ensure reporting is enabled, go to /etc/puppetlabs/puppet/puppet.conf and verify that an entry such as reports = console, puppetdb, store exists under master section of the file. Agents upload reports in the form of YAML files to /var/opt/lib/pe-puppet/reports/<agent_hostname>. In this solution, the Puppet Enterprise Server machine was set up to forward two basic reports to the ITAM server. Both were done with scripts. The first reporting function forwarded checked the fully qualified hostnames of endpoints that failed to upload reports to the server within two reporting cycles. NIST SP 1800-5C: IT Asset Management 79If a reporting interval or cycle is 30 minutes, then failure to upload a report for more than an hour would indicate that an endpoint is offline and would trigger the forwarding of a syslog message to the ITAM server declaring the endpoint absent. Other endpoints that successfully upload reports without missing T h si two cycles are declared present and send an appropriate message to the ITAM server. The script written p u b that accomplishes this is written in BASH and is in the code and scripts section. cil a t oi The second reporting function reports on the successful removal of blacklisted software. It scans n a si through the report files from all the nodes in Puppet Enterprise Server, identifies successfully removed v a software and updates the CSV file /etc/splunkreport/reporttosplunk.csv with information that identifies ali b el the endpoint, the successfully removed software and the time of removal. The Splunk Universal erf Forwarder agent monitors this file and forwards changes to the ITAM server, which uses Splunk e c fo Enterprise as its analysis engine. h a r eg 3.7.9 Report Directory Cleanup rf o m : h Thousands of files could be uploaded to the reports directory in a short time. Therefore, it is important tt to delete files that are no longer needed. We used a python script that ran hourly to delete files p /: / d modification times more than 12 hours old. In this solution, that is equivalent to files that are more than o o.i 12 hours old. This script was placed in the /etc/cron.hourly. r g / 1 0 6. 3.7.10 Puppet Code and Scripts 0 2 8 / SIN 3.7.10.1 Main Manifest Configuration File T S. P 1. 8 0 0 /etc/puppetlabs/puppet/environments/production/manifests/site.pp -5 . ## site.pp ## # This file (/etc/puppetlabs/puppet/manifests/site.pp) is the main # entry point used when an agent connects to a master and asks for an # updated configuration. # # Global objects like filebuckets and resource defaults should go in # this file,as should the default node definition. (The default node # can be omitted # if you use the console and don't define any other nodes in site.pp. # See http://docs.puppetlabs.com/guides/language_guide.html#nodes for # more on node definitions.) NIST SP 1800-5C: IT Asset Management 80## Active Configurations ## T h si p u # PRIMARY FILEBUCKET b cil ta # This configures puppet agent and puppet inspect to back up file oi n si # contents when they run. The Puppet Enterprise console needs this to # display file a v contents and differences. a ali elb rf ee # Define filebucket 'main': filebucket { 'main': o c f server => 'puppet.lab5.nccoe.gov', path => false, h a r g e } rf o m : h t pt # Make filebucket 'main' the default backup location for all File resources: /: / od File { backup => 'main' } o.i gr / 1 0 6. # DEFAULT NODE 0 2 8 / # Node definitions in this file are merged with node data from the console. See N SI T S. # http://docs.puppetlabs.com/guides/language_guide.html#nodes for more P 1. 8 # on node definitions. 0 0 -5 . # The default node definition matches any node lacking a more specific # node definition. If there are no other nodes in this file, classes # declared here will be included in every node's catalog, *in # addition* to any classes specified in the console for that node. node default { # This is where you can declare classes for all nodes. # Example: # class { 'my_class': } } NIST SP 1800-5C: IT Asset Management 81#Changes to the site.pp file were made below this line. #Nodes were specified with the modules that would execute T h #on them si p u node 'centos1', 'fathomsensor1'{ include redhatbase b cil ta include blacklist oi n si } a v a ali node 'ubuntu-client1', 'kibana', 'openvas', 'sensu', 'ubuntu-client2', 'wiki'{ b el rf include blacklist include ubuntubase package{'curl': e e o ensure => installed, c f h a } r g e rf } o m : h t t p /: node 'ubuntu-template', 'jumpbox', 'bro', 'snort', 'apt-cache', 'warehouse'{ / d o o.i include blacklist include ubuntubase package{'curl': r g / 1 ensure => installed, 0 6. 0 2 } 8 / N SI } T S. P 1. 8 0 0 node 'win7-client1', 'win7-client2', 'ad2', 'ad1', 'Belarc', 'eracent'{ include -5 . blacklist include windowsnodes } node 'asset-manager'{ include blacklist include windowsnodes } 3.7.10.2 Windowsnodes Configuration File and Script /etc/puppetlabs/puppet/modules/windowsnodes/manifests/init.pp #This manifest file declares a class called windowsnodes, creates a #C:\software directory, copies a number of files to the agent including the baseline.bat NIST SP 1800-5C: IT Asset Management 82#script and executes the baseline.bat. When executed baseline.bat batch file installs #some programs and turns on the firewall and ensures the guest account is disabled T h class windowsnodes{ file{'C:\software': si p u ensure=>"directory", b cil ta } oi n si a v a ali file{'C:\software\baseline.bat': b el rf source => "puppet:///modules/windowsnodes/baseline.bat", source_permissions=>ignore, e e o require => File['C:\software'], c f h a } r g e rf o m : h file{'C:\software\belmonitor.exe': t t p /: source => "puppet:///modules/windowsnodes/belmonitor.exe", source_permissions=>ignore, / d o o.i require => File['C:\software'], r g / 1 } 0 6. 0 2 8 / N SI file{'C:\software\mbamsetup.exe': T S. P source => "puppet:///modules/windowsnodes/mbamsetup.exe", source_permissions=>ignore, 1. 8 0 0 require => File['C:\software'], -5 . } exec{'win_baseline': command=>'C:\windows\system32\cmd.exe /c C:\software\baseline.bat', require => File['C:\software\belmonitor.exe'], } file{'C:\Program Files (x86)\nxlog\conf\nxlog.conf': source => "puppet:///modules/windowsnodes/nxlog.conf", source_permissions=>ignore, } } NIST SP 1800-5C: IT Asset Management 83/etc/puppetlabs/puppet/modules/windowsnodes/files/baseline.bat T h si p u b REM Install new user called newuser net user newuser /add cil a t oi REM Disable newuser n si a net user newuser /active:no v a ali b el rf REM Disable the guest account net user guest /active:no e e o c f REM Turn on firewall h a gr netsh advfirewall set allprofiles state on e orf m : th REM Use puppet to check if Malwarebytes is installed puppet resource package |find t /:p "Malwarebytes" / d o.io REM Install Malwarebytes silently if not installed r g / if %errorlevel% neq 0 C:\software\mbamsetup.exe /verysilent /norestart sc query |find 1 0 6. "BelMonitorService" 0 2 /8 REM Install Belmonitor if the service is not running if %errorlevel% neq 0 N SI C:\software\belmonitor.exe T S. P 1. 3.7.10.3 Ubuntubase Configuration File and Script 8 0 0 -5 . /etc/puppetlabs/puppet/modules/ubuntubase/manifests/init.pp #This module configures a baseline for Ubuntu endpoints class ubuntubase{ #Copy over the CA certificate file{'/usr/local/share/ca-certificates/CAServerCert.crt': source => "puppet:///modules/ubuntubase/CAServerCert.crt", } # Add CA certificate to Ubuntu endpoint's repository of certificates exec{'update-ca- certificates': command=>'/usr/sbin/update-ca-certificates', } NIST SP 1800-5C: IT Asset Management 84#Ensure the /etc/ufw directory is present or create it file{'/etc/ufw': ensure=>"directory", T h } si p u b cil ta #Copy over the sysctl.conf file to each endpoint. IP forwarding will be oi n si #disabled file{'/etc/ufw/sysctl.conf': a v a ali source => "puppet:///modules/ubuntubase/sysctl.conf", require => File['/etc/ufw'], b el rf } e e o c f h a #Run the clamav module include clamav r g e rf file{'/etc/cron.daily': ensure=>"directory", o m : h } t t p /: / d o o.i file{'/etc/rsyslog.d': ensure=>"directory", r g / 1 } 0 6. 0 2 8 / N SI #Copy over this script to endpoint with associated permissions T S. file{'/etc/cron.daily/dailyscript': P 1. 8 source => "puppet:///modules/ubuntubase/dailyscript", mode => 754, 0 0 -5 . require => File['/etc/cron.daily'], } #Copy over the 50-default.conf file with specified content file{'/etc/rsyslog.d/50- default.conf': content => "*.* @@loghost\n *.* /var/log/syslog", require => File['/etc/rsyslog.d'], } #Copy over Belmonitor Linux installation file file{'/opt/BelMonitorLinux': source => "puppet:///modules/ubuntubase/BelMonitorLinux", } NIST SP 1800-5C: IT Asset Management 85#Make the BelMonitorLinux file executable exec{'belmonitor_executable': command=>'/bin/chmod a+x /opt/BelMonitorLinux', require=>File['/opt/BelMonitorLinux'], } T h si p u b cil exec{'install_rpm': a t oi n command=>'/usr/bin/apt-get install -y rpm', require=>File['/opt/BelMonitorLinux'] si a v } a ali elb rf ee ##Install 32 bit library exec{'install_32bitlibrary': o c f command=>'/usr/bin/apt-get install -y gcc-multilib', require=>Exec['install_rpm'], h a r g e } rf o m : h t pt ##install 32 bit library exec{'install_second_32bit_library': /: / od command=> '/usr/bin/apt-get install -y lib32stdc++6', o.i gr } / 1 0 6. 0 2 8 / exec{'install_belmonitor': command=>'/opt/BelMonitorLinux', N SI require=>Exec['install_32bitlibrary'], T S. P 1. } 8 0 0 -5 . service{'BelMonitor': ensure=>'running', } } /etc/puppetlabs/puppet/modules/ubuntubase/files/dailyscript #!/bin/bash df -kh mount netstat -nult ifconfig -a iptables -L /usr/bin/freshclam cat /var/lib/apt/extended_states apt-get update NIST SP 1800-5C: IT Asset Management 863.7.10.4 Redhatbase Module Configuration File and Script T h si /etc/puppetlabs/puppet/modules/redhatbase/manifests/init.pp p u b cil class redhatbase{ a t oi n si a #Copies over a customized sysctl.conf that disables IP forwarding v a ali file{'/etc/sysctl.conf': b rf el source => "puppet:///modules/redhatbase/sysctl.conf", e e o } c f h a r g e rf #Ensures that cron.daily directory is present or creates it file{'/etc/cron.daily': o m : h ensure=>"directory", t t p /: } / d o o.i r g / 1 file{'/etc/rsyslog.d': ensure=>"directory", 0 6. 20 } 8 / N SI T S. P 1. 8 0 0 #Copies over the a script that runs daily called dailyscript -5 . file{'/etc/cron.daily/dailyscript': source => "puppet:///modules/redhatbase/dailyscript", mode => 754, require => File['/etc/cron.daily'], } #Ensures that log messages are forwarded to loghost and /var/log/messages file{'/etc/rsyslog.d/50-default.conf': content => "*.* @@loghost:514\n *.* /var/log/messages", require => File['/etc/rsyslog.d'], } #Copies over the a script that installs clamav if not installed file{'/etc/cron.daily/claminstall': source => "puppet:///modules/redhatbase/claminstall", mode => 754, NIST SP 1800-5C: IT Asset Management 87require => File['/etc/cron.daily'], } T h si p u ##Ensure the opt dir is present, copy the BelMonitorLinux script file b cil ta ## Copy the belmonitor_install script to the /opt dir oi n si ## Check that the BelMonitor file is present before belmonitor_install a v a ali ## executes b el rf e e o file{'/opt': ensure=>"directory", c f h a } r g e rf file{'/opt/BelMonitorLinux': o m : h source => "puppet:///modules/redhatbase/BelMonitorLinux", t t p /: } / d o o.i r g / 1 ##Make BelMonitorLinux executable exec{'make_executable': 0 6. 0 2 command=>'/bin/chmod a+x /opt/BelMonitorLinux', require => 8 / File['/opt/BelMonitorLinux'], N SI T S. } P 1. 8 0 0 -5 . ##Install dependencies exec{'upgrade_dep1': command=>'/usr/bin/yum -y upgrade libstdc++', } exec{'install_dep2': command=>'/usr/bin/yum -y install libstdc++.i686', } exec{'upgrade_dep3': command=>'/usr/bin/yum -y upgrade zlib', } NIST SP 1800-5C: IT Asset Management 88exec{'install_dep4': command=>'/usr/bin/yum -y install zlib.i686', T h } si p u b cil ta exec{'install_belmonitor': command=>'/opt/BelMonitorLinux', oi n si } a v a ali file{'/opt/belmonitor_install': b el rf source => "puppet:///modules/redhatbase/belmonitor_install", e e o } c f h a r g e rf } o m : h t t p //: /etc/puppetlabs/puppet/modules/redhatbase/files/claminstall d o o.i #!/bin/bash r g / 1 0 # /etc/puppetlabs/puppet/modules/redhatbase/files/claminstall# 6. 0 2 8 # Script installs clamav if not already installed when run / N TSI S. P 1. if rpm -qa clamav; then 8 0 0 -5 echo "Clamav is installed" else . yum install -y epel-release yum --enablerepo=epel -y install clamav clamav-update sed -i -e "s/^Example/#Example/" /etc/freshclam.conf 3.7.10.5 Clamav Puppet Module Configuration File /etc/puppetlabs/puppet/modules/clamav/manifests/init.pp class clamav{ package{'clamav-daemon': ensure=>installed, } service{'clamav-daemon': ensure=>running, require=>Package['clamav-daemon'], } NIST SP 1800-5C: IT Asset Management 89} 3.7.10.6 Blacklisted Software Removal Script T h si p u b cil /etc/puppetlabs/puppet/modules/blacklist/manifests/init.pp a t oi n #!/usr/bin/python3 si va #-------------------------------readreport.py------------------------# a ali b #Script will search through the Puppet reports directory and subdirectories, and el rf identify blacklisted e e o #packages within the yaml files that have been confirmed as removed. It will retrieve hc f the software a r g e #package, host and time of removal and write this to a file called reporttosplunk.csv rf o m : h t pt import os /: / d o #List directories in /var/opt/lib/pe-puppet/reports report_list = o.i os.listdir('/var/opt/lib/pe-puppet/reports') r g / 1 0 #Make the path to reports a string 6. 0 2 8 origdir_path = '/var/opt/lib/pe-puppet/reports' / N TSI S. P 1. action_term = "file: 8 0 0 -5 /etc/puppetlabs/puppet/modules/blacklist/manifests/init.pp" outfile = . open('/etc/splunkreport/reporttosplunk.csv', 'a') #For loop iterates through report_list (or the reports directory) for sub_dirs in report_list: hostname = sub_dirs print(hostname) #Concatenation creates the full path to subdirectories (it remains a string) subdir_path = origdir_path+'/'+sub_dirs #Creates the list of files in the variable (the variable in this case would be a sub directory) #At the end of this block, infile contains a list of line elements in each file sub_dirs_list = os.listdir(subdir_path) for files in sub_dirs_list: files_path = subdir_path+'/'+files reportfile = open(files_path, "r") infile = reportfile.readlines() reportfile.close() #line_counter used in keeping track of the index for the line elements in each file NIST SP 1800-5C: IT Asset Management 90line_counter = 0 T h for line in infile: si p u if action_term in line: b cil ta if "source" in infile[line_counter + 3]: bad_package = infile[line_counter + 3] oi n bad_package = bad_package.replace('\n',',') if "removed" in infile[line_counter + 2]: si a v message_var = infile[line_counter + 2] message_var = message_var.replace('\n',',') if a ali "time" in infile[line_counter + 1]: b el rf time_var = infile[line_counter + 1] time_var = time_var.replace('\n',',') e e refined_bad_pkg = bad_package.split('/') bad_pkg = refined_bad_pkg o c f h bad_pkg = bad_pkg + "," a r g rf e print(hostname+","+bad_pkg+message_var+time_var+'\n') o m : h t t p outfile.write(hostname+','+bad_pkg+message_var+time_var+'\n') line_counter = /: / d line_counter + 1 o o.i gr 3.7.10.7 Reports Directory Cleanup Script / 1 0 6. 0 2 8 / N /etc/cron.hourly/cleanreportdir.py SI T PS. #!/usr/bin/python3 1. 8 0 0 -5 . #-------------------cleanreportdir.py----------------------------# #Script removes files with mtimes older than 12 hours to keep the number of files to a manageable size #Files removed are from the reports subdirectory within Puppet import os import time #List directories in /var/opt/lib/pe-puppet/reports report_list = os.listdir('/var/opt/lib/pe-puppet/reports') #Make the path to reports a string origdir_path = '/var/opt/lib/pe-puppet/reports' #For loop iterates through report_list for sub_dirs in report_list: #Concatenation creates the full path to subdirectories (it remains a string) subdir_path = origdir_path+'/'+sub_dirs NIST SP 1800-5C: IT Asset Management 91print('Old files are being removed from ',subdir_path) #Creates the list of files in the variable sub_dirs_list sub_dirs_list = os.listdir(subdir_path) T h si p for files in sub_dirs_list: u b cil files_path = subdir_path+'/'+files mtime = os.path.getmtime(files_path) current_time = a oit time.time() n a si time_diff = current_time - mtime v a ali #Removes files with mtimes older than 12 hours if time_diff > 43200: b el rf print(files_path, " will be deleted") os.remove(files_path) e e o c f 3.7.10.8 Reporting Section Script h a r g #!/bin/bash e rf mo #/etc/cron.hourly/nodereport : h tt #Time in seconds before declaring an agent that has not checked in absent p /: / d #Change the time to suit your needs o o.i r let "desired_interval=3600" g / 1 0 6. 0 2 /8 for node in $(ls /var/opt/lib/pe-puppet/yaml/node) do N SI T #Strip out the yaml extension from the node name node=${node%.*} S. P 81. #Get time of most recent agent run or check in 0 0 -5 #This time will be reported without formatting node_report_time=$(date -r . /var/opt/lib/pe-puppet/yaml/facts/$node.yaml) #Get epoch time of agent facter yaml file, assign time to variable node_time=$(date +%s -r /var/opt/lib/pe-puppet/yaml/facts/$node.yaml) #Assign current epoch_time to variable current_time=$(date +%s) #Subtract node most recent report time from current time and #assign to variable node_interval=$((current_time-node_time)) #Nodes that have not reported in the given interval are #declared absent, otherwise they are declared present if (("$node_interval" > "$desired_interval")) then echo $node "is absent with a last run time of " NIST SP 1800-5C: IT Asset Management 92$node_report_time logger $node "is absent. Last run is " $node_report_time T h si p u else b cil ta echo $node "is present with a last run time of " oi n si $node_report_time a v a ali logger $node "is present. Last run is " $node_report_time b el rf fi e e o done c f h a gr 3.8 Snort e rf o m Snort is an open-source intrusion detection system. Snort efficiently analyzes all network traffic and : h t matches it with signatures of know bad traffic. An alert is generated if a signature is matched. t p /: / d o.io 3.8.1 How It’s Used r g / 1 In the FS ITAM build, Snort monitors all traffic traversing the DMZ. 0 6. 0 2 On the high-level architecture diagram, Snort is in Tier 2. Snort utilizes the Splunk Universal Forwarder 8 / N SI to send alerts to Splunk Enterprise. T S. P 1. 3.8.2 Virtual Machine Configuration 8 0 0 -5 . The Snort virtual machine is configured with one network interface card, 2 GB of RAM and one CPU core. 3.8.3 Network Configuration The management network interface card is configured as follows: ▪ IPv4 Manual ▪ IPv6 Ignore/Disabled ▪ IP Address: 172.16.0.40 ▪ Netmask: 255.255.255.0 ▪ Gateway: 172.16.0.11 ▪ DNS Servers: 172.16.1.20, 172.16.1.21 ▪ Search Domains: lab5.nccoe.gov NIST SP 1800-5C: IT Asset Management 933.8.4 Installing Snort Snort is installed on a hardened Ubuntu 14.04 Linux system. Complete installation instructions can be T h found at: https://www.snort.org/. si p u b This installation utilized the Snort IDS and Barnyard2 to interpret binary Snort alerts into readable text. cil a t oi si n 3.8.5 Installing Snort a v alia 1. For Debian/Ubuntu Linux systems, it is always best to make sure your system is up-to-date by b el performing: rf e e sudo apt-get update o c f h sudo apt-get upgrade a r g rf e sudo apt-get install snort o m : h 2. You will be asked to input your local networks. For the FS-ITAM lab this is 172.16.0.0/16. t t p /: 3. Configure /etc/snort/snort.debian.conf. / d o o.i 4. Make sure that the correct HOME_NET and INTERFACE are specified in r g 1/ /etc/snort/snort.debian.conf. 0 6. 0 2 DEBIAN_SNORT_HOME_NET="172.16.0.0/16" 8 / N SI T DEBIAN_SNORT_INTERFACE="eth0" S. P 1. 8 5. Configure /etc/snort/snort.conf. 0 0 -5 . 6. Comment out all output configuration lines and add the following: output unified2: filename /var/log/snort/snort.log, limit 128, mpls_event_types, vlan_event_types The preceding line is important for Barnyard2 to work correctly. 3.8.6 Get Updated Community Rules cd /opt wget https://snort.org/downloads/community/community-rules.tar.gz tar xzvf community.rules.tar.gz -C /etc/snort/rules These community rules contain the sid-msg.map file that Barnyard2 needs. mkdir /etc/snort/etc cp /etc/snort/rules/community-rules/sid-msg.map /etc/snort/etc NIST SP 1800-5C: IT Asset Management 94Note: In a production environment, it is advisable to install an automatic rule updater such as PulledPork. PulledPork requires obtaining an account at Snort.org which results in an Oinkcode. T h si 3.8.7 Installing Barnyard2 p u b cil 1. Install the prerequisites: a t oi n sudo apt-get install build-essential libtool autoconf git nmap si a v sudo apt-get install libpcap-dev libmysqld-dev libpcre3-dev libdumbnet-dev a ali b sudo apt-get install flex bison ldconfig el rf e e 2. Barnyard2 requires the <dnet.h> header. Unfortunately, Ubuntu names this header <dumb- o c f net.h> so we must create a symbolic link for Barnyard2 to compile. h a r eg cd /usr/include rf o m ln -s /usr/include/dumbnet.h dnet.h : h t pt Note: You need to be root to install Barnyard2. /: / d o cd /opt o.i r /g Need the Daq libraries from Snort 1 0 06. wget https://www.snort.org/downloads/snort/daq-2.0.6.tar.gz 2 8 N/ tar xzvf daq-2.0.6.tar.gz SI T S. cd /opt/daq-2.0.6 P 1. 08 ./configure make 0 -5 . make install git clone https://github.com/firnsy/barnyard2.git cd /opt/barnyard2 ./autogen.sh ./configure make make install 3. Copy the provided barnyard2.conf file to /usr/local/etc: cp /usr/local/etc/barnyard2.conf /usr/local/etc/barnyard2.conf.orig cp <barnyard2.conf> /usr/local/etc 4. Create a link inside /etc/snort to this file: ln -s /usr/local/etc/barnyard2 /etc/snort/barnyard.conf NIST SP 1800-5C: IT Asset Management 955. Copy the provided barnyard2 init script to /etc/init.d and make it executable: cp <barnyard2> /etc/init.d chmod 755 /etc/init.d/barnyard2 T sih sudo update-rc.d barnyard2 defaults sudo update-rc.d barnyard2 enable p u cilb 6. Start up Barnyard2: a t oi /etc/init.d/barnyard2 start n si va Error messages can be found in /var/log/syslog. a ali b el 3.8.8 Testing rf e e o Performing these steps will let you know that Snort and Barnyard2 are working. c f h a gr 1. Add a local rule. e rf mo 2. Edit /etc/snort/rules/local.rules by adding the following line at the bottom that will generate : h alerts for any ICMP/Ping traffic: t t p /: / d alert icmp any any -> any any (msg: "ICMP Detected";classtype:unknown; sid:1000001; rev:1;) o o.i r g Note: the sid must be greater than 1 million. / 1 0 06. 3. Restart Snort: 2 8 / N service snort restart SI T S. P 4. Verify that Snort is running: 1. 8 0 0 ps -ef |grep snort -5 . 5. Verify that Barnyard2 is running: ps -ef |grep barnyard2 6. Check the logs in /var/log/snort. The snort.log and alert files should both be growing fast. 7. You can view the alert file: tail -f /var/log/snort/alert Note: Do not leave this test running. If you do, it will fill your hard drive. 8. If everything is good, just comment out the line that you created in local.rules and restart Snort. NIST SP 1800-5C: IT Asset Management 963.8.9 Installing Splunk Universal Forwarder Note: You will need a Splunk account to download the Splunk Universal Forwarder. It is free and can be T h set up at: https://www.splunk.com/page/sign_up. si p u b 1. Download the Splunk Universal Forwarder from: http://www.splunk.com/en_us/download/uni- cil a t versal-forwarder.html. oi n a si 2. You want the latest version for OS version 2.6+ kernel Linux distributions (64-bit). v a ali Since this is installing on Ubuntu, select the file that ends in .deb. An example is: b el rf splunkforwader-6.2.5-272645-linux-2.6-amd64.deb e e c fo Detailed installation instructions can be found at: h a http://docs.splunk.com/Documentation/Splunk/6.2.3/Installation/InstallonLinux. r g e rf 3. An abridged version follows: o m : h dpkg -i <splunk_package_name.deb> t t p /: / d Example: dpkg -i splunkforwader-6.2.5-272645-linux-2.6-amd64.deb o o.i gr 4. This will install in /opt/splunkforwarder: / 1 0 6. cd /opt/splunkforwarder/bin 0 2 8 / ./splunk start --accept-license N SI T S. ./splunk enable boot-start P 1. 08 5. Add forwarder: 0 -5 . More information about adding a forwarder can be found at: http://docs.splunk.com/Documentation/Splunk/6.2.3/Forwarding/Deployanixdfmanually. cd /opt/splunkforwarder/bin ./splunk add forward-server loghost:9997 -auth admin:changme 3.8.10 Configuring Splunk Universal Forwarder Configuring Splunk Universal Forwarder as shown in the FS-ITAM use case requires X.509 Certificates for the Splunk Enterprise server/indexer and each Splunk Universal Forwarder. You will also need a copy of your certificate authority’s public certificate. 1. Create a directory to hold your certificates: mkdir /opt/splunkforwarder/etc/certs NIST SP 1800-5C: IT Asset Management 972. Copy your certificates in PEM format to /opt/splunkforwarder/etc/certs: cp CAServerCert.pem /opt/splunkforwarder/etc/certs T sih cp bro_worker1.pem /opt/splunkforwarder/etc/certs p u cilb 3. Copy Splunk Universal Forwarder configuration files: a t oi cp <server.conf> /opt/splunkforwarder/etc/system/local n si a cp <inputs.conf> /opt/splunkforwarder/etc/system/local v a bali cp <outputs.conf> /opt/splunkforwarder/etc/system/local el erf 4. Modify server.conf so that: e o hc f ServerName=snort is your hostname. a r g rf e sslKeysfilePassword = <password for your private key> o m : h 5. Modify outputs.conf so that: t t p /: Server = loghost:9997 is your correct Splunk Enterprise server/indexer and port. / d o o.i sslPassword = <password of your certificate private key> r g / 1 0 Note: This will be hashed and not clear text after a restart. 6. 0 2 8 Inputs.conf should work, but you are free to modify it to include the Bro logs that you are interested in. / N SI T PS. 3.8.11 Configurations and Scripts 1. 8 00 -5 . /etc/default/barnyard2 # Config file for /etc/init.d/barnyard2 #LOG_FILE="snort_unified.log" LOG_FILE="snort.log" # You probably don't want to change this, but in case you do SNORTDIR="/var/log/snort" INTERFACES="eth0" # Probably not this either CONF=/etc/snort/barnyard2.conf EXTRA_ARGS=" /etc/snort/snort.conf #-------------------------------------------------- NIST SP 1800-5C: IT Asset Management 98# VRT Rule Packages Snort.conf # T h # For more information visit us at: si p u # http://www.snort.org Snort Website b cil ta # http://vrt-blog.snort.org/ Sourcefire VRT Blog oi n si # a v a ali # Mailing list Contact: snort-sigs@lists.sourceforge.net b el rf # False Positive reports: fp@sourcefire.com e e o # Snort bugs: bugs@snort.org c f h a # r g e rf # Compatible with Snort Versions: o m : h # VERSIONS : 2.9.6.0 t t p /: # / d o o.i # Snort build options: r g / 1 # OPTIONS : --enable-gre --enable-mpls --enable-targetbased 0 6. 0 2 --enable-ppm --enable-perfprofiling --enable-zlib 8 / N SI --enable-active-response --enable-normalizer --enable-reload T S. P --enable-react --enable-flexresp3 1. 8 0 0 # -5 . # Additional information: # This configuration file enables active response, to run snort in # test mode -T you are required to supply an interface -i <interface> # or test mode will fail to fully validate the configuration and # exit with a FATAL error #-------------------------------------------------- ################################################### # This file contains a sample snort configuration. # You should take the following steps to create your own custom configuration: # NIST SP 1800-5C: IT Asset Management 99# 1) Set the network variables. # 2) Configure the decoder T h # 3) Configure the base detection engine si p u # 4) Configure dynamic loaded libraries b cil ta # 5) Configure preprocessors oi n si # 6) Configure output plugins a v a ali # 7) Customize your rule set b el rf # 8) Customize preprocessor and decoder rule set e e o # 9) Customize shared object rule set c f h a ################################################### r g e rf o m : h ################################################### t t p /: # Step #1: Set the network variables. For more information, see README.variables / d o o.i ################################################### r g / 1 0 6. 0 2 # Setup the network addresses you are protecting 8 / N SI # T S. P # Note to Debian users: this value is overriden when starting 1. 8 0 0 # up the Snort daemon through the init.d script by the -5 . # value of DEBIAN_SNORT_HOME_NET s defined in the # /etc/snort/snort.debian.conf configuration file # ipvar HOME_NET any # Set up the external network addresses. Leave as "any" in most situations ipvar EXTERNAL_NET any # If HOME_NET is defined as something other than "any", alternative, you can # use this definition if you do not want to detect attacks from your internal # IP addresses: #ipvar EXTERNAL_NET !$HOME_NET NIST SP 1800-5C: IT Asset Management 100# List of DNS servers on your network ipvar DNS_SERVERS $HOME_NET T h # List of SMTP servers on your network ipvar SMTP_SERVERS $HOME_NET si p u # List of web servers on your network ipvar HTTP_SERVERS $HOME_NET b cil ta # List of sql servers on your network ipvar SQL_SERVERS $HOME_NET oi n si # List of telnet servers on your network ipvar TELNET_SERVERS $HOME_NET a v a ali # List of ssh servers on your network ipvar SSH_SERVERS $HOME_NET b el rf # List of ftp servers on your network ipvar FTP_SERVERS $HOME_NET e e o # List of sip servers on your network ipvar SIP_SERVERS $HOME_NET c f h a # List of ports you run web servers on portvar HTTP_PORTS r g e rf [36,80,81,82,83,84,85,86,87,88,89,90,311,383,555,591,593,631,801,808,8 o m : h 18,901,972,1158,1220,1414,1533,1741,1830,2231,2301,2381,2809,3029,3037 t t p /: ,3057,3128,3443,3702,4000,4343,4848,5117,5250,6080,6173,6988,7000,7001 / d o o.i ,7144,7145,7510,7770,7777,7779,8000,8008,8014,8028,8080,8081,8082,8085 r g / 1 ,8088,8090,8118,8123,8180,8181,8222,8243,8280,8300,8500,8509,8800,8888 0 6. 0 2 ,8899,9000,9060,9080,9090,9091,9111,9443,9999,10000,11371,12601,15489, 8 / N SI 29991,33300,34412,34443,34444,41080,44449,50000,50002,51423,53331,5525 T S. P 2,55555,56712] 1. 8 0 0 # List of ports you want to look for SHELLCODE on. portvar SHELLCODE_PORTS !80 -5 . # List of ports you might see oracle attacks on portvar ORACLE_PORTS 1024: # List of ports you want to look for SSH connections on: portvar SSH_PORTS 22 # List of ports you run ftp servers on portvar FTP_PORTS [21,2100,3535] # List of ports you run SIP servers on portvar SIP_PORTS [5060,5061,5600] # List of file data ports for file inspection portvar FILE_DATA_PORTS [$HTTP_PORTS,110,143] # List of GTP ports for GTP preprocessor portvar GTP_PORTS [2123,2152,3386] # other variables, these should not be modified ipvar AIM_SERVERS [64.12.24.0/23,64.12.28.0/23,64.12.161.0/24,64.12.163.0/24,64.12.200.0 /24,205.188.3.0/24,205.188.5.0/24,205.188.7.0/24,205.188.9.0/24,205.18 8.153.0/24,205.188.179.0/24,205.188.248.0/24] NIST SP 1800-5C: IT Asset Management 101# Path to your rules files (this can be a relative path) # Note for Windows users: You are advised to make this an absolute path, T h # such as: c:\snort\rules si p u #var RULE_PATH /etc/snort/rules var RULE_PATH rules b cil ta var SO_RULE_PATH /etc/snort/so_rules oi n si var PREPROC_RULE_PATH /etc/snort/preproc_rules a v a ali b el rf # If you are using reputation preprocessor set these e e o # Currently there is a bug with relative paths, they are relative to where snort is c f h a # not relative to snort.conf like the above variables r g e rf # This is completely inconsistent with how other vars work, BUG 89986 o m : h # Set the absolute path appropriately var WHITE_LIST_PATH /etc/snort/rules var t pt BLACK_LIST_PATH /etc/snort/rules /: / od ################################################### o.i gr # Step #2: Configure the decoder. For more information, see README.decode / 1 0 6. ################################################### 0 2 8 / N SI T S. # Stop generic decode events: config disable_decode_alerts P 1. 8 # Stop Alerts on experimental TCP options config disable_tcpopt_experimental_alerts 0 0 -5 . # Stop Alerts on obsolete TCP options config disable_tcpopt_obsolete_alerts # Stop Alerts on T/TCP alerts config disable_tcpopt_ttcp_alerts # Stop Alerts on all other TCPOption type events: config disable_tcpopt_alerts # Stop Alerts on invalid ip options config disable_ipopt_alerts # Alert if value in length field (IP, TCP, UDP) is greater th elength of the packet # config enable_decode_oversized_alerts # Same as above, but drop packet if in Inline mode (requires enable_decode_oversized_alerts) # config enable_decode_oversized_drops # Configure IP / TCP checksum mode config checksum_mode: all NIST SP 1800-5C: IT Asset Management 102# Configure maximum number of flowbit references. For more information, see README.flowbits # config flowbits_size: 64 T h si p u b cil # Configure ports to ignore a t oi n # config ignore_ports: tcp 21 6667:6671 1356 si a v # config ignore_ports: udp 1:17 53 a ali elb rf ee # Configure active response for non inline operation. For more information, see c fo REAMDE.active h ra # config response: eth0 attempts 2 g e orf # Configure DAQ related options for inline operation. For more information, see m README.daq : h t t p # /: / d o # config daq: <type> o.i r /g # config daq_dir: <dir> 1 0 06. # config daq_mode: <mode> 2 8 / N # config daq_var: <var> SI T S. # P 1. 8 0 # <type> ::= pcap | afpacket | dump | nfq | ipq | ipfw 0 -5 . # <mode> ::= read-file | passive | inline # <var> ::= arbitrary <name>=<value passed to DAQ # <dir> ::= path as to where to look for DAQ module so's # Configure specific UID and GID to run snort as after dropping privs. For more information see snort -h command line options # # config set_gid: # config set_uid: # Configure default snaplen. Snort defaults to MTU of in use interface. For more information see README NIST SP 1800-5C: IT Asset Management 103# # config snaplen: T h # si p u b cil ta # Configure default bpf_file to use for filtering what traffic reaches snort. For more oi n information see snort -h command line options (-F) si a v # a ali elb # config bpf_file: rf ee # o c f h a r g e # Configure default log directory for snort to log to. For more information see snort orf -h command line options (-l) m : h # t t p //: # config logdir: d o o.i r g / 1 0 ################################################### 6. 0 82 # Step #3: Configure the base detection engine. For more information, see README.decode / N SI ################################################### T S. P 1. 8 0 0 -5 # Configure PCRE match limitations config pcre_match_limit: 3500 . config pcre_match_limit_recursion: 1500 # Configure the detection engine See the Snort Manual, Configuring Snort - Includes - Config config detection: search-method ac-split search-optimize max-pattern-len 20 # Configure the event queue. For more information, see README.event_queue config event_queue: max_queue 8 log 5 order_events content_length ################################################### ## Configure GTP if it is to be used. ## For more information, see README.GTP #################################################### NIST SP 1800-5C: IT Asset Management 104# config enable_gtp T h si p u ################################################### b cil ta # Per packet and rule latency enforcement oi n si # For more information see README.ppm a v a ali ################################################### b el rf e e o # Per Packet latency configuration c f h a #config ppm: max-pkt-time 250, \ r g e rf # fastpath-expensive-packets, \ o m : h # pkt-log t t p /: / d o o.i # Per Rule latency configuration r g / 1 #config ppm: max-rule-time 200, \ 0 6. 0 2 # threshold 3, \ 8 / N SI # suspend-expensive-rules, \ T S. P # suspend-timeout 20, \ 1. 8 0 0 # rule-log alert -5 . ################################################### # Configure Perf Profiling for debugging # For more information see README.PerfProfiling ################################################### #config profile_rules: print all, sort avg_ticks #config profile_preprocs: print all, sort avg_ticks ################################################### # Configure protocol aware flushing NIST SP 1800-5C: IT Asset Management 105# For more information see README.stream5 ################################################### T h config paf_max: 16000 si p u b cil ta ################################################### oi n si # Step #4: Configure dynamic loaded libraries. a v a ali # For more information, see Snort Manual, Configuring Snort - Dynamic Modules b el rf ################################################### e e o # path to dynamic preprocessor libraries c f h a dynamicpreprocessor directory /usr/lib/snort_dynamicpreprocessor/ r g e rf o m : h # path to base preprocessor engine t t p /: dynamicengine /usr/lib/snort_dynamicengine/libsf_engine.so / d o o.i r g / 1 # path to dynamic rules libraries 0 6. 0 2 dynamicdetection directory /usr/lib/snort_dynamicrules 8 / N SI T S. P ################################################### 1. 8 0 0 # Step #5: Configure preprocessors -5 . # For more information, see the Snort Manual, Configuring Snort - Preprocessors ################################################### # GTP Control Channle Preprocessor. For more information, see README.GTP # preprocessor gtp: ports { 2123 3386 2152 } # Inline packet normalization. For more information, see README.normalize # Does nothing in IDS mode preprocessor normalize_ip4 preprocessor normalize_tcp: ips ecn stream preprocessor normalize_icmp4 preprocessor normalize_ip6 preprocessor normalize_icmp6 NIST SP 1800-5C: IT Asset Management 106# Target-based IP defragmentation. For more inforation, see README.frag3 preprocessor frag3_global: max_frags 65536 T h preprocessor frag3_engine: policy windows detect_anomalies overlap_limit 10 si p min_fragment_length 100 timeout 180 u b cil a t oi n # Target-Based stateful inspection/stream reassembly. For more inforation, see a si README.stream5 v a ali preprocessor stream5_global: track_tcp yes, \ track_udp yes, \ b el rf track_icmp no, \ max_tcp 262144, \ e e c fo max_udp 131072, \ h ra max_active_responses 2, \ g e orf min_response_seconds 5 m : h preprocessor stream5_tcp: policy windows, detect_anomalies, require_3whs 180, \ t t p //: overlap_limit 10, small_segments 3 bytes 150, timeout 180, \ d o o.i ports client 21 22 23 25 42 53 70 79 109 110 111 113 119 135 136 137 r g / 1 0 139 143 \ 6. 0 82 161 445 513 514 587 593 691 1433 1521 1741 2100 3306 6070 6665 / N SI 6666 6667 6668 6669 \ T S. P 1. 7000 8181 32770 32771 32772 32773 32774 32775 32776 32777 32778 8 0 0 -5 32779, \ . ports both 36 80 81 82 83 84 85 86 87 88 89 90 110 311 383 443 465 563 555 591 593 631 636 801 808 818 901 972 989 992 993 994 995 1158 1220 1414 1533 1741 1830 2231 2301 2381 2809 3029 3037 3057 3128 3443 3702 4000 4343 4848 5117 5250 6080 6173 6988 7907 7000 7001 7144 7145 7510 7802 7770 7777 7779 \ 7801 7900 7901 7902 7903 7904 7905 7906 7908 7909 7910 7911 7912 7913 7914 7915 7916 \ 7917 7918 7919 7920 8000 8008 8014 8028 8080 8081 8082 8085 8088 8090 8118 8123 8180 8181 8222 8243 8280 8300 8500 8509 8800 8888 8899 9000 9060 9080 9090 9091 9111 9443 9999 10000 11371 12601 15489 29991 33300 34412 34443 34444 41080 44449 50000 50002 51423 53331 55252 55555 NIST SP 1800-5C: IT Asset Management 10756712 preprocessor stream5_udp: timeout 180 T h si p u # performance statistics. For more information, see the Snort Manual, Configuring b cil Snort - Preprocessors - Performance Monitor a t oi n # preprocessor perfmonitor: time 300 file /var/snort/snort.stats pktcnt 10000 si a v a ali elb # HTTP normalization and anomaly detection. For more information, see rf README.http_inspect e e c fo preprocessor http_inspect: global iis_unicode_map unicode.map 1252 compress_depth h 65535 decompress_depth 65535 max_gzip_mem 104857600 a r g rf e preprocessor http_inspect_server: server default \ o m http_methods { GET POST PUT SEARCH MKCOL COPY MOVE LOCK UNLOCK NOTIFY POLL BCOPY : h t BDELETE BMOVE LINK UNLINK OPTIONS HEAD DELETE TRACE TRACK CONNECT SOURCE SUBSCRIBE t p /: UNSUBSCRIBE PROPFIND PROPPATCH BPROPFIND BPROPPATCH RPC_CONNECT PROXY_SUCCESS / d BITS_POST CCM_POST SMS_POST RPC_IN_DATA RPC_OUT_DATA RPC_ECHO_DATA } \ o o.i gr chunk_length 500000 \ / 1 0 6. server_flow_depth 0 \ 0 2 8 / client_flow_depth 0 \ N SI S.T post_depth 65495 \ P 1. 8 oversize_dir_length 500 \ 0 0 -5 max_header_length 750 \ . max_headers 100 \ max_spaces 200 \ small_chunk_length { 10 5 } \ ports { 36 80 81 82 83 84 85 86 87 88 89 90 311 383 555 591 593 631 801 808 818 901 972 1158 1220 1414 1741 1830 2231 2301 2381 2809 3029 3037 3057 3128 3443 3702 4000 4343 4848 5117 5250 6080 6173 6988 7000 7001 7144 7145 7510 7770 7777 7779 8000 8008 8014 8028 8080 8081 8082 8085 8088 8090 8118 8123 8180 8181 8222 8243 8280 8300 8500 8509 8800 8888 8899 9000 9060 9080 9090 9091 9111 9443 9999 10000 11371 12601 15489 29991 33300 34412 34443 34444 41080 44449 50000 50002 51423 53331 55252 55555 56712 } \ NIST SP 1800-5C: IT Asset Management 108non_rfc_char { 0x00 0x01 0x02 0x03 0x04 0x05 0x06 0x07 } \ enable_cookie \ extended_response_inspection \ inspect_gzip \ T h normalize_utf \ unlimited_decompress \ normalize_javascript \ apache_whitespace no \ si p ascii no \ u b cil bare_byte no \ directory no \ double_decode no \ iis_backslash no \ iis_delimiter no \ a oit iis_unicode no \ multi_slash no \ utf_8 no \ u_encode yes \ webroot no n a si # ONC-RPC normalization and anomaly detection. For more information, see the Snort av Manual, Configuring Snort - Preprocessors - RPC Decode ali b el preprocessor rpc_decode: 111 32770 32771 32772 32773 32774 32775 32776 rf e e 32777 32778 32779 no_alert_multiple_requests no_alert_large_fragments o c f no_alert_incomplete h a gr e rf o # Back Orifice detection. preprocessor bo m : h t # FTP / Telnet normalization and anomaly detection. For more information, see t p /: README.ftptelnet / d o o.i preprocessor ftp_telnet: global inspection_type stateful encrypted_traffic no gr check_encrypted / 1 0 6. preprocessor ftp_telnet_protocol: telnet \ ayt_attack_thresh 20 \ 0 2 8 / normalize ports { 23 } \ detect_anomalies N SI S.T preprocessor ftp_telnet_protocol: ftp server default \ def_max_param_len 100 \ P 1. 8 ports { 21 2100 3535 } \ telnet_cmds yes \ ignore_telnet_erase_cmds yes \ 0 0 -5 ftp_cmds { ABOR ACCT ADAT ALLO APPE AUTH CCC CDUP } \ ftp_cmds { CEL CLNT CMD CONF CWD . DELE ENC EPRT } \ ftp_cmds { EPSV ESTA ESTP FEAT HELP LANG LIST LPRT } \ ftp_cmds { LPSV MACB MAIL MDTM MIC MKD MLSD MLST } \ ftp_cmds { MODE NLST NOOP OPTS PASS PASV PBSZ PORT } \ ftp_cmds { PROT PWD QUIT REIN REST RETR RMD RNFR } \ ftp_cmds { RNTO SDUP SITE SIZE SMNT STAT STOR STOU } \ ftp_cmds { STRU SYST TEST TYPE USER XCUP XCRC XCWD } \ ftp_cmds { XMAS XMD5 XMKD XPWD XRCP XRMD XRSQ XSEM } \ ftp_cmds { XSEN XSHA1 XSHA256 } \ alt_max_param_len 0 { ABOR CCC CDUP ESTA FEAT LPSV NOOP PASV PWD QUIT REIN STOU SYST XCUP XPWD } \ alt_max_param_len 200 { ALLO APPE CMD HELP NLST RETR RNFR STOR STOU XMKD } \ alt_max_param_len 256 { CWD RNTO } \ alt_max_param_len 400 { PORT } \ alt_max_param_len 512 { SIZE } \ chk_str_fmt { ACCT ADAT ALLO APPE AUTH CEL CLNT CMD } \ chk_str_fmt { CONF CWD DELE ENC EPRT EPSV ESTP HELP } \ chk_str_fmt { LANG LIST LPRT MACB MAIL MDTM MIC MKD } \ chk_str_fmt { MLSD MLST MODE NLST OPTS PASS PBSZ PORT } \ chk_str_fmt { PROT REST RETR NIST SP 1800-5C: IT Asset Management 109RMD RNFR RNTO SDUP SITE } \ chk_str_fmt { SIZE SMNT STAT STOR STRU TEST TYPE USER } \ chk_str_fmt { XCRC XCWD XMAS XMD5 XMKD XRCP XRMD XRSQ } \ chk_str_fmt { XSEM XSEN XSHA1 XSHA256 } \ cmd_validity ALLO < int [ char R int ] > \ T h si p cmd_validity EPSV < [ { char 12 | char A char L char L } ] > \ cmd_validity MACB < u b string > \ cil a oit cmd_validity MDTM < [ date nnnnnnnnnnnnnn[.n[n[n]]] ] string > \ cmd_validity MODE < si n char ASBCZ > \ a av cmd_validity PORT < host_port > \ cmd_validity PROT < char CSEP > \ cmd_validity STRU bali < char FRPO [ string ] > \ el rf cmd_validity TYPE < { char AE [ char NTC ] | char I | char L [ number ] } > e e o c f preprocessor ftp_telnet_protocol: ftp client default \ max_resp_len 256 \ h a gr bounce yes \ ignore_telnet_erase_cmds yes \ telnet_cmds yes e rf o # SMTP normalization and anomaly detection. For more information, see README.SMTP m : h t preprocessor smtp: ports { 25 465 587 691 } \ inspection_type stateful \ t p /: b64_decode_depth 0 \ / d o o.i qp_decode_depth 0 \ r g 1/ bitenc_decode_depth 0 \ 0 6. 0 uu_decode_depth 0 \ log_mailfrom \ log_rcptto \ log_filename \ log_email_hdrs \ 2 8 / normalize cmds \ N SI S.T normalize_cmds { ATRN AUTH BDAT CHUNKING DATA DEBUG EHLO EMAL ESAM ESND ESOM ETRN EVFY 1.P } \ 8 0 0 normalize_cmds { EXPN HELO HELP IDENT MAIL NOOP ONEX QUEU QUIT RCPT RSET SAML SEND -5 . SOML } \ normalize_cmds { STARTTLS TICK TIME TURN TURNME VERB VRFY X-ADAT X-DRCP X-ERCP X- EXCH50 } \ normalize_cmds { X-EXPS X-LINK2STATE XADR XAUTH XCIR XEXCH50 XGEN XLICENSE XQUE XSTA XTRN XUSR } \ max_command_line_len 512 \ max_header_line_len 1000 \ max_response_line_len 512 \ alt_max_command_line_len 260 { MAIL } \ alt_max_command_line_len 300 { RCPT } \ alt_max_command_line_len 500 { HELP HELO ETRN EHLO } \ alt_max_command_line_len 255 { EXPN VRFY ATRN SIZE BDAT DEBUG EMAL ESAM ESND ESOM EVFY IDENT NOOP RSET } \ NIST SP 1800-5C: IT Asset Management 110alt_max_command_line_len 246 { SEND SAML SOML AUTH TURN ETRN DATA RSET QUIT ONEX QUEU STARTTLS TICK TIME TURNME VERB X-EXPS X-LINK2STATE XADR XAUTH XCIR XEXCH50 XGEN XLICENSE XQUE XSTA XTRN XUSR } \ T sih valid_cmds { ATRN AUTH BDAT CHUNKING DATA DEBUG EHLO EMAL ESAM ESND ESOM ETRN EVFY } \ p u b valid_cmds { EXPN HELO HELP IDENT MAIL NOOP ONEX QUEU QUIT RCPT RSET SAML SEND SOML } acil \ t oi si n valid_cmds { STARTTLS TICK TIME TURN TURNME VERB VRFY X-ADAT X-DRCP X-ERCP X-EXCH50 } a \ v a bali valid_cmds { X-EXPS X-LINK2STATE XADR XAUTH XCIR XEXCH50 XGEN XLICENSE XQUE XSTA XTRN el XUSR } \ rf e e o xlink2state { enabled } c f ah r g e rf # Portscan detection. For more information, see README.sfportscan o m : h # preprocessor sfportscan: proto { all } memcap { 10000000 } sense_level { low } t t p /: # ARP spoof detection. For more information, see the Snort Manual - Configuring / d Snort - Preprocessors - ARP Spoof Preprocessor o o.i gr # preprocessor arpspoof / 1 0 6. # preprocessor arpspoof_detect_host: 192.168.40.1 f0:0f:00:f0:0f:00 0 2 8 / N SI S.T # SSH anomaly detection. For more information, see README.ssh preprocessor ssh: 1.P server_ports { 22 } \ 8 0 0 autodetect \ max_client_bytes 19600 \ -5 . max_encrypted_packets 20 \ max_server_version_len 100 \ enable_respoverflow enable_ssh1crc32 \ enable_srvoverflow enable_protomismatch # SMB / DCE-RPC normalization and anomaly detection. For more information, see README.dcerpc2 preprocessor dcerpc2: memcap 102400, events [co ] preprocessor dcerpc2_server: default, policy WinXP, \ detect [smb [139,445], tcp 135, udp 135, rpc-over-http-server 593], \ autodetect [tcp 1025:, udp 1025:, rpc-over-http-server 1025:], \ smb_max_chain 3, smb_invalid_shares ["C$", "D$", "ADMIN$"] # DNS anomaly detection. For more information, see README.dns preprocessor dns: ports { 53 } enable_rdata_overflow NIST SP 1800-5C: IT Asset Management 111# SSL anomaly detection and traffic bypass. For more information, see README.ssl preprocessor ssl: ports { 443 465 563 636 989 992 993 994 995 7801 7802 T h 7900 7901 7902 7903 7904 7905 7906 7907 7908 7909 7910 7911 7912 7913 si p u 7914 7915 7916 7917 7918 7919 7920 }, trustservers, noinspect_encrypted b cil ta oi n si # SDF sensitive data preprocessor. For more information see README.sensitive_data a v a ali preprocessor sensitive_data: alert_threshold 25 b el rf e e o # SIP Session Initiation Protocol preprocessor. For more information see README.sip c f h a preprocessor sip: max_sessions 40000, \ ports { 5060 5061 5600 }, \ r g e rf methods { invite \ o m : h cancel \ ack \ t t p /: bye \ register \ options \ refer \ / d o o.i subscribe \ update \ join \ r g / 1 info \ message \ notify \ benotify \ do \ 0 6. 0 2 qauth \ sprack \ publish \ service \ unsubscribe \ prack }, \ 8 / N SI max_uri_len 512, \ T S. P max_call_id_len 80, \ 1. 8 0 0 max_requestName_len 20, \ -5 . max_from_len 256, \ max_to_len 256, \ max_via_len 1024, \ max_contact_len 512, \ max_content_len 2048 # IMAP preprocessor. For more information see README.imap preprocessor imap: \ ports { 143 } \ b64_decode_depth 0 \ qp_decode_depth 0 \ bitenc_decode_depth 0 \ uu_decode_depth 0 NIST SP 1800-5C: IT Asset Management 112# POP preprocessor. For more information see README.pop preprocessor pop: \ T h ports { 110 } \ b64_decode_depth 0 \ si p u qp_decode_depth 0 \ b cil ta bitenc_decode_depth 0 \ oi n si uu_decode_depth 0 a v a ali b el rf # Modbus preprocessor. For more information see README.modbus preprocessor modbus: ee ports { 502 } o c f # DNP3 preprocessor. For more information see README.dnp3 preprocessor dnp3: ports { h ra 20000 } \ g e orf memcap 262144 \ m : h check_crc t t p //: d o o.i # r g / 1 0 # Note to Debian users: this is disabled since it is an experimental 6. 0 82 # preprocessor. If you want to use it you have to create the rules files / N SI # referenced below in the /etc/snort/rules directory T S. P 1. # 8 0 0 -5 # Reputation preprocessor. For more information see README.reputation . #preprocessor reputation: \ # memcap 500, \ # priority whitelist, \ # nested_ip inner, \ # whitelist $WHITE_LIST_PATH/white_list.rules, \ # blacklist $BLACK_LIST_PATH/black_list.rules ################################################### # Step #6: Configure output plugins # For more information, see Snort Manual, Configuring Snort - Output Modules ################################################### NIST SP 1800-5C: IT Asset Management 113# unified2 T h # Recommended for most installs si p u # output unified2: filename merged.log, limit 128, nostamp, mpls_event_types, b cil vlan_event_types a t oi n #output unified2: filename snort.log, limit 128, nostamp, mpls_event_types, a si vlan_event_types v a ali output unified2: filename /var/log/snort/snort.log, limit 128, mpls_event_types, b el vlan_event_types rf e e o c f h # Additional configuration for specific types of installs a r g rf e # output alert_unified2: filename snort.alert, limit 128, nostamp o m # output log_unified2: filename snort.log, limit 128, nostamp : h t t p /: / d o # syslog o.i r /g # output alert_syslog: LOG_AUTH LOG_ALERT 1 0 06. 2 8 / N # pcap SI T S. # output log_tcpdump: tcpdump.log P 1. 8 0 0 -5 . # metadata reference data. do not modify these lines include classification.config include reference.config ################################################### # Step #7: Customize your rule set # For more information, see Snort Manual, Writing Snort Rules # # NOTE: All categories are enabled in this conf file ################################################### # Note to Debian users: The rules preinstalled in the system # can be *very* out of date. For more information please read NIST SP 1800-5C: IT Asset Management 114# the /usr/share/doc/snort-rules-default/README.Debian file T h # si p u # If you install the official VRT Sourcefire rules please review this b cil ta # configuration file and re-enable (remove the comment in the first line) those oi n si # rules files that are available in your system (in the a v a ali /etc/snort/rules b el rf # directory) e e o c f h a # site specific rules r g e rf include $RULE_PATH/local.rules o m : h t t p /: #include $RULE_PATH/app-detect.rules include $RULE_PATH/attack-responses.rules include / od $RULE_PATH/backdoor.rules o.i gr include $RULE_PATH/bad-traffic.rules / 1 0 6. #include $RULE_PATH/blacklist.rules 0 2 8 / #include $RULE_PATH/botnet-cnc.rules N SI T S. #include $RULE_PATH/browser-chrome.rules P 1. 8 #include $RULE_PATH/browser-firefox.rules 0 0 -5 . #include $RULE_PATH/browser-ie.rules #include $RULE_PATH/browser-other.rules #include $RULE_PATH/browser-plugins.rules #include $RULE_PATH/browser-webkit.rules include $RULE_PATH/chat.rules #include $RULE_PATH/content-replace.rules include $RULE_PATH/ddos.rules include $RULE_PATH/dns.rules include $RULE_PATH/dos.rules include $RULE_PATH/experimental.rules #include $RULE_PATH/exploit-kit.rules include $RULE_PATH/exploit.rules #include $RULE_PATH/file-executable.rules #include $RULE_PATH/file-flash.rules #include $RULE_PATH/file-identify.rules #include $RULE_PATH/file-image.rules NIST SP 1800-5C: IT Asset Management 115#include $RULE_PATH/file-java.rules #include $RULE_PATH/file-multimedia.rules T h #include $RULE_PATH/file-office.rules si p u #include $RULE_PATH/file-other.rules b cil ta #include $RULE_PATH/file-pdf.rules include $RULE_PATH/finger.rules include oi n $RULE_PATH/ftp.rules include $RULE_PATH/icmp-info.rules include $RULE_PATH/icmp.rules a si include $RULE_PATH/imap.rules v a ali #include $RULE_PATH/indicator-compromise.rules b el rf #include $RULE_PATH/indicator-obfuscation.rules e e c fo #include $RULE_PATH/indicator-scan.rules h ra #include $RULE_PATH/indicator-shellcode.rules include $RULE_PATH/info.rules g e orf #include $RULE_PATH/malware-backdoor.rules m : h #include $RULE_PATH/malware-cnc.rules t t p //: #include $RULE_PATH/malware-other.rules d o o.i #include $RULE_PATH/malware-tools.rules include $RULE_PATH/misc.rules r g / 1 0 include $RULE_PATH/multimedia.rules include $RULE_PATH/mysql.rules include 06. $RULE_PATH/netbios.rules include $RULE_PATH/nntp.rules include $RULE_PATH/oracle.rules 2 8 / N #include $RULE_PATH/os-linux.rules SI T S. #include $RULE_PATH/os-mobile.rules P 1. 8 0 #include $RULE_PATH/os-other.rules 0 -5 . #include $RULE_PATH/os-solaris.rules #include $RULE_PATH/os-windows.rules include $RULE_PATH/other-ids.rules include $RULE_PATH/p2p.rules #include $RULE_PATH/phishing-spam.rules #include $RULE_PATH/policy-multimedia.rules #include $RULE_PATH/policy-other.rules include $RULE_PATH/policy.rules #include $RULE_PATH/policy-social.rules #include $RULE_PATH/policy-spam.rules include $RULE_PATH/pop2.rules include $RULE_PATH/pop3.rules #include $RULE_PATH/protocol-dns.rules #include $RULE_PATH/protocol-finger.rules #include $RULE_PATH/protocol-ftp.rules NIST SP 1800-5C: IT Asset Management 116#include $RULE_PATH/protocol-icmp.rules #include $RULE_PATH/protocol-imap.rules T h #include $RULE_PATH/protocol-nntp.rules si p u #include $RULE_PATH/protocol-pop.rules b cil ta #include $RULE_PATH/protocol-rpc.rules oi n si #include $RULE_PATH/protocol-scada.rules a v a ali #include $RULE_PATH/protocol-services.rules b el rf #include $RULE_PATH/protocol-snmp.rules e e o #include $RULE_PATH/protocol-telnet.rules c f h a #include $RULE_PATH/protocol-tftp.rules r g e rf #include $RULE_PATH/protocol-voip.rules o m : h #include $RULE_PATH/pua-adware.rules t t p /: #include $RULE_PATH/pua-other.rules / d o o.i #include $RULE_PATH/pua-p2p.rules r g / 1 #include $RULE_PATH/pua-toolbars.rules include $RULE_PATH/rpc.rules 0 6. 0 2 include $RULE_PATH/rservices.rules 8 / N SI #include $RULE_PATH/scada.rules include $RULE_PATH/scan.rules T S. P #include $RULE_PATH/server-apache.rules 1. 8 0 0 #include $RULE_PATH/server-iis.rules -5 . #include $RULE_PATH/server-mail.rules #include $RULE_PATH/server-mssql.rules #include $RULE_PATH/server-mysql.rules #include $RULE_PATH/server-oracle.rules #include $RULE_PATH/server-other.rules #include $RULE_PATH/server-samba.rules #include $RULE_PATH/server-webapp.rules # # Note: These rules are disable by default as they are # too coarse grained. Enabling them causes a large # performance impact NIST SP 1800-5C: IT Asset Management 117#include $RULE_PATH/shellcode.rules include $RULE_PATH/smtp.rules include $RULE_PATH/snmp.rules #include $RULE_PATH/specific-threats.rules T h si p #include $RULE_PATH/spyware-put.rules include $RULE_PATH/sql.rules u b cil include $RULE_PATH/telnet.rules include $RULE_PATH/tftp.rules include a oit $RULE_PATH/virus.rules n a si #include $RULE_PATH/voip.rules v a ali #include $RULE_PATH/web-activex.rules include $RULE_PATH/web-attacks.rules b el rf include $RULE_PATH/web-cgi.rules include $RULE_PATH/web-client.rules include e e $RULE_PATH/web-coldfusion.rules include $RULE_PATH/web-frontpage.rules include o c f $RULE_PATH/web-iis.rules include $RULE_PATH/web-misc.rules include $RULE_PATH/web- ah php.rules include $RULE_PATH/x11.rules r g e rf include $RULE_PATH/community-sql-injection.rules include $RULE_PATH/community-web- o m client.rules include $RULE_PATH/community-web-dos.rules include $RULE_PATH/community- : h web-iis.rules include $RULE_PATH/community-web-misc.rules include t pt $RULE_PATH/community-web-php.rules include $RULE_PATH/community-sql-injection.rules //: include $RULE_PATH/community-web-client.rules include $RULE_PATH/community-web- d o.io dos.rules include $RULE_PATH/community-web-iis.rules include $RULE_PATH/community-web- r misc.rules include $RULE_PATH/community-web-php.rules g / 1 6.0 ################################################### 0 2 8 # Step #8: Customize your preprocessor and decoder alerts / N SI T # For more information, see README.decoder_preproc_rules S. P 1. ################################################### 8 0 0 -5 . # decoder and preprocessor event rules # include $PREPROC_RULE_PATH/preprocessor.rules # include $PREPROC_RULE_PATH/decoder.rules # include $PREPROC_RULE_PATH/sensitive-data.rules ################################################### # Step #9: Customize your Shared Object Snort Rules # For more information, see http://vrt-blog.snort.org/2009/01/using-vrt-certified-shared-object-ru les.html ################################################### NIST SP 1800-5C: IT Asset Management 118# dynamic library rules # include $SO_RULE_PATH/bad-traffic.rules T h # include $SO_RULE_PATH/chat.rules si p u # include $SO_RULE_PATH/dos.rules b cil ta # include $SO_RULE_PATH/exploit.rules oi n si # include $SO_RULE_PATH/icmp.rules a v a ali # include $SO_RULE_PATH/imap.rules b el rf # include $SO_RULE_PATH/misc.rules e e o # include $SO_RULE_PATH/multimedia.rules c f h a # include $SO_RULE_PATH/netbios.rules r g e rf # include $SO_RULE_PATH/nntp.rules o m : h # include $SO_RULE_PATH/p2p.rules t t p /: # include $SO_RULE_PATH/smtp.rules / d o o.i # include $SO_RULE_PATH/snmp.rules r g / 1 # include $SO_RULE_PATH/specific-threats.rules 0 6. 0 2 # include $SO_RULE_PATH/web-activex.rules 8 / N SI # include $SO_RULE_PATH/web-client.rules T S. P # include $SO_RULE_PATH/web-iis.rules 1. 8 0 0 # include $SO_RULE_PATH/web-misc.rules -5 . # Event thresholding or suppression commands. See threshold.conf include threshold.conf /etc/snort/snort.debian.conf # snort.debian.config (Debian Snort configuration file) # # This file was generated by the post-installation script of the snort # package using values from the debconf database. # # It is used for options that are changed by Debian to leave NIST SP 1800-5C: IT Asset Management 119# the original configuration files untouched. # T h # This file is automatically updated on upgrades of the snort package si p u # *only* if it has not been modified since the last upgrade of that package. b cil ta # oi n si # If you have edited this file but would like it to be automatically updated a v a ali # again, run the following command as root: b el rf # dpkg-reconfigure snort e e o c f h a DEBIAN_SNORT_STARTUP="boot" DEBIAN_SNORT_HOME_NET="172.16.0.0/16" r g e DEBIAN_SNORT_OPTIONS="" DEBIAN_SNORT_INTERFACE="eth0" DEBIAN_SNORT_SEND_STATS="true" orf DEBIAN_SNORT_STATS_RCPT="root" DEBIAN_SNORT_STATS_THRESHOLD="1" m : h t t p /: / d /usr/local/etc/barnyard2.conf o o.i gr Also linked from /etc/snort/barnyard.conf. / 1 0 6. # 0 2 8 N/ # Barnyard2 example configuration file SI T S. # P 1. 8 # 0 0 -5 . # This file contains a sample barnyard2 configuration. # You can take the following steps to create your own custom configuration: # # 1) Configure the variable declarations # 2) Setup the input plugins # 3) Setup the output plugins # # # Step 1: configure the variable declarations # NIST SP 1800-5C: IT Asset Management 120# in order to keep from having a commandline that uses every letter in the # alphabet most configuration options are set here. T h si p u # use UTC for timestamps b cil ta # oi n si #config utc a v a ali b el rf # set the appropriate paths to the file(s) your Snort process is using. e e o # c f h a config reference_file: /etc/snort/etc/reference.config config classification_file: r g e /etc/snort/etc/classification.config config gen_file: /etc/snort/gen-msg.map rf o m config sid_file: /etc/snort/etc/sid-msg.map : h t pt /: / od # Configure signature suppression at the spooler level see doc/README.sig_suppress o.i gr # / 1 0 6. # 0 2 8 / #config sig_suppress: 1:10 N SI T S. P 1. 8 # Set the event cache size to defined max value before recycling of event occur. 0 0 -5 . # # #config event_cache_size: 4096 # define dedicated references similar to that of snort. # #config reference: mybugs http://www.mybugs.com/?s= # define explicit classifications similar to that of snort. # #config classification: shortname, short description, priority # set the directory for any output logging NIST SP 1800-5C: IT Asset Management 121# config logdir: /var/log/barnyard2 T h si p u # to ensure that any plugins requiring some level of uniqueness in their output b cil ta # the alert_with_interface_name, interface and hostname directives are provided. oi n si # An example of usage would be to configure them to the values of the associated a v a ali # snort process whose unified files you are reading. b el rf # e e o # Example: c f h a # For a snort process as follows: r g e rf # snort -i eth0 -c /etc/snort.conf o m : h # t t p /: # Typical options would be: / d o o.i # config hostname: thor r g / 1 # config interface: eth0 0 6. 0 2 # config alert_with_interface_name 8 / N SI # T S. P config hostname: snort config interface: eth0 1. 8 0 0 # enable printing of the interface name when alerting. -5 . # #config alert_with_interface_name # at times snort will alert on a packet within a stream and dump that stream to # the unified output. barnyard2 can generate output on each packet of that # stream or the first packet only. # #config alert_on_each_packet_in_stream # enable daemon mode # NIST SP 1800-5C: IT Asset Management 122config daemon T h # make barnyard2 process chroot to directory after initialisation. si p u # b cil ta #config chroot: /var/spool/barnyard2 oi n si a v a ali # specifiy the group or GID for barnyard2 to run as after initialisation. b el rf # e e o #config set_gid: 999 c f h a r g e rf # specifiy the user or UID for barnyard2 to run as after initialisation. o m : h # t t p /: #config set_uid: 999 / d o o.i r g / 1 # specify the directory for the barnyard2 PID file. 0 6. 0 2 # 8 / N SI #config pidpath: /var/run/by2.pid T S. P 1. 8 0 0 # enable decoding of the data link (or second level headers). -5 . # #config decode_data_link # dump the application data # #config dump_payload # dump the application data as chars only # #config dump_chars_only NIST SP 1800-5C: IT Asset Management 123# enable verbose dumping of payload information in log style output plugins. # T h #config dump_payload_verbose si p u b cil ta # enable obfuscation of logged IP addresses. oi n si # a v a ali #config obfuscate b el rf e e o # enable the year being shown in timestamps c f h a # r g e rf config show_year o m : h t t p /: # set the umask for all files created by the barnyard2 process (eg. log files). / d o o.i # r g / 1 #config umask: 066 0 6. 0 2 8 / N SI # enable verbose logging T S. P # 1. 8 0 0 #config verbose -5 . # quiet down some of the output # #config quiet # define the full waldo filepath. # config waldo_file: /tmp/waldo # specificy the maximum length of the MPLS label chain # NIST SP 1800-5C: IT Asset Management 124#config max_mpls_labelchain_len: 64 T h # specify the protocol (ie ipv4, ipv6, ethernet) that is encapsulated by MPLS. si p u # b cil ta #config mpls_payload_type: ipv4 oi n si a v a ali # set the reference network or homenet which is predominantly used by the b el rf # log_ascii plugin. e e o # c f h a #config reference_net: 192.168.0.0/24 r g e rf o m : h # t t p /: # CONTINOUS MODE / d o o.i # r g / 1 0 6. 0 2 # set the archive directory for use with continous mode 8 / N SI # T S. P #config archivedir: /tmp 1. 8 0 0 -5 . # when in operating in continous mode, only process new records and ignore any # existing unified files # #config process_new_records_only # # Step 2: setup the input plugins # # this is not hard, only unified2 is supported ;) input unified2 NIST SP 1800-5C: IT Asset Management 125# T h # Step 3: setup the output plugins# si p u b cil ta # alert_cef oi n si # a v a ali ---------------------------------------------------------------------- b el rf # e e o # Purpose: c f h a # This output module provides the abilty to output alert information to a r g e rf # remote network host as well as the local host using the open standard o m : h # Common Event Format (CEF). t t p /: # / d o o.i # Arguments: host=hostname[:port], severity facility r g / 1 # arguments should be comma delimited. 0 6. 0 2 # host - specify a remote hostname or IP with optional port number 8 / N SI # this is only specific to WIN32 (and is not yet fully supported) T S. P # severity - as defined in RFC 3164 (eg. LOG_WARN, LOG_INFO) 1. 8 0 0 # facility - as defined in RFC 3164 (eg. LOG_AUTH, LOG_LOCAL0) -5 . # # Examples: # output alert_cef # output alert_cef: host=192.168.10.1 # output alert_cef: host=sysserver.com:1001 # output alert_cef: LOG_AUTH LOG_INFO # # alert_bro # ---------------------------------------------------------------------- NIST SP 1800-5C: IT Asset Management 126# # Purpose: Send alerts to a Bro-IDS instance. T h # si p u # Arguments: hostname:port b cil ta # oi n si # Examples: a v a ali # output alert_bro: 127.0.0.1:47757 b el rf e e o # alert_fast c f h a # r g e rf ---------------------------------------------------------------------- o m : h # Purpose: Converts data to an approximation of Snort's "fast alert" mode. t t p /: # / d o o.i # Arguments: file <file>, stdout r g / 1 # arguments should be comma delimited. 0 6. 0 2 # file - specifiy alert file 8 / N SI # stdout - no alert file, just print to screen T S. P # 1. 8 0 0 # Examples: -5 . # output alert_fast # output alert_fast: stdout # #output alert_fast: stdout output alert_fast: /var/log/snort/alert # prelude: log to the Prelude Hybrid IDS system # ---------------------------------------------------------------------- # # Purpose: NIST SP 1800-5C: IT Asset Management 127# This output module provides logging to the Prelude Hybrid IDS system # T h # Arguments: profile=snort-profile si p u # snort-profile - name of the Prelude profile to use (default is snort). b cil ta # oi n si # Snort priority to IDMEF severity mappings: a v a ali # high < medium < low < info b el rf # e e o # These are the default mapped from classification.config: c f h a # info = 4 r g e rf # low = 3 o m : h # medium = 2 t t p /: # high = anything below medium / d o o.i # r g / 1 # Examples: 0 6. 0 2 # output alert_prelude 8 / N SI # output alert_prelude: profile=snort-profile-name T S. P # 1. 8 0 0 -5 . # alert_syslog # ---------------------------------------------------------------------- # # Purpose: # This output module provides the abilty to output alert information to local syslog # # severity - as defined in RFC 3164 (eg. LOG_WARN, LOG_INFO) # facility - as defined in RFC 3164 (eg. LOG_AUTH, LOG_LOCAL0) # # Examples: NIST SP 1800-5C: IT Asset Management 128# output alert_syslog # output alert_syslog: LOG_AUTH LOG_INFO T h # si p u output alert_syslog: LOG_AUTH LOG_INFO b cil ta oi n si # syslog_full a v a ali #------------------------------- b el rf # Available as both a log and alert output plugin. Used to output data via TCP/UDP or ee LOCAL ie(syslog()) o c f # Arguments: h a r g e # sensor_name $sensor_name - unique sensor name rf o m # server $server - server the device will report to : h t pt # local - if defined, ignore all remote information and use syslog() to send //: message. d o o.i # protocol $protocol - protocol device will report over (tcp/udp) r g / 1 0 # port $port - destination port device will report to (default: 514) 6. 0 82 # delimiters $delimiters - define a character that will delimit message / N sections ex: "|", will use | as message section delimiters. (default: |) SI T S. # separators $separators - define field separator included in each message ex: P 1. " " , will use space as field separator. (default: [:space:]) 8 0 0 -5 # operation_mode $operaion_mode - default | complete : default mode is . compatible with default snort syslog message, complete prints more information such as the raw packet (hexed) # log_priority $log_priority - used by local option for syslog priority call. (man syslog(3) for supported options) (default: LOG_INFO) # log_facility $log_facility - used by local option for syslog facility call. (man syslog(3) for supported options) (default: LOG_USER) # payload_encoding - (default: hex) support hex/ascii/base64 for log_syslog_full using operation_mode complete only. # Usage Examples: # output alert_syslog_full: sensor_name snortIds1-eth2, server xxx.xxx.xxx.xxx, protocol udp, port 514, operation_mode default # output alert_syslog_full: sensor_name snortIds1-eth2, server xxx.xxx.xxx.xxx, protocol udp, port 514, operation_mode complete NIST SP 1800-5C: IT Asset Management 129# output log_syslog_full: sensor_name snortIds1-eth2, server xxx.xxx.xxx.xxx, protocol udp, port 514, operation_mode default # output log_syslog_full: sensor_name snortIds1-eth2, server xxx.xxx.xxx.xxx, protocol T sih udp, port 514, operation_mode complete p u b # output alert_syslog_full: sensor_name snortIds1-eth2, server xxx.xxx.xxx.xxx, acil protocol udp, port 514 t oi si n # output log_syslog_full: sensor_name snortIds1-eth2, server xxx.xxx.xxx.xxx, protocol a udp, port 514 v a bali # output alert_syslog_full: sensor_name snortIds1-eth2, local el rf # output log_syslog_full: sensor_name snortIds1-eth2, local, log_priority e e o LOG_CRIT,log_facility LOG_CRON c f ah r g e rf # log_ascii o m : h # t t p /: ---------------------------------------------------------------------- / d o o.i # r g 1/ # Purpose: This output module provides the default packet logging funtionality 0 6. 0 # 2 8 / SIN # Arguments: None. T S. P # 1. 8 00 # Examples: -5 . # output log_ascii # output log_ascii # log_tcpdump # ---------------------------------------------------------------------- # # Purpose # This output module logs packets in binary tcpdump format # NIST SP 1800-5C: IT Asset Management 130# Arguments: # The only argument is the output file name. T h # si p u # Examples: b cil ta # output log_tcpdump: tcpdump.log oi n si # a v a ali output log_tcpdump: /var/log/snort/tcpdump.log b el rf # sguil e e o # c f h a ---------------------------------------------------------------------- r g e rf # o m : h # Purpose: This output module provides logging ability for the sguil interface t t p /: # See doc/README.sguil / d o o.i # r g / 1 # Arguments: agent_port <port>, sensor_name <name> 0 6. 0 2 # arguments should be comma delimited. 8 / N SI # agent_port - explicitly set the sguil agent listening port T S. P # (default: 7736) 1. 8 0 0 # sensor_name - explicitly set the sensor name -5 . # (default: machine hostname) # # Examples: # output sguil # output sguil: agent_port=7000 # output sguil: sensor_name=argyle # output sguil: agent_port=7000, sensor_name=argyle # # database: log to a variety of databases # NIST SP 1800-5C: IT Asset Management 131---------------------------------------------------------------------- # T h # Purpose: This output module provides logging ability to a variety of databases si p u # See doc/README.database for additional information. b cil ta # oi n si # Examples: a v a ali # output database: log, mysql, user=root password=test dbname=db host=localhost b el rf # output database: alert, postgresql, user=snort dbname=snort e e o # output database: log, odbc, user=snort dbname=snort c f h a # output database: log, mssql, dbname=snort user=snort password=test r g e rf # output database: log, oracle, dbname=snort user=snort password=test o m : h # t t p /: #output database: log, mysql, user=root password=1Password! dbname=snortdb / d o o.i r g / 1 # alert_fwsam: allow blocking of IP's through remote services 0 6. 0 2 # 8 / N SI ---------------------------------------------------------------------- T S. P # output alert_fwsam: <SnortSam Station>:<port>/<key> 1. 8 0 0 # -5 . # <FW Mgmt Station>: IP address or host name of the host running SnortSam. # <port>: Port the remote SnortSam service listens on (default 898). # <key>: Key used for authentication (encryption really) # of the communication to the remote service. # # Examples: # # output alert_fwsam: snortsambox/idspassword # output alert_fwsam: fw1.domain.tld:898/mykey # output alert_fwsam: 192.168.0.1/borderfw 192.168.1.254/wanfw # NIST SP 1800-5C: IT Asset Management 132/opt/splunkforwarder/etc/system/local/server.conf T h si [sslConfig] p u b sslKeysfilePassword = $1$A0zU/599eO4g cil a t oi n si a [lmpool:auto_generated_pool_forwarder] description = auto_generated_pool_forwarder v a quota = MAX ali b el slaves = * rf e o e stack_id = forwarder c f ah r g e rf [lmpool:auto_generated_pool_free] description = auto_generated_pool_free quota = MAX o m : h slaves = * stack_id = free t t /:p [general] / d o o.i pass4SymmKey = $1$VACAo9o7M7wg serverName = snort r g 1/ 0 6. 0 2 /opt/splunkforwarder/etc/system/local/inputs.conf 8 / N TSI Note: The sourcetype=snort_alert_full is important if you are using the Splunk TA_Snort app. S. P 1. [default] host=snort 8 0 0 -5 sourcetype=snort_alert_full index=snort . [monitor:///var/log/snort/alert] sourcetype=snort_alert_full /opt/splunkforwarder/etc/system/local/outputs.conf [tcpout] defaultGroup = splunkssl [tcpout:splunkssl] server = loghost:9997 compressed = true sslVerifyServerCert = false sslRootCAPath = $SPLUNK_HOME/etc/certs/CAServerCert.pem sslCertPath = $SPLUNK_HOME/etc/certs/snort.lab5.nccoe.gov.pem sslPassword = $1$cw== NIST SP 1800-5C: IT Asset Management 1333.9 Tyco Security Products Tyco Security Products are used to integrate personnel access management into the FS ITAM build. The T sih CCURE 9000 security and event management system allows integration with a variety of intrusion p u devices, allowing admins to monitor and perform intrusion detection within facilities to stop incidents of b cil malicious activity or violation of policy. For the ITAM build, the focal point of the CCURE 9000 product is a t oi personnel and visitor management. The iSTAR Edge Door Controller provides features to secure any n a si door, including clustering, door monitoring, and anti-passback. v a ali elb 3.9.1 Installing Tyco Security Products rf e o e Tyco Security Products hardware is received with pre-installed software. Hardware components c f received for this build include the following: h a r g rf e ▪ host laptop o m : h ▪ iSTAR Edge Door Controller t t /:p ▪ two badge readers / d o.io ▪ three badges r g 1/ ▪ American Dynamics Video Edge Network Video Recorder (NVR) 0 6. 0 ▪ one camera 2 8 / SIN ▪ NETGEAR ProSAFE switch T PS. ▪ Ethernet cables 1. 8 00 Directions for connecting components will be included in the packaging on the iSTAR Edge Installation -5 . Reference disc. The host laptop will have the iSTAR Configuration Utility, CCURE 9000, License Manager, KeyCodeGenerator, and Victor Management Software installed and pre-configured. The iSTAR Configuration Utility can be used to confirm IP addresses. 3.9.2 Configurations All components included with Tyco Security Products will be pre-configured. Configuration manuals are documented at the Tyco Security Products website as well as on the iSTAR Edge Installation Reference disc. In addition, the security product suite will be accompanied by a list of all static IP addresses to confirm or correct any configurations. Static IP addresses for the ITAM build are as follows: ▪ laptop (host): 192.168.1.167 ▪ NVR: 192.168.1.178 ▪ camera: 192.168.1.177 ▪ iSTAR: 192.168.1.169 NIST SP 1800-5C: IT Asset Management 134The three badges received are configured for the ITAM build. Two badges contain access rights, with a clearance, while one badge does not. Two door readers are configured as door controllers for one door. One reader is configured as the IN reader while the second is configured as the OUT reader. Badges T h si must have a clearance to be admitted into the door. p u b cil Configurations for badges, doors and readers can be viewed and managed using CCURE 9000 software a t oi shown in Figure 3-1. n si a v Figure 3-1 CCURE 9000 Overview a ali b el rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 82 / N TSI The host machine should then be connected to the ITAM network to integrate with the ITAM build. To S. P prepare the host machine for integration with ITAM, SQL Server Management Studio must be installed. 1. 8 0 For the ITAM build, a query to the journal table is called by Splunk Enterprise to retrieve information, 0 -5 . including the Cardholder Name, Door Name, Journal Log Message Type, Message Text and Message Date/Time. The information produced from CCURE is shown in Figure 3-2. Figure 3-2 CCURE 9000 Messages NIST SP 1800-5C: IT Asset Management 135The query ran for Splunk Enterprise to retrieve the information from the journal is as follows: SELECT MessageType, MessageUTC, REPLACE(PrimaryObjectName,',',' ') AS T PrimaryObjectName, XmlMessage h si p FROM JournalLog WHERE MessageType='CardAdmitted' OR MessageType='CardRejected' u b cil a oit 3.10 Windows Server Update Services (WSUS) n si a WSUS is integrated into Windows Server 2012 as a server role. WSUS enables IT administrators to v a ali deploy the latest Microsoft product updates to computers that are running the Windows operating b el system. Using WSUS, an administrator can fully manage the distribution of updates that are released rf e e through Microsoft Update to computers in their network. o c f h a 3.10.1 How It’s Used r g e orf The ITAM system is using WSUS for its reporting features. WSUS reports on the volume and status of m : h software updates from Microsoft Update. ITAM uses this information to provide insight to t t p administrators for analysis of which Windows machines in the network are not in compliance with the /: / od latest vulnerability patches and software updates. o.i r g 1/ 3.10.2 Virtual Machine Configuration 0 6. 0 2 The WSUS virtual machine is configured with one network interface card, 8 GB of RAM, one CPU core 8 / N SI and 100 GB of hard drive space. The 100 GB of hard drive space is very important for this machine. T S. P 1. 3.10.3 Network Configuration 8 0 0 -5 . The management network interface card is configured as follows: ▪ IPv4 Manual ▪ IPv6 Disabled ▪ IP Address: 172.16.0.45 ▪ Netmask: 255.255.255.0 ▪ Gateway: 172.16.0.11 ▪ DNS Servers: 172.16.1.20, 172.16.1.21 ▪ Search Domains: lab5.nccoe.gov NIST SP 1800-5C: IT Asset Management 1363.10.4 Installing WSUS WSUS is installed through the add roles and features wizard in Server Manager. Documentation is T h provided by Microsoft at: https://technet.microsoft.com/en-us/windowsserver/bb332157.aspx. WSUS si up should NOT be a member of your domain. b cil a t oi 3.10.5 Configurations n si va You configure WSUS using the WSUS Server Configuration Wizard. When the wizard prompts you, set a ali these options as follows: b el erf ▪ Update Source and Proxy Server – Synchronize form Microsoft Update e o c f ▪ Products and Classifications – Microsoft SQL Server 2012, Microsoft SQL Server 2014, SQL h ra Server 2008 R2, SQL Server 2008, SQL Server 2012 Product Updates for Setup, SQL server g e rf Feature Pack, Windows 7, Windows Server 2012 R2 and later drivers, Windows Server 2012 R2 o m : h ▪ Update Files and Languages – Store update files locally on this server < Download update files t pt to this server only when updates are approved, Download updates only in English /: / od ▪ Synchronization Schedule – Automatically > 1 per day o.i r g ▪ Automatic Approvals – Default / 1 0 6. ▪ Computers – Use the Update Services console 0 2 8 N/ ▪ Reporting Rollup – N/A SI T S. ▪ E-mail Notifications – N/A P 1. 08 ▪ Personalization – N/A 0 -5 . 3.10.6 Configure Active Directory Server to Require WSUS Clients are configured to get their Windows updates and patches through Group Policy on the Active Directory server. Full documentation can be found at: https://technet.microsoft.com/en- us/library/Cc720539%28v=WS.10%29.aspx. 1. On the Active Directory Server: Administrative Tools > Group Policy Management 2. Under your domain, create a new group policy object by right-clicking and selecting Create a GPO in this domain, and link it here. 3. Then right-click the newly created GPO in the Group Policy Objects area of the Group Policy Man- agement window and select Edit. NIST SP 1800-5C: IT Asset Management 1374. In the Group Policy Management Editor expand Computer Configuration, expand Administra- tive Templates, expand Windows Components, and then click Windows Update. T h 5. In the details pane, select Specify intranet Microsoft update service location. si p u b 6. Click ENABLED and enter the URL of the WSUS server and statistics server (they are the same for cil ta this build): http://wsus.lab5.nccoe.gov:8530. oi n si a 3.10.7 Create WSUS Statistics for Splunk Enterprise v a ali elb When WSUS is running and downloading updates (you can check this by running a report), you can work erf with assemblies using Windows PowerShell to connect to the WSUS server. With this connection, e o PowerShell script can be written to extract information from WSUS. The script creates two .CSV files c f ah with WSUS information that are forwarded to Splunk Enterprise. The script to accomplish this task is as r g e follows: rf o m : h 1. Filename: WSUSReport.ps1 t t p /: $wsus / d o o.i $wsusserver = 'wsus' r g / 1 2. Load required assemblies: 0 6. 0 2 [reflection.assembly]::LoadWithPartialName("Microsoft.UpdateServices.A 8 N/ dministration")| Out-Null SI T S. $wsus = [Microsoft.UpdateServices.Administration.AdminProxy]::getUpdateServer( P 1. 'wsus',$False,8530) 8 0 0 -5 3. Create update scope object: . $updatescope = New-Object Microsoft.UpdateServices.Administration.UpdateScope $updatescope.IncludedInstallationStates = [Microsoft.UpdateServices.Administration.UpdateInstallationStates]::No tInstalled $updatescope.FromArrivalDate = [datetime]"12/13/2011" $computerscope = New-Object Microsoft.UpdateServices.Administration.ComputerTargetScope $wsus.GetSummariesPerComputerTarget($updatescope,$computerscope) | Select @{L='ComputerTarget';E={($wsus.GetComputerTarget([guid]$_.ComputerTarg etId)).FullDomainName}}, @{L='NeededCount';E={($_.DownloadedCount+$_.NotInstalledCount)}},Downl oadedCount,NotInstalledCount,InstalledCount,FailedCount | Export-Csv c:\ReportCount.csv NIST SP 1800-5C: IT Asset Management 138$wsus.GetUpdateApprovals($updatescope) | Select @{L='ComputerTargetGroup';E={$_.GetComputerTargetGroup().Name}}, T h @{L='UpdateTitle';E={($wsus.GetUpdate([guid]$_.UpdateId.UpdateId.Guid) si p u ).Title}}, GoLiveTime,AdministratorName,Deadline | Export-Csv c:\UpdateStat.csv b cil a oit This script creates two .CSV files and places them on the C drive: ReportCount.csv and UpdateStat.csv. n si These two files contain the fields ComputerTarget, NeededCount, DownloadedCount, a v NotInstalledCount, InstalledCount, FailedCount; and ComputerTargetGroup, UpdateTitle, GoLiveTime, a bali AdministratorName and Deadline, respectively. el rf ee When the script is running error free, a task is scheduled for the script to run daily for updates to the o c f data. To create a scheduled task, complete the following steps: h a r eg 1. Open Task Scheduler and select Create Task. rf o m 2. Name the task and give it a description. Select Run whether user is logged on or not. Select Run : h tt with highest privileges. Configure for: Windows Server 2012 R2. p /: / d o 3. Select the Triggers tab and select New. Create a trigger to run every day at the desired time. o.i r g 1/ 4. Select the Actions tab and select New. Under Action, select Start a Program. In the Pro- 0 6. gram/script box, enter c:\Windows\System32\WindowsPowershell\v1.0\powershell.exe or 0 2 8 browse for the PowerShell executable. / N SI S.T 5. In the arguments box insert -ExecutionPolicy Bypass <locationofscript>. Select OK to save the P 1. task. 8 0 0 -5 6. Use the defaults for the remaining settings. The scheduled task should look similar to the task . highlighted in the following figure. NIST SP 1800-5C: IT Asset Management 139T h si p u b cil a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 6.0 3.10.8 Installing Splunk Universal Forwarder 0 2 8 / Note: You will need a Splunk account to download the Splunk Universal Forwarder. It is free and can be N TSI set up at: https://www.splunk.com/page/sign_up. S. P 81. 1. Download the Splunk Universal Forwarder from: http://www.splunk.com/en_us/download/uni- 0 0 -5 versal-forwarder.html. . 2. You want the latest version for OS version Windows (64-bit). Since this is installing on Win- dows, select the file that ends in .msi. An example is: splunkforwader-6.2.5-272645-x64-release.msi Detailed installation instructions can be found at: http://docs.splunk.com/Documentation/Splunk/6.2.3/Forwarding/DeployaWindowsdfmanually #Install_the_universal_forwarder. 3.10.9 Configuring Splunk Universal Forwarder Configuring Splunk Universal Forwarder as shown in the FS-ITAM use case requires X.509 Certificates for the Splunk Enterprise server/indexer and each Splunk Universal Forwarder. You will also need a copy of your certificate authority’s public certificate. NIST SP 1800-5C: IT Asset Management 140If you entered your certificates during install time, they will be located at: C:\Program Files\SplunkUniversalForwarder\etc\auth T h p si If not, you will need to manually copy your certificates here. u b cil 1. Copy Splunk Universal Forwarder configuration files: a t oi si n copy <server.conf> C:\Program Files\SplunkUniversalForwarder\etc\system\local a av copy <inputs.conf> C:\Program Files\SplunkUniversalForwarder\etc\system\local ali b el copy <outputs.conf> C:\Program Files\SplunkUniversalForwarder\etc\system\local rf e o e 2. Modify server.conf so that: c f h a ServerName=WSUS is your hostname. r g e rf sslKeysfilePassword = <password for your private key> o m : h 3. Modify outputs.conf so that: t t p /: / d Server = loghost:9997 is your correct Splunk Enterprise server/indexer and port. o o.i gr sslPassword = <password of your certificate private key> / 1 0 6. Note: This will be hashed and not clear text after a restart. 0 2 8 / N Inputs.conf should work, but you are free to modify it to include the Windows logs that you are SI S.T interested in. P 1. 8 00 3.10.10 Configurations and Scripts -5 . C:\Program Files\SplunkUniversalForwarder\etc\system\local server.conf [sslConfig] sslKeysfilePassword = $1$sznWu23zCGHY [general] pass4SymmKey = $1$5HWC5yi1QzPY serverName = WSUS [lmpool:auto_generated_pool_forwarder] description = auto_generated_pool_forwarder quota = MAX slaves = * stack_id = forwarder NIST SP 1800-5C: IT Asset Management 141[lmpool:auto_generated_pool_free] description = auto_generated_pool_free quota = MAX T h slaves = * stack_id = free si p u b cil a oit C:\Program Files\SplunkUniversalForwarder\etc\system\local\inputs.conf n si a [default] host = WSUS v a ali sourcetype = wsus b el rf index = wsus e e o c f h a gr [script://$SPLUNK_HOME\bin\scripts\splunk-wmi.path] disabled = 0 e orf [monitor:///C:\ReportCount.csv] sourcetype=wsus_reportcount m : th crcSalt is needed because this file doesn't change much and is small crcSalt = t /:p <SOURCE> / d o.io ignoreOlderThan = 2d disabled = 0 r g / [monitor:///C:\UpdateStat.csv ] sourcetype=wsus_updatestat ignoreOlderThan = 2d 1 0 6. 0 disabled = 0 2 8 / N SI T S. P C:\Program Files\SplunkUniversalForwarder\etc\system\local\outputs.conf 1. 8 0 0 [tcpout] -5 . defaultGroup = default-autolb-group [tcpout:default-autolb-group] server = loghost:9997 [tcpout-server://loghost:9997] sslCertPath = C:\wsus.lab5.nccoe.gov.pem sslPassword = $1$sznWu23zCGHY sslRootCAPath = C:\Users\DoD_Admin\Downloads\CAServerCert.pem 4 Tier 3 4.1 Active Directory Server The Active Directory server in the ITAM build uses an NCCoE base 2012 R2 x86_64 DoD STIG image. The installation of the Windows Active Directory server was performed using installation media provided by DISA. This image was chosen because it is standardized, hardened, and fully documented. NIST SP 1800-5C: IT Asset Management 1424.1.1 Software Configurations 4.1.1.1 Windows 2012 Active Directory Server T h si p Active Directory provides centralized management, authentication, security, and information storage for u b cil end devices and users in a networked environment. a t oi n si 4.1.2 How It’s Used a v a ali The Active Directory service is used in the ITAM build to provide authentication, user management and b el security within a mixed environment with Windows and Linux endpoints. rf e e c fo 4.1.3 Installation h a r g 1. Go to Server Manager and click Add Roles and Features Wizard. e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5C: IT Asset Management 1432. Click Next and select Role-based or feature-based installation. Then, click Next. T h si p u b cil a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h t pt /: / od 3. Ensure that the appropriate server name is selected. Then, click Next. o.i r g / 4. Click the checkbox next to Active Directory Domain Services. Then click Next to advance to the 1 0 6. next screen. Then, click Add Features. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . 5. Use the features selected by default. Then, click Next. 6. In the Active Directory Domain Services screen, click Next. NIST SP 1800-5C: IT Asset Management 1447. On the Confirm installations selections screen, click Install. T h si p u b cil a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h ptt 8. When you see the message that the installation was successful, click close. /: / d o 9. Return to the Server Manager and click on the yellow warning message. o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . 10. On the Post-deployment Configuration box, click Promote this server to a domain controller. 11. Choose Add a new forest, specify the root domain name and click Next. 12. Use the default settings in the Domain Controller Options page. Ensure that DNS server is se- lected. Enter the Directory Services Restore Mode password and click Next. 13. Choose a NetBIOS domain Name and click Next. NIST SP 1800-5C: IT Asset Management 14514. Accept the default locations for AD DS, DS Database, log files and SYSVOL. 15. In the Review Options screen, click Next. T h p si 16. Allow the system to complete the prerequisites check and click Install. u b cil 17. When the installation completes, reboot the system. a t oi n si 4.2 AssetCentral a v a bali AssetCentral is an IT infrastructure management system that stores and displays information related to el rf physical assets including location, make, model, and serial number. AssetCentral can help run an entire e o e data center by monitoring weight, utilization, available space, heat and power distribution. AssetCentral hc f is installed on a CentOS7 system. a r g e rf 4.2.1 How It’s Used o m : h In the FS ITAM build AssetCentral is used to provide physical asset location. AssetCentral provides the t t p /: building, room and rack of an asset. / d o o.i r 4.2.2 Virtual Machine Configuration g / 1 0 6. The virtual machine is configured with 1 network interface cards, 4 GB of RAM and 1 CPU cores. 0 2 8 / N SI 4.2.3 Network Configuration T S. P 1. The management network interface card is configured as such: 8 0 0 -5 ▪ IPv4 Manual . ▪ IPv6 Ignore/Disabled ▪ IP Address: 172.16.1.50 ▪ Netmask: 255.255.255.0 ▪ Gateway: 172.16.1.11 ▪ DNS Servers: 172.16.1.20, 172.16.1.21 ▪ Search Domains: lab5.nccoe.gov 4.2.4 Installing AssetCentral AssetCentral is installed on a hardened CentOS7 Linux system. AssetCentral requires PHP, Web Server (Apache) and MySQL database to be installed. NIST SP 1800-5C: IT Asset Management 146Table 4-1 Recommended Versions for AssetCentral – Tier 3 Vendor Product Version T h si RedHat Enterprise Linux Server Release 6.4 (Santiago) (x86_64) p u b cil Apache Web Server httpd-2.2.15-26.el6.x86_64 a t oi mysql Server 5.1.6.6 n si a php 5.3.3 or higher v a ali b el 4.2.5 Installing MySQL (MariaDB) rf e o e # yum -y install mariadb-server mariadb c f h #systemctl start mariadb.service a r g e rf #systemctl enable mariadb.service o m : h # mysql_secure_installation t t p /: 1. Answer the questions with the default answers while performing the mysql_secure_installation. / d o o.i 2. Create a database – assetcentral. r g / 1 0 3. Create a user – assetcentral. 6. 0 2 /8 4. Grant all privileges to assetcentral user. N SI T PS. 4.2.6 Installing Apache 1. 8 0 0 # yum -y install httpd -5 . #systemctl start httpd.service #systemctl enable httpd.service #firewall-cmd --permanent --zone=public --add-service=http #firewall-cmd --permanent --zone=public --add-service=https #firewall-cmd -reload 4.2.6.1 HTTP Configuration 1. Go to HTTPD root; normally (/etc/httpd). 2. Under the modules directory, make sure libphp5.so exists. 3. Change documentroot (webroot) as per environment in httpd.conf. NIST SP 1800-5C: IT Asset Management 1474.2.7 Installing PHP5 #yum -y install php T h si #systemctl restart httpd.service p u b #yum search php cil a oit #yum -y install php-mysql n a si #yum -y install php-gd php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php- v a snmp php-soap curl curl-devel ali b el 1. Restart Apache: rf e e o #systemctl restart httpd.service c f h a gr 4.2.8 Post Installation Tasks e rf o m 1. Copy AssetCentral files and folders from previous install to the new webroot. : h t pt 2. Under the location (../assetcentral/application/config) make necessary changes as per environ- /: / d ment. o o.i r /g 4.2.8.1 Sample 1 0 6. 0 <?php defined('ASSET_CENTRAL')ordie(''); define('AC_URL_SUBDIR','/acprod'); 2 8 define('AC_URL_SCRIPT','/index.php'); define('AC_URL_PARAM','go'); / N SI define('AC_URL_PREFIX',AC_URL_SUBDIR . AC_URL_SCRIPT.'?' T S. P . AC_URL_PARAM . '='); define('AC_ERROR_REPORTING',E_ERROR); 1. 8 00 //no slash at the end of this url define('URL_SITE','http://10.1.xx.xxx'); -5 . define('OS','NIX'); // *NIX WIN BSD MAC //default database (read) define('DB_TYPE_READ','MYSQL'); define('DB_HOST_READ','127.0.0.1'); //usually leave this blank for MYSQL define('DB_PORT_READ',''); define('DB_USER_READ','assetcentral'); define('DB_PASS_READ','xxxxx'); define('DB_DATA_READ','asset_prod'); define('DB_PREFIX_READ',''); 4.3 Email Email is the email server for the FS-ITAM build. 4.3.1 How It’s Used In the FS ITAM build, Email provides all users with email. NIST SP 1800-5C: IT Asset Management 1484.3.2 Virtual Machine Configuration The Email virtual machine is configured with one network interface card, 4 GB of RAM and one CPU T h core. si p u b cil 4.3.3 Network Configuration a t oi si n The management network interface card is configured as follows: a v alia ▪ IPv4 Manual b el ▪ IPv6 Ignore/Disabled rf e e o ▪ IP Address: 172.16.1.50 c f h a ▪ Netmask: 255.255.255.0 r g e rf ▪ Gateway: 172.16.1.11 o m : h ▪ DNS Servers: 172.16.1.20, 172.16.1.21 t t p /: ▪ Search Domains: lab5.nccoe.gov / d o o.i r 4.3.4 Installing Email g / 1 0 6. Email is installed on a hardened Ubuntu 14.04 Linux system. This email system is using the Postfix email 0 2 8 program. Complete installation instructions can be found at: / N SI https://help.ubuntu.com/community/Postfix#Installation. T S. P 1. For Debian/Ubuntu Linux systems: It is always best to make sure your system is up-to-date by 8 0 0 performing: -5 . sudo apt-get update sudo apt-get upgrade sudo apt-get install postfix 4.3.5 Configure Email From a terminal prompt: sudo dpkg-reconfigure postfix General type of mail configuration: Internet Site NONE doesn’t appear to be requested in current config. System mail name: mail1.lab5.nccoe.gov Root and postmaster mail recipient: <admin_user_name> NIST SP 1800-5C: IT Asset Management 149Other destinations for mail: email1, email1.lab5.nccoe.gov, localhost.lab5.nccoe.gov, localhost.localdomain, localhost, lab5.nccoe.gov T h Force synchronous updates on mail queue? No si p u cilb Local networks: 172.16.0.0/16 a t oi Yes doesn't appear to be requested in current config. n si a av Mailbox size limit (bytes): 0 ali b el Local address extension character: + rf e e o Internet protocols to use: all c f h ra Ensure that /etc/postfix/main.cf looks like the version below in the Configuration Files section g e rf (Section 4.3.8). Especially take note that the inet_interfaces setting. inet_interfaces = loopback-only will o m NOT allow mail from other machines. : h t t p /: 4.3.6 User Accounts / d o ro.i 1. Create an account for each user that needs email: g / 1 6.0 adduser <username> 0 2 /8 2. Answer the questions. N SI T PS. 4.3.7 DNS Settings 1. 8 0 0 For mail to work correctly, an MX record must be set up on the DNS server. -5 . The FS-ITAM build is using a Microsoft Server 2012R2 as its DNS server. 1. First set up a DNS A-Record for the email server, which looks like: Host: email1 FQDN: email1.lab5.nccoe.gov IP address: 172.16.1.50 2. Check next to Update associates pointer record. 3. Next create an MX record that looks like: Host or child domain: (same as parent folder) FQDN: lab5.nccoe.gov FQDN of mail server: email1.lab5.nccoe.gov Mail server priority: 10 NIST SP 1800-5C: IT Asset Management 1504.3.8 Configuration Files T h si /etc/postfix/main.cf p u b cil # See /usr/share/postfix/main.cf.dist for a commented, more complete version a t noi si va # Debian specific: Specifying a file name will cause the first a ali b # line of that file to be used as the name. The Debian default el erf # is /etc/mailname. e o c f #myorigin = /etc/mailname h a r g e rf o m smtpd_banner = $myhostname ESMTP $mail_name (Ubuntu) biff = no : h tt # appending .domain is the MUA's job. append_dot_mydomain = no p /: / d o o.i gr # Uncomment the next line to generate "delayed mail" warnings / 1 0 6. #delay_warning_time = 4h readme_directory = no 0 2 /8 # TLS parameters N SI S.T smtpd_tls_cert_file = /etc/ssl/certs/smtpd.crt smtpd_tls_key_file = 1.P /etc/ssl/private/smtpd.key smtpd_use_tls=yes 8 0 0 smtpd_tls_session_cache_database = btree:${data_directory}/smtpd_scache -5 . smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache # See /usr/share/doc/postfix/TLS_README.gz in the postfix-doc package for # information on enabling SSL in the smtp client. smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination myhostname = mail1.lab5.nccoe.gov alias_maps = hash:/etc/aliases alias_database = hash:/etc/aliases mydestination = email1, email1.lab5.nccoe.gov, localhost.lab5.nccoe.gov, localhost.localdomain, localhost, lab5.nccoe.gov relayhost = NIST SP 1800-5C: IT Asset Management 151mynetworks = 172.16.0.0/16 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 mailbox_size_limit = 0 recipient_delimiter = + T h #inet_interfaces = loopback-only inet_interfaces = all default_transport = smtp si p relay_transport = smtp u b cil myorigin = /etc/mailname inet_protocols = all home_mailbox = Maildir/ mailbox_command a oit = smtpd_sasl_local_domain = smtpd_sasl_auth_enable = yes n a si smtpd_sasl_security_options = noanonymous broken_sasl_auth_clients = yes v a ali smtpd_recipient_restrictions = b el permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination rf e e smtp_tls_security_level = may smtpd_tls_security_level = may smtpd_tls_auth_only = no o c f smtp_tls_note_starttls_offer = yes smtpd_tls_CAfile = /etc/ssl/certs/cacert.pem ah smtpd_tls_loglevel = 1 smtpd_tls_received_header = yes smtpd_tls_session_cache_timeout r eg = 3600s tls_random_source = dev:/dev/urandom rf o m : h 4.4 Openswan (VPN) t t p /: Openswan is an open-source IPsec VPN. Openswan runs on Linux and supports IKEv1, IKEv2, X.509 / d o.io Digital Certificates and NAT Traversal. r g / 1 0 4.4.1 How It’s Used 6. 0 2 /8 In the FS ITAM build, Openswan is used to form a secure VPN to the mainframe computer owned by N SI Vanguard Integrity Professionals. T S. P 1. 8 4.4.2 Virtual Machine Configuration 0 0 -5 . The Openswan virtual machine is configured with two network interface cards, 8 GB of RAM and one CPU core. 4.4.3 Network Configuration The management network interface card is configured as follows: ▪ IPv4 Manual ▪ IPv6 Ignore/Disabled ▪ IP Address: 172.16.0.67 (internal interface) ▪ IP Address: 10.33.5.16 (external interface for the VPN) Netmask: 255.255.255.0 ▪ Gateway: 10.33.5.1 ▪ DNS Servers: 8.8.8.8, 172.16.1.20, 172.16.1.21 ▪ Search Domains: lab5.nccoe.gov NIST SP 1800-5C: IT Asset Management 1524.4.4 Installing Openswan Openswan is installed on a hardened Ubuntu 14.04 Linux system. Complete installation instructions can T h be found at https://www.openswan.org/. si p u b cil 4.4.5 Installing Openswan a t oi si n 1. For Debian/Ubuntu Linux systems: It is always best to make sure your system is up-to-date by va performing: a ali b sudo apt-get update sudo apt-get upgrade el rf e sudo apt-get install openswan xl2tpd ppp lsof e o hc f 2. Copy the provided configuration files into /etc: a r g rf e cp <ipsec.conf> /etc o m cp <ipsec.secrets> /etc : h t t /:p 3. Edit /etc/ipsec.secrets and replace MYSECRET with your pre-shared key. / d o o.i 4. Restart Openswan: r g / 01 service ipsec restart 6. 0 82 5. Verify by running: / N TSI service ipsec status S. P 1. 6. Bring up the IPsec tunnel: 8 0 0 -5 ipsec auto -up nccoe-vanguard . 7. Verify by running: ipsec auto -verbose -status If you see (ISAKMP SA established) then that is good. A little script was created to keep the connection up - connect_vanguard.sh. 8. Copy connect_vanguard.sh somewhere typical like /usr/local/bin: cp <connect_vanguard.sh> /usr/local/bin chmod 755 /usr/local/bin/connect_vanguard.sh 9. Have it run every hour by linking it into cron.daily: ln - s /usr/local/bin/connect_vanguard.sh /etc/cron.daily/connect_vanguard NIST SP 1800-5C: IT Asset Management 1534.4.6 Configurations and Scripts T h si /etc/ipsec.conf p u b cil # /etc/ipsec.conf - Openswan IPsec configuration file a t noi si va # This file: /usr/share/doc/openswan/ipsec.conf-sample a ali b # el erf # Manual: ipsec.conf.5 e o c f h a r g # conforms to second version of ipsec.conf specification e rf o m : h tt # basic configuration config setup p /: / d # Do not set debug options to debug configuration issues! o o.i gr # plutodebug / klipsdebug = "all", "none" or a combation from below: / 1 0 6. # "raw crypt parsing emitting control klips pfkey natt x509 dpd private" 0 2 /8 # eg: N SI S.T # plutodebug="control parsing" P 81. # Again: only enable plutodebug or klipsdebug when asked by a developer 0 0 -5 # . # enable to get logs per-peer # plutoopts="--perpeerlog" # # Enable core dumps (might require system changes, like ulimit -C) # This is required for abrtd to work properly # Note: incorrect SElinux policies might prevent pluto writing the core dumpdir=/var/run/pluto/ # # NAT-TRAVERSAL support, see README.NAT-Traversal nat_traversal=yes # exclude networks used on server side by adding %v4:!a.b.c.0/24 # It seems that T-Mobile in the US and Rogers/Fido in Canada are NIST SP 1800-5C: IT Asset Management 154# using 25/8 as "private" address space on their 3G network. # This range has not been announced via BGP (at least upto 2010-12-21) T h si p u virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12,%v b cil 4:25.0.0.0/8,%v6:fd00::/8,%v6:fe80::/10 a t oi n # OE is now off by default. Uncomment and change to on, to enable. oe=off si a v # which IPsec stack to use. auto will try netkey, then klips then mast a ali elb #protostack=auto protostack=netkey rf ee # Use this to log to a file, or disable logging on embedded systems (like openwrt) o c f #plutostderrlog=/dev/null h a r g e #plutodebug=all plutostderrlog=/var/log/pluto.log nat_traversal=yes rf o m oe=off : h t pt #myid=172.16.0.66 /: / od # Add connections here conn nccoe-vanguard o.i gr type=tunnel forceencaps=yes authby=secret / 1 0 6. ike=3des-sha1;modp1024 #don't actually need to specify this keyexchange=ike 0 2 8 / ikelifetime=22800s phase2=esp N SI T S. phase2alg=aes256-sha1;modp1024 salifetime=3600s P 1. 8 pfs=yes #vanguard has pfs on auto=start 0 0 -5 . keyingtries=3 #rekey=no left=%defaultroute leftnexthop=%defaultroute leftsubnet=172.16.0.0/24 #NCCoE ITAM lab internal subnet # either one of these seems to work #leftid=10.33.5.16 #behind firewall ip address leftid=136.160.255.42 #public ip address #leftsourceip=136.160.255.42 leftsourceip=10.33.5.16 NIST SP 1800-5C: IT Asset Management 155right=174.47.13.99 #IOS outside address T h rightid=174.47.13.99 #IKE ID send by IOS si p u #rightsubnet is the internal subnet on the distant end rightsubnet=172.17.212.0/24 b cil #network behind IOS rightnexthop=%defaultroute a t oi n si a /etc/ipsec.secrets v a bali # This file holds shared secrets or RSA private keys for inter-Pluto el erf # authentication. See ipsec_pluto(8) manpage, and HTML documentation. e o c f h a gr # RSA private key for this host, authenticating it to any other host e rf mo # which knows the public part. Suitable public keys, for ipsec.conf, DNS, : h t # or configuration of other implementations, can be extracted conveniently t p /: / d # with "ipsec showhostkey". o o.i r g / 1 6.0 # this file is managed with debconf and will contain the automatically created RSA 20 keys 8 / N SI # The %any %any line is just for testing T S. P # Replace MYSECRET with your pre-shared key 1. 8 0 0 -5 . include /var/lib/openswan/ipsec.secrets.inc 172.16.0.67 174.47.13.99 : PSK "MYSECRET" 10.33.5.16 174.47.13.99 : PSK "MYSECRET" #%any %any : PSK "MYSECRET" /usr/local/bin/connect_vanguard.sh #!/bin/sh #start IPsec tunnel ipsec auto --up nccoe-vanguard NIST SP 1800-5C: IT Asset Management 156#status #ipsec auto --verbose --status T h si 4.5 Ubuntu Apt-Cacher p u b cil Ubuntu Apt-Cacher is a central repository for update and patch management used by all Ubuntu a t oi systems on the network. n si a v a 4.5.1 How It’s Used ali b rf el In the FS ITAM build, Ubuntu Apt-Cacher provides all Ubuntu systems with patches and updates. e e o c f 4.5.2 Virtual Machine Configuration h a r g e The Ubuntu Apt-Cacher virtual machine is configured with one network interface cards, 4 GB of RAM rf o and one CPU core. m : h t t p 4.5.3 Network Configuration /: / d o o.i The management network interface card is configured as follows: r g / 01 ▪ IPv4 Manual 6. 0 82 ▪ IPv6 Ignore/Disabled / N SI ▪ IP Address: 172.16.0.67 T S. P 1. ▪ Netmask: 255.255.255.0 8 0 0 -5 ▪ Gateway: 172.16.0.11 . ▪ DNS Servers: 172.16.1.20, 172.16.1.21 ▪ Search Domains: lab5.nccoe.gov 4.5.4 Installing Ubuntu Apt-Cacher Ubuntu Apt-Cacher is installed on a hardened Ubuntu 14.04 Linux system. Complete installation instructions can be found at: https://help.ubuntu.com/community/Apt-Cacher-Server. 1. For Debian/Ubuntu Linux systems: It is always best to make sure your system is up-to-date by performing: sudo apt-get update sudo apt-get upgrade sudo apt-get install apt-cacher apache2 2. Enable apt-cacher by editing /etc/default/apt-cacher and change autostart to 1. NIST SP 1800-5C: IT Asset Management 1573. Restart Apache: sudo /etc/init.d/apache2 restart T h si 4. Verify that things are working by pointing your Web browser to http://<apt-cacher>:3142. p u b cil 5. Edit /etc/apt-cacher/apt-cacher.conf and uncomment the following line: allowed_hosts = * a t oi n 6. Configure as a proxy to APT: si a av sudo nano /etc/apt/apt.conf.d/01proxy ali b el 7. Inside your new file, add a line that says: rf e e o Acquire::http::Proxy "http://<IP address or hostname of the apt-cacher c f server>:3142"; h a r g e 8. Restart apt-cacher: rf o m sudo /etc/init.d/apt-cacher restart : h t t p /: 4.5.5 Client Configuration / d o o.i 1. Client configuration is the same as setting up the server as a proxy to APT: r g / 1 0 sudo nano /etc/apt/apt.conf.d/01proxy 6. 0 2 /8 2. Inside your new file, add a line that says: N SI S.T Acquire::http::Proxy "http://172.16.0.77:3142"; P 1. 8 0 4.6 Windows 2012 Certificate Authority 0 -5 . The Windows 2012 Certificate Authority server in the ITAM build uses an NCCoE base 2012 R2 x86_64 DoD STIG image. The installation of the Windows 2012 Certificate Authority server was performed using installation media provided by DISA. This image was chosen because it is standardized, hardened, and fully documented. 4.6.1 Software Configurations Windows 2012 Certificate Authority (CA) server was designed to issue certificates to endpoints that need to be accessed by users such that communication to such devices are deemed secure. It is used in building a PKI system. 4.6.2 How It’s Used The ITAM solution uses the Windows 2012 CA server to issue certificates to endpoints that have services that need to be accessed securely such as HTTPS enabled devices. The pfSense routers utilized these NIST SP 1800-5C: IT Asset Management 158certificates allowing for secure communication and configuration. The certificates are also utilized by Splunk Enterprise and the Splunk Universal Forwarder. T sih 4.6.2.1 INSTALL ACTIVE DIRECTORY CERTIFICATE SERVICES (AD CS) p u cilb 1. Go to Server Manager and click Add Roles and Features Wizard. a t noi 2. Click Next. Select Role-based or feature-based installation. Click Next. si a av 3. Select your server on the next screen and click Next. ali b el 4. Select the Active Directory Certificate Services and Add Features when prompted. rf e e o 5. Click Next when you see .NET 4.5 framework and other default selections. c f h a r 6. Click Next on informational screens. g e rf mo 7. On the Role Services for AD CS, select all checkboxes and click Next. : h t pt 8. When you are prompted to install the IIS web service, click Install. /: / d o 9. Click Close when the installation completes. o.i r g / 01 4.6.2.2 CONFIGURE AD CS SERVICES PART 1 6. 0 82 1. Go back to Server Manager and click on the warning icon. / N SI T 2. Click on Configure Active Directory Certificate Services. Click Next. S. P 1. 8 3. On the Role Services to configure screen, select Certification Authority, Certification Authority 0 0 -5 Web Enrollment. . 4. Choose Enterprise CA. On the following screen click Next. 5. Choose Root CA and click Next. 6. Choose Create a new private key and click Next. 7. Leave the defaults on the Specify the cryptographic options screen and click Next. 8. Specify the CA common name and click Next. 9. Use the default selection: Specify a validity period at the default of 5 years for the certificates generated by this CA. 10. Leave the database locations at default and click Next. 11. Click Configure to initiate configuration of the selected roles. NIST SP 1800-5C: IT Asset Management 15912. Click Close when the configurations succeed. 13. Click No if a Configure additional role services pop up is presented. T h si p 4.6.2.3 CONFIGURE AD CS PART 2 u b acil 1. Go back to Server Manager and click on the yellow warning sign. t oi n si 2. Click on Configure AD CS on the destination server. a v a ali 3. Specify a user with credentials to configure role services. The user must be part of the Enter- b el prise Admins group. rf e e o 4. Select the other checkboxes and click Next. c f h a r 5. Select a domain account with the specified permissions. g e rf mo 6. Accept the default RA name and click Next. : h t pt 7. Accept the default Cryptographic options cryptographic service providers and key lengths and /: / d click Next. o o.i gr 8. Select the default CA name as the name to be used for Certificate Enrollment Services. / 1 0 06. 9. Specify the same service account for to be used for Certificate Enrollment Web Service. 2 8 / SIN 10. Choose the available Server Certificate and click Next. Click Configure; then, click Close. T S. P 1. 4.6.2.4 CONFIGURE A CERTIFICATE AND PUBLISH TO ACTIVE DIRECTORY 8 0 0 -5 1. Open the Certification Authority tool from Server Manager. . 2. Right-click Certificate Templates. 3. Click Manage. 4. Right-click Any template and click Duplicate. 5. Give it a distinct name/Template Display name. 6. Click the Subject Name tab and select Common Name from the subject name format dropdown list. 7. Click Apply, click OK and then close the dialog box. 8. Go back to the Certification Authority tool and right-click Certificate Templates. 9. Select the certificate you just created and click on Properties. NIST SP 1800-5C: IT Asset Management 16010. On the General tab, click on Publish to Active Directory. 11. Click on the Security tab, select Domain Computers and check the Read, Enroll and Autoenroll T h boxes. si p u b 12. Click Apply and then OK to close the dialog box. cil a t oi n 4.6.2.5 CONFIGURE GROUP POLICY TO AUTO-ENROLL DOMAIN COMPUTERS si a av 1. Log on to the domain controller. ali b el 2. Go to Group Policy Management Tool via Server Manager. rf e e o 3. Expand the forest, then expand the domain. c f h a r 4. Right-click on Default Domain Policy and click Edit. g e rf mo 5. Click Computer Configuration, Policies, Windows Settings, Security Settings, Public Key Policies : h and open Certificates Services Client Auto-Enrollment policy. t t p /: / d 6. Choose Enabled from the Configuration Model box, check Renew Expired certificates, update o o.i pending certificates, and remove revoked certificates. r g / 1 0 7. Also check Update certificates that use certificate templates. 6. 0 2 /8 8. Click Apply; then, click OK. N SI T S. 9. Click Computer Configuration, Policies, Windows Settings, Security Settings, and Public Key Poli- P 81. cies. 0 0 -5 . 10. Right-click Certificate Services Client - Certificate Enrollment Policy, click Properties. 11. Choose Enabled from the Configuration Model drop down list. 12. Ensure that Active Directory Enrollment Policy is checked. 13. Check Properties of Active Directory Enrollment Policy and ensure that the Enable for automatic enrollment and renewal and the Require strong validation during enrollment boxes are checked. 14. Click Apply and then OK to close the dialog boxes. NIST SP 1800-5C: IT Asset Management 1614.6.3 Certificate Generation and Issuance This ITAM solution had a mix of endpoints which included Windows and Linux hosts including some T h pfSense routers. Some of these devices pfSense routers had HTTPS enabled. The PKI implementation si up was extended to further secure these HTTPS services. The overall process includes the following steps: b cil ta 1. Generate a certificate signing request (CSR). oi n a si 2. Copy the CSR over to the Windows Certificate Authority (CA). v a bali 3. Submit the CSR to the CA service. el rf ee 4. Sign the CSR and copying the issued certificate along with the CA certificate to the device. o c f h 5. Generate a Certificate Signing Request. a r g e rf 6. Open the terminal in a Linux computer with OpenSSL and run openssl req -new -newkey o m rsa:2048 -nodes -keyout server.key -out server.csr : h t t p where server.key and server.csr represent arbitrary names you have chosen. The common /: / d name field should be the FQDN of the endpoint. o o.i r /g This will generate two files: the private key file and a CSR file. 1 0 6. 0 7. Copy the CSR file. 2 8 / N SI a. Use any of the file transfer utilities such as SCP or FTP to copy the CSR to the CA. T S. P 1. b. Alternatively, the CSR can be copied via USB or other means. 8 0 0 -5 8. Submit the Certificate Signing Request to the CA Service. . a. Log on to the CA server, go to the command prompt and type Certreq.exe -attrib "CertificateTemplate:<Nameofthetemplate>" -submit <pathtoCSR> b. An example of what could be typed is certreq.exe -attrib "CertificateTem- plate:WebServer" -submit D:\requestfile.txt 9. Sign the CSR and copy the Certificates to the device. a. To sign the CSR, go to the Windows CA server and perform the following steps: i. Click Start > Control Panel > Administrative Tools > Certification Authority. ii. Expand the CA name and click Pending Requests. iii. Right-click the CSR on the right pane showing a request ID number > Click All Tasks > Click Issue. NIST SP 1800-5C: IT Asset Management 162b. Run certutil -ca.cert ca_name.cer from the command prompt where ca_name.cer is the arbitrary file name for the CA certificate. T h p si 10. Copy the client certificate and CA certificate to client system. u b cil 11. Make the application aware of the location of these certificates. Once logged in, the pfSense a t oi routers in the ITAM build provide links to copy and paste the contents of the private key, the n a si certificate file and the CA server certificate. v a ali elb 4.7 Common PKI Activities rf e o e This section provides instructions for common PKI activities using a Microsoft Certificate Authority (CA) hc f in a heterogeneous environment. a r g e rf 4.7.1 Generating a Certificate Signing Request from OpenSSL o m : h 1. Run: t t p /: / d openssl req -new -newkey rsa:2048 -nodes -keyout serverFQDN.key -out o o.i serverFQDN.csr r g / 1 where serverFQDN.key is the private key file and the serverFQDN.csr is the certificate signing 0 6. 0 request file. The files can be arbitrarily named. 2 8 / N SI 2. When prompted, ensure that the common name field is set to the server FQDN. T S. P 1. A Certificate Signing Request (CSR) can be generated for as many servers as you need in your 8 00 enterprise. -5 . 3. Copy the CSR file to the Certificate Authority (CA) server for signing. 4.7.2 Submitting the CSR to the CA Service 1. Log on to the CA server. 2. Go to the command prompt and type: Certreq.exe -attrib "CertificateTemplate:<Nameofthetemplate>" -submit <pathtoCSR> An example command could be: certreq.exe -attrib "CertificateTemplate:WebServer" -submit D:\serverFQDN.key NIST SP 1800-5C: IT Asset Management 1634.7.3 Exporting a Root Certificate from a Microsoft CA 1. From the command prompt run: T h si Certutil -ca.cert new_ca_filename.cer p u b cil where new_ca_filename.cer is the arbitrary file name for the exported CA certificate. a t oi n The exported CA certificate would need to be copied over to the other servers that would be included in si va Public Key Infrastructure. a ali b el The Microsoft Windows CA root certificate would be in Distinguished Encoding Rules (DER) encoded erf format. Some platforms, especially Linux platforms, may prefer PEM encoding and conversion to Privacy e c fo Enhanced Mail (PEM) encoding might be necessary. h a r eg 4.7.4 Converting from DER Encoding to PEM Encoding rf o m : h 1. Run: t t /:p openssl x509 -in DER_CA_CERT.crt -inform der -outform pem -out PEM_CA_CERT.pem / d o o.i where DER_CA_CERT.crt is DER encoded and PEM_CA_CERT is the transformed PEM encoded r /g certificate. 1 0 6. 0 Additional information on converting certificates can be found at the following link 2 8 N/ http://info.ssl.com/article.aspx?id=12149. SI T S. 1.P 4.8 Process Improvement Achievers (PIA) Security Evaluation 8 0 0 -5 Process Improvement Achievers (PIA) conducted a remote security evaluation of the FS ITAM build. The . evaluation consisted of running multiple tools against the machines in the lab to find any vulnerabilities due to misconfiguration. NIST SP 1800-5C: IT Asset Management 164Appendix A List of Acronyms AD Active Directory T h si p CA CA Technologies u b cil a CA Certificate Authority t oi n si COTS Commercial Off-The-Shelf a v a ali CRADA Collaborative Research and Development Agreement b el rf CSR Certificate Signing Request e e o c f .csv Comma-Separated Value h a r eg DER Distinguished Encoding Rules rf o m DMZ Demilitarized Zone : h t t /:p FS Financial Sector / d o o.i HR Human Resources r g / 01 ID Identity 6. 0 82 ITAM Information Technology Asset Management / N SI T IDS Intrusion Detection System S. P 1. 8 IP Internet Protocol 0 0 -5 . NAS Network Attached Storage NCCoE National Cybersecurity Center of Excellence NIST National Institute of Standards and Technology OS Operating System PEM Privacy Enhanced Mail PKI Public Key Infrastructure SME Subject Matter Expert SQL Structured Query Language SSL Secure Socket Layer STIG Security Technical Implementation Guideline NIST SP 1800-5C: IT Asset Management 165TLS Transport Layer Security VLAN Virtual Local Area Network T h si VM Virtual Machine p u b cil VPN Virtual Private Network a t oi n si a v a ali b el rf e e o c f h a r g e rf o m : h t t p /: / d o o.i r g / 1 0 6. 0 2 8 / N SI T S. P 1. 8 0 0 -5 . NIST SP 1800-5C: IT Asset Management 166